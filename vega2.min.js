!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.vg=t()}}(function(){var t;return function e(t,n,r){function i(s,o){if(!n[s]){if(!t[s]){var l="function"==typeof require&&require;if(!o&&l)return l(s,!0);if(a)return a(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[s]={exports:{}};t[s][0].call(c.exports,function(e){var n=t[s][1][e];return i(n?n:e)},c,c.exports,e,t,n,r)}return n[s].exports}for(var a="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(t,e,n){e.exports={core:{View:t("./core/View")},dataflow:{changeset:t("./dataflow/changeset"),Datasource:t("./dataflow/Datasource"),Graph:t("./dataflow/Graph"),Node:t("./dataflow/Node")},parse:{spec:t("./parse/spec")},scene:{Builder:t("./scene/Builder"),GroupBuilder:t("./scene/GroupBuilder")},transforms:t("./transforms/index"),config:t("./util/config"),util:t("datalib")}},{"./core/View":26,"./dataflow/Datasource":28,"./dataflow/Graph":29,"./dataflow/Node":30,"./dataflow/changeset":32,"./parse/spec":51,"./scene/Builder":64,"./scene/GroupBuilder":66,"./transforms/index":92,"./util/config":95,datalib:17}],2:[function(t,e,n){},{}],3:[function(t,e,n){function r(){if(!o){o=!0;for(var t,e=s.length;e;){t=s,s=[];for(var n=-1;++n<e;)t[n]();e=s.length}o=!1}}function i(){}var a=e.exports={},s=[],o=!1;a.nextTick=function(t){s.push(t),o||setTimeout(r,0)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=i,a.addListener=i,a.once=i,a.off=i,a.removeListener=i,a.removeAllListeners=i,a.emit=i,a.binding=function(t){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(t){throw new Error("process.chdir is not supported")},a.umask=function(){return 0}},{}],4:[function(t,e,n){function r(t){t=t||{};var e,n,r,o,l,u,c,d,h=t.maxbins||15,f=t.base||10,n=Math.log(f),p=t.div||[5,2],g=t.min,m=t.max,v=m-g;if(null!=t.step)e=t.step;else if(t.steps)e=t.steps[Math.min(t.steps.length-1,i(t.steps,v/h,0,t.steps.length))];else{r=Math.ceil(Math.log(h)/n),o=t.minstep||0,e=Math.max(o,Math.pow(f,Math.round(Math.log(v)/n)-r));do e*=f;while(Math.ceil(v/e)>h);for(c=0;c<p.length;++c)u=e/p[c],u>=o&&h>=v/u&&(e=u)}return u=Math.log(e),l=u>=0?0:~~(-u/n)+1,d=Math.pow(f,-l-1),g=Math.min(g,Math.floor(g/e+d)*e),m=Math.ceil(m/e)*e,{start:g,stop:m,step:e,unit:{precision:l},value:a,index:s}}function i(t,e,n,r){for(;r>n;){var i=n+r>>>1;u.cmp(t[i],e)<0?n=i+1:r=i}return n}function a(t){return this.step*Math.floor(t/this.step+d)}function s(t){return Math.floor((t-this.start)/this.step+d)}function o(t){return this.unit.date(a.call(this,t))}function l(t){return s.call(this,this.unit.unit(t))}var u=t("./util"),c=t("./date-units"),d=1e-15;r.date=function(t){t=t||{};var e=t.min,n=t.max,i=t.maxbins||20,a=t.minbins||4,s=+n-+e;return unit=t.unit?c[t.unit]:c.find(s,a,i),bins=r({min:null!=unit.min?unit.min:unit.unit(e),max:null!=unit.max?unit.max:unit.unit(n),maxbins:i,minstep:unit.minstep,steps:unit.step}),bins.unit=unit,bins.index=l,t.raw||(bins.value=o),bins},e.exports=r},{"./date-units":5,"./util":21}],5:[function(t,e,n){var r=t("./util"),i=[[31536e6,5],[7776e6,4],[2592e6,4],[12096e5,3],[6048e5,3],[1728e5,3],[864e5,3],[432e5,2],[216e5,2],[108e5,2],[36e5,2],[18e5,1],[9e5,1],[3e5,1],[6e4,1],[3e4,0],[15e3,0],[5e3,0],[1e3,0]],a=[{type:"second",minstep:1,format:"%Y %b %-d %H:%M:%S.%L",date:function(t){return new Date(1e3*t)},unit:function(t){return+t/1e3}},{type:"minute",minstep:1,format:"%Y %b %-d %H:%M",date:function(t){return new Date(6e4*t)},unit:function(t){return~~(+t/6e4)}},{type:"hour",minstep:1,format:"%Y %b %-d %H:00",date:function(t){return new Date(36e5*t)},unit:function(t){return~~(+t/36e5)}},{type:"day",minstep:1,step:[1,7],format:"%Y %b %-d",date:function(t){return new Date(864e5*t)},unit:function(t){return~~(+t/864e5)}},{type:"month",minstep:1,step:[1,3,6],format:"%b %Y",date:function(t){return new Date(Date.UTC(~~(t/12),t%12,1))},unit:function(t){return r.isNumber(t)&&(t=new Date(t)),12*t.getUTCFullYear()+t.getUTCMonth()}},{type:"year",minstep:1,format:"%Y",date:function(t){return new Date(Date.UTC(t,0,1))},unit:function(t){return(r.isNumber(t)?new Date(t):t).getUTCFullYear()}}],s={type:"minuteOfHour",min:0,max:59,minstep:1,format:"%M",date:function(t){return new Date(Date.UTC(1970,0,1,0,t))},unit:function(t){return(r.isNumber(t)?new Date(t):t).getUTCMinutes()}},o={type:"hourOfDay",min:0,max:23,minstep:1,format:"%H",date:function(t){return new Date(Date.UTC(1970,0,1,t))},unit:function(t){return(r.isNumber(t)?new Date(t):t).getUTCHours()}},l={type:"dayOfWeek",min:0,max:6,step:[1],format:"%a",date:function(t){return new Date(Date.UTC(1970,0,4+t))},unit:function(t){return(r.isNumber(t)?new Date(t):t).getUTCDay()}},u={type:"dayOfMonth",min:1,max:31,step:[1],format:"%-d",date:function(t){return new Date(Date.UTC(1970,0,t))},unit:function(t){return(r.isNumber(t)?new Date(t):t).getUTCDate()}},c={type:"monthOfYear",min:0,max:11,step:[1],format:"%b",date:function(t){return new Date(Date.UTC(1970,t%12,1))},unit:function(t){return(r.isNumber(t)?new Date(t):t).getUTCMonth()}},d={second:a[0],minute:a[1],hour:a[2],day:a[3],month:a[4],year:a[5],minuteOfHour:s,hourOfDay:o,dayOfWeek:l,dayOfMonth:u,monthOfYear:c,timesteps:a};d.find=function(t,e,n){var r,s,o,l=i[0];for(r=1,s=i.length;s>r;++r)if(l=i[r],t>l[0]){if(o=t/l[0],o>n)return a[i[r-1][1]];if(o>=e)return a[l[1]]}return a[i[i.length-1][1]]},e.exports=d},{"./util":21}],6:[function(t,e,n){var r=e.exports={};r.repeat=function(t,e){var n,r=Array(e);for(n=0;e>n;++n)r[n]=t;return r},r.zeros=function(t){return r.repeat(0,t)},r.range=function(t,e,n){if(arguments.length<3&&(n=1,arguments.length<2&&(e=t,t=0)),(e-t)/n==1/0)throw new Error("Infinite range");var r,i=[],a=-1;if(0>n)for(;(r=t+n*++a)>e;)i.push(r);else for(;(r=t+n*++a)<e;)i.push(r);return i},r.random={},r.random.uniform=function(t,e){void 0===e&&(e=t,t=0);var n=e-t,i=function(){return t+n*Math.random()};return i.samples=function(t){return r.zeros(t).map(i)},i},r.random.integer=function(t,e){void 0===e&&(e=t,t=0);var n=e-t,i=function(){return t+Math.floor(n*Math.random())};return i.samples=function(t){return r.zeros(t).map(i)},i},r.random.normal=function(t,e){t=t||0,e=e||1;var n=void 0,i=function(){var r,i,a=0,s=0;if(void 0!==n)return a=n,n=void 0,a;do a=2*Math.random()-1,s=2*Math.random()-1,r=a*a+s*s;while(0==r||r>1);return i=Math.sqrt(-2*Math.log(r)/r),n=t+s*i*e,t+a*i*e};return i.samples=function(t){return r.zeros(t).map(i)},i}},{}],7:[function(t,e,n){function r(t,e){var n,r=null;if(t.types&&(r=e(t.types),o.isString(r)))return r;for(n=0;!o.isNotNull(r)&&n<t.length;++n)r=e?e(t[n]):t[n];return o.isDate(r)?"date":o.isNumber(r)?"number":"string"}function i(t,e,n){for(var r,i,a=u.range(n.start,n.stop+n.step/2,n.step).map(function(t){return{value:n.value(t),count:0}}),s=0;s<t.length;++s)if(r=e?e(t[s]):t[s],o.isNotNull(r)){if(i=n.index(r),0>i||i>=a.length||!isFinite(i))continue;a[i].count+=1}return a.bins=n,a}function a(t,e,n){var r=s.unique(t,e).counts;return o.keys(r).map(function(t){return{value:t,count:r[t]}}).sort(o.comparator(n?"-count":"+value"))}var s=t("./stats"),o=t("./util"),l=t("./bin"),u=t("./generate");e.exports=function(t,e,n){void 0!==n||o.isFunction(e)||(n=e,e=null);var u=n&&n.type||r(t,e);if("number"!==u&&"date"!==u&&"integer"!==u)return a(t,e,n&&n.sort);var c=s.extent(t,e),d=o.extend({min:c[0],max:c[1]},n);"integer"===u&&null==d.minstep&&(d.minstep=1);var h="date"===u?l.date(d):l(d);return i(t,e,h)}},{"./bin":4,"./generate":6,"./stats":18,"./util":21}],8:[function(t,e,n){(function(t){var n="undefined"!=typeof window?window.d3:"undefined"!=typeof t?t.d3:null;e.exports=function(t,e){var r=n.csv.parse(t?t.toString():t);return r}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],9:[function(t,e,n){e.exports={json:t("./json"),csv:t("./csv"),tsv:t("./tsv"),topojson:t("./topojson"),treejson:t("./treejson")}},{"./csv":8,"./json":10,"./topojson":11,"./treejson":12,"./tsv":13}],10:[function(t,e,n){var r=t("../../util");e.exports=function(t,e){var n=r.isObject(t)&&!r.isBuffer(t)?t:JSON.parse(t);return e&&e.property&&(n=r.accessor(e.property)(n)),n}},{"../../util":21}],11:[function(t,e,n){(function(n){var r=t("./json"),i="undefined"!=typeof window?window.topojson:"undefined"!=typeof n?n.topojson:null;e.exports=function(t,e){if(null==i)throw Error("TopoJSON library not loaded.");var n,a=r(t,e);if(e&&e.feature){if(n=a.objects[e.feature])return i.feature(a,n).features;throw Error("Invalid TopoJSON object: "+e.feature)}if(e&&e.mesh){if(n=a.objects[e.mesh])return[i.mesh(a,a.objects[e.mesh])];throw Error("Invalid TopoJSON object: "+e.mesh)}throw Error("Missing TopoJSON feature or mesh parameter.")}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./json":10}],12:[function(t,e,n){function r(t,e){function n(t,i){r.push(t);var a=t[e];if(a)for(var s=0;s<a.length;++s)n(a[s],t)}e=e||"children";var r=[];return n(t,null),r.root=t,r}var i=t("./json");e.exports=function(t,e){return t=i(t,e),r(t,e&&e.children)}},{"./json":10}],13:[function(t,e,n){(function(t){var n="undefined"!=typeof window?window.d3:"undefined"!=typeof t?t.d3:null;e.exports=function(t,e){var r=n.tsv.parse(t?t.toString():t);return r}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],14:[function(t,e,n){function r(e){var n=e.url;if(!n&&e.file)return d+e.file;if(e.baseURL&&!c.test(n)&&(u.startsWith(n,"/")||"/"===e.baseURL[e.baseURL.length-1]||(n="/"+n),n=e.baseURL+n),u.isNode&&u.startsWith(n,"//")&&(n=(e.defaultProtocol||"http")+":"+n),e.domainWhiteList){var r,i;if(u.isNode){var a=t("url").parse(n);r=a.hostname,i=null}else{var s=document.createElement("a");s.href=n,""==s.host&&(s.href=s.href),r=s.hostname.toLowerCase(),i=window.location.hostname}if(i!==r){var o=e.domainWhiteList.some(function(t){var e=r.length-t.length;return t===r||e>1&&"."===r[e-1]&&r.lastIndexOf(t)===e});if(!o)throw"URL is not whitelisted: "+n}}return n}function i(t,e){var n=e||function(t){throw t};try{var r=i.sanitizeUrl(t)}catch(a){return void n(a)}return r?u.isNode?u.startsWith(r,d)?o(r.slice(d.length),e):l(r,e):s(r,e):void n("Invalid URL: "+r)}function a(t){var e=t.responseType;return e&&"text"!==e?t.response:t.responseText}function s(t,e){function n(){var t=i.status;!t&&a(i)||t>=200&&300>t||304===t?e(null,i.responseText):e(i,null)}var r=!!e,i=new XMLHttpRequest;return!this.XDomainRequest||"withCredentials"in i||!/^(http(s)?:)?\/\//.test(t)||(i=new XDomainRequest),r&&("onload"in i?i.onload=i.onerror=n:i.onreadystatechange=function(){i.readyState>3&&n()}),i.open("GET",t,r),i.send(),!r&&a(i)?i.responseText:void 0}function o(e,n){var r=t("fs");return n?void t("fs").readFile(e,n):r.readFileSync(e,"utf8")}function l(e,n){return n?void t("request")(e,function(t,e,r){t||200!==e.statusCode?n(t,null):n(null,r)}):t("sync-request")("GET",e).getBody()}var u=t("../util"),c=/^([A-Za-z]+:)?\/\//,d="file://";i.sanitizeUrl=r,e.exports=i},{"../util":21,fs:2,request:2,"sync-request":2,url:2}],15:[function(t,e,n){var r=t("../util"),i=t("./load"),a=t("./read");e.exports=r.keys(a.formats).reduce(function(t,e){return t[e]=function(t,n,s){r.isString(t)&&(t={url:t}),2===arguments.length&&r.isFunction(n)&&(s=n,n=void 0),n=r.extend({parse:"auto"},n),n.type=e;var o=i(t,s?function(t,e){t&&s(t,null);try{e=a(e,n)}catch(r){s(r,null)}s(null,e)}:void 0);return o?a(o,n):void 0},t},{})},{"../util":21,"./load":14,"./read":16}],16:[function(t,e,n){function r(t,e){var n=e&&e.type||"json";return t=l[n](t,e),e&&e.parse&&s(t,e.parse),t}function i(t,e){var n,r,i,a=["boolean","integer","number","date"];for(n=0;n<t.length;++n){for(i=e?e(t[n]):t[n],r=0;r<a.length;++r)o.isNotNull(i)&&!c[a[r]](i)&&(a.splice(r,1),r-=1);if(0===a.length)return"string"}return a[0]}function a(t,e){return e=e||o.keys(t[0]),e.reduce(function(e,n){var r=i(t,o.accessor(n));return u[r]&&(e[n]=r),e},{})}function s(t,e){var n,r,i,s,l,c,d=t.length;for(e="auto"===e?a(t):o.duplicate(e),n=o.keys(e),r=n.map(function(t){return u[e[t]]}),s=0,c=n.length;d>s;++s)for(i=t[s],l=0;c>l;++l)i[n[l]]=r[l](i[n[l]]);t.types=e}var o=t("../util"),l=t("./formats"),u={"boolean":o["boolean"],integer:o.number,number:o.number,date:o.date,string:o.identity},c={"boolean":function(t){return"true"===t||"false"===t||o.isBoolean(t)},integer:function(t){return c.number(t)&&(t=+t)===~~t},number:function(t){return!isNaN(+t)&&!o.isDate(t)},date:function(t){return!isNaN(Date.parse(t))}};r.type=i,r.types=a,r.formats=l,r.parse=s,e.exports=r},{"../util":21,"./formats":9}],17:[function(t,e,n){var r=t("./util"),i={load:t("./import/load"),read:t("./import/read"),bin:t("./bin"),histogram:t("./histogram"),summary:t("./summary"),template:t("./template"),dateunits:t("./date-units")};r.extend(i,r),r.extend(i,t("./generate")),r.extend(i,t("./stats")),r.extend(i,t("./import/loaders")),e.exports=i},{"./bin":4,"./date-units":5,"./generate":6,"./histogram":7,"./import/load":14,"./import/loaders":15,"./import/read":16,"./stats":18,"./summary":19,"./template":20,"./util":21}],18:[function(t,e,r){var i=t("./util"),a=t("./generate"),s={};s.unique=function(t,e,r){if(!i.isArray(t)||0===t.length)return[];r=r||[];var a,s,o={};for(s=0,n=t.length;s<n;++s)a=e?e(t[s]):t[s],a in o?o[a]+=1:(o[a]=1,r.push(a));return r.counts=o,r},s.count=function(t,e){if(!i.isArray(t)||0===t.length)return 0;var r,a,s=0;for(a=0,n=t.length;a<n;++a)r=e?e(t[a]):t[a],null!=r&&(s+=1);return s},s.count.distinct=function(t,e){if(!i.isArray(t)||0===t.length)return 0;var r,a,s={},o=0;for(a=0,n=t.length;a<n;++a)r=e?e(t[a]):t[a],r in s||(s[r]=1,o+=1);return o},s.count.nulls=function(t,e){if(!i.isArray(t)||0===t.length)return 0;var r,a,s=0;for(a=0,n=t.length;a<n;++a)r=e?e(t[a]):t[a],null==r&&(s+=1);return s},s.median=function(t,e){if(!i.isArray(t)||0===t.length)return 0;e&&(t=t.map(e)),t=t.filter(i.isNotNull).sort(i.cmp);var n=Math.floor(t.length/2);return t.length%2?t[n]:(t[n-1]+t[n])/2},s.quantile=function(t,e,n){void 0===n&&(n=e,e=i.identity);var r=(t.length-1)*n+1,a=Math.floor(r),s=+e(t[a-1]),o=r-a;return o?s+o*(e(t[a])-s):s},s.mean=function(t,e){if(!i.isArray(t)||0===t.length)return 0;var n,r,a,s,o=0;for(r=0,a=0;r<t.length;++r)s=e?e(t[r]):t[r],null==s||isNaN(s)||(n=s-o,o+=n/++a);return o},s.variance=function(t,e){if(!i.isArray(t)||0===t.length)return 0;var n,r,a,s,o=0,l=0;for(r=0,a=0;r<t.length;++r)s=e?e(t[r]):t[r],null==s||isNaN(s)||(n=s-o,o+=n/++a,l+=n*(s-o));return l/=a-1},s.stdev=function(t,e){return Math.sqrt(s.variance(t,e))},s.modeskew=function(t,e){var n=s.mean(t,e),r=s.median(t,e),i=s.stdev(t,e);return 0===i?0:(n-r)/i},s.extent=function(t,e){var n,r,a,s,o=t.length;for(s=0;o>s;++s)if(a=e?e(t[s]):t[s],i.isNotNull(a)){n=r=a;break}for(;o>s;++s)a=e?e(t[s]):t[s],i.isNotNull(a)&&(n>a&&(n=a),a>r&&(r=a));return[n,r]},s.extent.index=function(t,e){var n,r,a,s,o,l,u=t.length;for(l=0;u>l;++l)if(o=e?e(t[l]):t[l],i.isNotNull(o)){n=r=o,a=s=l;break}for(;u>l;++l)o=e?e(t[l]):t[l],i.isNotNull(o)&&(n>o&&(n=o,a=l),o>r&&(r=o,s=l));return[a,s]},s.dot=function(t,e,n){var r,i,a=0;if(n)for(r=0;r<t.length;++r)i=e(t[r])*n(t[r]),isNaN(i)||(a+=i);else{if(t.length!==e.length)throw Error("Array lengths must match.");for(r=0;r<t.length;++r)i=t[r]*e[r],isNaN(i)||(a+=i)}return a},s.rank=function(t,e){var n,r,a,s=t.map(function(t,n){return{idx:n,val:e?e(t):t}}).sort(i.comparator("val")),o=t.length,l=Array(o),u=-1,c={};for(n=0;o>n;++n){if(r=s[n].val,0>u&&c===r)u=n-1;else if(u>-1&&c!==r){for(a=1+(n-1+u)/2;n>u;++u)l[s[u].idx]=a;u=-1}l[s[n].idx]=n+1,c=r}if(u>-1)for(a=1+(o-1+u)/2;o>u;++u)l[s[u].idx]=a;return l},s.cor=function(t,e,n){var r=n;n=r?t.map(n):e,e=r?t.map(e):t;var i=s.dot(e,n),a=s.mean(e),o=s.mean(n),l=s.stdev(e),u=s.stdev(n),c=t.length;return(i-c*a*o)/((c-1)*l*u)},s.cor.rank=function(t,e,n){var r,i,a,o=n?s.rank(t,e):s.rank(t),l=n?s.rank(t,n):s.rank(e),u=t.length;for(r=0,i=0;u>r;++r)a=o[r]-l[r],i+=a*a;return 1-6*i/(u*(u*u-1))},s.cor.dist=function(t,e,n){var r,i,a,o,l=n?t.map(e):t,u=n?t.map(n):e,c=s.dist.mat(l),d=s.dist.mat(u),h=c.length;for(r=0,i=0,a=0,o=0;h>r;++r)i+=c[r]*c[r],a+=d[r]*d[r],o+=c[r]*d[r];return Math.sqrt(o/Math.sqrt(i*a))},s.dist=function(t,e,n,r){var a,s,o=i.isFunction(n),l=t,u=o?t:e,c=o?r:n,d=t.length,h=0;if(2===c||void 0===c){for(s=0;d>s;++s)a=o?e(l[s])-n(u[s]):l[s]-u[s],h+=a*a;return Math.sqrt(h)}for(s=0;d>s;++s)a=Math.abs(o?e(l[s])-n(u[s]):l[s]-u[s]),h+=Math.pow(a,c);return Math.pow(h,1/c)},s.dist.mat=function(t){var e,n,r,i=t.length,s=i*i,o=Array(s),l=a.zeros(i),u=0;for(n=0;i>n;++n)for(o[n*i+n]=0,r=n+1;i>r;++r)o[n*i+r]=e=Math.abs(t[n]-t[r]),o[r*i+n]=e,l[n]+=e,l[r]+=e;for(n=0;i>n;++n)u+=l[n],l[n]/=i;for(u/=s,n=0;i>n;++n)for(r=n;i>r;++r)o[n*i+r]+=u-l[n]-l[r],o[r*i+n]=o[n*i+r];return o},s.entropy=function(t,e){var n,r,i=0,a=0,s=t.length;for(n=0;s>n;++n)i+=e?e(t[n]):t[n];if(0===i)return 0;for(n=0;s>n;++n)r=(e?e(t[n]):t[n])/i,r>0&&(a+=r*Math.log(r)/Math.LN2);return-a},s.entropy.normalized=function(t,e){var n=s.entropy(t,e);return 0===n?0:n*Math.LN2/Math.log(t.length)},s.entropy.mutual=function(t,e,n,r){var i,a,s,o=r?t.map(e):t,l=r?t.map(n):e,u=r?t.map(r):n,c={},d={},h=0,f=u.length,p=0;for(i=0;f>i;++i)c[o[i]]=0,d[l[i]]=0;for(i=0;f>i;++i)c[o[i]]+=u[i],d[l[i]]+=u[i],h+=u[i];for(a=1/(h*Math.LN2),i=0;f>i;++i)0!==u[i]&&(s=h*u[i]/(c[o[i]]*d[l[i]]),p+=u[i]*a*Math.log(s));return p},s.profile=function(t,e){var n,r,a,o,l,u=0,d=0,h=0,f=null,p=null,g=0,m=[],v={};for(a=0,c=0;a<t.length;++a)o=e?e(t[a]):t[a],v[o]=o in v?v[o]+1:(h+=1,1),i.isNotNull(o)&&((null===f||f>o)&&(f=o),(null===p||o>p)&&(p=o),l="string"==typeof o?o.length:o,n=l-u,u+=n/++d,g+=n*(l-u),m.push(l));return g/=d-1,r=Math.sqrt(g),m.sort(i.cmp),{unique:v,count:d,nulls:t.length-d,distinct:h,min:f,max:p,mean:u,stdev:r,median:o=s.quantile(m,.5),modeskew:0===r?0:(u-o)/r,iqr:[s.quantile(m,.25),s.quantile(m,.75)]}},e.exports=s},{"./generate":6,"./util":21}],19:[function(t,e,n){function r(){var t=this,e=[];return t.forEach(function(t){e.push("----- Field: '"+t.field+"' -----"),e.push("string"==typeof t.min||t.distinct<10?a(t):i(t)),e.push("")}),e.join("\n")}function i(t){return["distinct: "+t.distinct,"nulls:    "+t.nulls,"min:      "+t.min,"max:      "+t.max,"median:   "+t.median,"mean:     "+t.mean,"stdev:    "+t.stdev,"modeskew: "+t.modeskew].join("\n")}function a(t){var e=["distinct: "+t.distinct,"nulls:    "+t.nulls,"top values: "],n=t.unique,r=s.keys(n).sort(function(t,e){return n[e]-n[t]}).slice(0,6).map(function(t){return" '"+t+"' ("+n[t]+")"});return e.concat(r).join("\n")}var s=t("./util"),o=t("./stats");e.exports=function(t,e){if(null==t||0===t.length)return null;e=e||s.keys(t[0]);var n=e.map(function(e){var n=o.profile(t,s.accessor(e));return n.field=e,n});return n.toString=r,n}},{"./stats":18,"./util":21}],20:[function(t,e,n){(function(n){function r(t){var e=i(t,"d");e="var __t; return "+e+";";try{return new Function("d",e).bind(c)}catch(n){throw n.source=e,n}}function i(t,e){e=e||"obj";var n=0,r="'",i=d;return t.replace(i,function(i,o,l){return r+=t.slice(n,l).replace(f,s),n=l+i.length,o&&(r+="'\n+((__t=("+a(o,e)+"))==null?'':__t)+\n'"),i}),r+"'"}function a(t,e){function n(t){return t=t||"",a?(a=!1,s="String("+s+")"+t):s+=t,s}var r=t.split("|"),i=r.shift().trim(),a=!0,s=l.field(i).map(l.str).join("][");s=e+"["+s+"]";for(var c=0;c<r.length;++c){var d,h,f,p=r[c],g=null;switch((d=p.indexOf(":"))>0&&(p=p.slice(0,d),g=r[c].slice(d+1).split(",").map(function(t){return t.trim()})),p=p.trim()){case"length":n(".length");break;case"lower":n(".toLowerCase()");break;case"upper":n(".toUpperCase()");break;case"lower-locale":n(".toLocaleLowerCase()");break;case"upper-locale":n(".toLocaleUpperCase()");break;case"trim":n(".trim()");break;case"left":h=l.number(g[0]),n(".slice(0,"+h+")");break;case"right":h=l.number(g[0]),n(".slice(-"+h+")");break;case"mid":h=l.number(g[0]),f=h+l.number(g[1]),n(".slice(+"+h+","+f+")");break;case"slice":h=l.number(g[0]),n(".slice("+h+(g.length>1?","+l.number(g[1]):"")+")");break;case"truncate":h=l.number(g[0]),f=g[1],f="left"!==f&&"middle"!==f&&"center"!==f?"right":f,s="this.truncate("+n()+","+h+',"'+f+'")';break;case"number":h=o(g[0],u.format),a=!1,s="this.formats["+h+"]("+s+")";break;case"time":h=o(g[0],u.time.format),a=!1,s="this.formats["+h+"]("+s+")";break;default:throw Error("Unrecognized template filter: "+p)}}return s}function s(t){return"\\"+h[t]}function o(t,e){if(!("'"===t[0]&&"'"===t[t.length-1]||'"'!==t[0]&&'"'===t[t.length-1]))throw Error("Format pattern must be quoted: "+t);if(t=t.slice(1,-1),!c.format_map[t]){var n=e(t),r=c.formats.length;c.formats.push(n),c.format_map[t]=r}return c.format_map[t]}var l=t("./util"),u="undefined"!=typeof window?window.d3:"undefined"!=typeof n?n.d3:null,c={formats:[],format_map:{},truncate:l.truncate};e.exports=r,r.clearFormatCache=function(){c.formats=[],c.format_map={}};var d=/\{\{(.+?)\}\}|$/g,h={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},f=/\\|'|\r|\n|\u2028|\u2029/g}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./util":21}],21:[function(t,e,n){(function(n){function r(t){return t.replace(l,"$1\\'")}function i(t,e,n){var r=0,i=t.split(u);return t=n?(i=i.reverse()).filter(function(t){return r+=t.length,e>=r}).reverse():i.filter(function(t){return r+=t.length,e>=r}),t.length?t.join("").trim():i[0].slice(0,e)}var a=t("buffer").Buffer,s=e.exports={};s.isNode="undefined"!=typeof n&&"undefined"!=typeof n.stderr;var o=Object.prototype.toString;s.isObject=function(t){return t===Object(t)},s.isFunction=function(t){return"[object Function]"==o.call(t)},s.isString=function(t){return"[object String]"==o.call(t)},s.isArray=Array.isArray||function(t){return"[object Array]"==o.call(t)},s.isNumber=function(t){return!isNaN(parseFloat(t))&&isFinite(t)},s.isBoolean=function(t){return"[object Boolean]"==o.call(t)},s.isDate=function(t){return"[object Date]"==o.call(t)},s.isNotNull=function(t){return null!=t&&("number"!=typeof t?!0:!isNaN(t))},s.isBuffer=a&&a.isBuffer||s["false"],s.number=function(t){return null==t?null:+t},s["boolean"]=function(t){return null==t?null:"false"===t?!1:!!t},s.date=function(t){return null==t?null:Date.parse(t)},s.array=function(t){return null!=t?s.isArray(t)?t:[t]:[]},s.str=function(t){return s.isArray(t)?"["+t.map(s.str)+"]":s.isObject(t)?JSON.stringify(t):s.isString(t)?"'"+r(t)+"'":t};var l=/(^|[^\\])'/g;s.identity=function(t){return t},s["true"]=function(){return!0},s["false"]=function(){return!1},s.duplicate=function(t){return JSON.parse(JSON.stringify(t))},s.equal=function(t,e){return JSON.stringify(t)===JSON.stringify(e)},s.extend=function(t){for(var e,n,r=1,i=arguments.length;i>r;++r){e=arguments[r];for(n in e)t[n]=e[n]}return t},s.keys=function(t){var e,n=[];for(e in t)n.push(e);return n},s.vals=function(t){var e,n=[];for(e in t)n.push(t[e]);return n},s.toMap=function(t){return t.reduce(function(t,e){return t[e]=1,t},{})},s.keystr=function(t){return t.join("|")},s.field=function(t){return t.split("\\.").map(function(t){return t.split(".")}).reduce(function(t,e){return t.length&&(t[t.length-1]+="."+e.shift()),t.push.apply(t,e),t},[])},s.accessor=function(t){var e;return s.isFunction(t)||null==t?t:s.isString(t)&&(e=s.field(t)).length>1?function(t){return e.reduce(function(t,e){return t[e]},t)}:function(e){return e[t]}},s.mutator=function(t){var e;return s.isString(t)&&(e=s.field(t)).length>1?function(t,n){for(var r=0;r<e.length-1;++r)t=t[e[r]];t[e[r]]=n}:function(e,n){e[t]=n}},s.comparator=function(t){var e=[];return void 0===t&&(t=[]),t=s.array(t).map(function(t){var n=1;return"-"===t[0]?(n=-1,t=t.slice(1)):"+"===t[0]&&(n=1,t=t.slice(1)),e.push(n),s.accessor(t)}),function(n,r){var i,a,s,o,l;for(i=0,a=t.length;a>i;++i){if(s=t[i],o=s(n),l=s(r),l>o)return-1*e[i];if(o>l)return e[i]}return 0}},s.cmp=function(t,e){return e>t?-1:t>e?1:t>=e?0:null===t&&null===e?0:null===t?-1:null===e?1:0/0},s.numcmp=function(t,e){return t-e},s.stablesort=function(t,e,n){var r=t.reduce(function(t,e,r){return t[n(e)]=r,t},{});return t.sort(function(t,i){var a=e(t),s=e(i);return s>a?-1:a>s?1:r[n(t)]-r[n(i)]}),t},s.startsWith=String.prototype.startsWith?function(t,e){return t.startsWith(e)}:function(t,e){return 0===t.lastIndexOf(e,0)},s.truncate=function(t,e,n,r,a){var s=t.length;if(e>=s)return t;a=void 0!==a?String(a):"…";var o=Math.max(0,e-a.length);switch(n){case"left":return a+(r?i(t,o,1):t.slice(s-o));case"middle":case"center":var l=Math.ceil(o/2),u=Math.floor(o/2);return(r?i(t,l):t.slice(0,l))+a+(r?i(t,u,1):t.slice(s-u));default:return(r?i(t,o):t.slice(0,o))+a}};var u=/([\u0009\u000A\u000B\u000C\u000D\u0020\u00A0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u2028\u2029\u3000\uFEFF])/}).call(this,t("_process"))},{_process:3,buffer:2}],22:[function(t,e,n){e.exports=t("./lib/heap")},{"./lib/heap":23}],23:[function(e,n,r){(function(){var e,i,a,s,o,l,u,c,d,h,f,p,g,m,v;a=Math.floor,h=Math.min,i=function(t,e){return e>t?-1:t>e?1:0},d=function(t,e,n,r,s){var o;if(null==n&&(n=0),null==s&&(s=i),0>n)throw new Error("lo must be non-negative");for(null==r&&(r=t.length);r>n;)o=a((n+r)/2),s(e,t[o])<0?r=o:n=o+1;return[].splice.apply(t,[n,n-n].concat(e)),e},l=function(t,e,n){return null==n&&(n=i),t.push(e),m(t,0,t.length-1,n)},o=function(t,e){var n,r;return null==e&&(e=i),n=t.pop(),t.length?(r=t[0],t[0]=n,v(t,0,e)):r=n,r},c=function(t,e,n){var r;return null==n&&(n=i),r=t[0],t[0]=e,v(t,0,n),r},u=function(t,e,n){var r;return null==n&&(n=i),t.length&&n(t[0],e)<0&&(r=[t[0],e],e=r[0],t[0]=r[1],v(t,0,n)),e},s=function(t,e){var n,r,s,o,l,u;for(null==e&&(e=i),o=function(){u=[];for(var e=0,n=a(t.length/2);n>=0?n>e:e>n;n>=0?e++:e--)u.push(e);return u}.apply(this).reverse(),l=[],r=0,s=o.length;s>r;r++)n=o[r],l.push(v(t,n,e));return l},g=function(t,e,n){var r;return null==n&&(n=i),r=t.indexOf(e),-1!==r?(m(t,0,r,n),v(t,r,n)):void 0},f=function(t,e,n){var r,a,o,l,c;if(null==n&&(n=i),a=t.slice(0,e),!a.length)return a;for(s(a,n),c=t.slice(e),o=0,l=c.length;l>o;o++)r=c[o],u(a,r,n);return a.sort(n).reverse()},p=function(t,e,n){var r,a,l,u,c,f,p,g,m,v;if(null==n&&(n=i),10*e<=t.length){if(u=t.slice(0,e).sort(n),!u.length)return u;for(l=u[u.length-1],g=t.slice(e),c=0,p=g.length;p>c;c++)r=g[c],n(r,l)<0&&(d(u,r,0,null,n),u.pop(),l=u[u.length-1]);return u}for(s(t,n),v=[],a=f=0,m=h(e,t.length);m>=0?m>f:f>m;a=m>=0?++f:--f)v.push(o(t,n));return v},m=function(t,e,n,r){var a,s,o;for(null==r&&(r=i),a=t[n];n>e&&(o=n-1>>1,s=t[o],r(a,s)<0);)t[n]=s,n=o;return t[n]=a},v=function(t,e,n){var r,a,s,o,l;for(null==n&&(n=i),a=t.length,l=e,s=t[e],r=2*e+1;a>r;)o=r+1,a>o&&!(n(t[r],t[o])<0)&&(r=o),t[e]=t[r],e=r,r=2*e+1;return t[e]=s,m(t,l,e,n)},e=function(){function t(t){this.cmp=null!=t?t:i,this.nodes=[]}return t.push=l,t.pop=o,t.replace=c,t.pushpop=u,t.heapify=s,t.updateItem=g,t.nlargest=f,t.nsmallest=p,t.prototype.push=function(t){return l(this.nodes,t,this.cmp)},t.prototype.pop=function(){return o(this.nodes,this.cmp)},t.prototype.peek=function(){return this.nodes[0]},t.prototype.contains=function(t){return-1!==this.nodes.indexOf(t)},t.prototype.replace=function(t){return c(this.nodes,t,this.cmp)},t.prototype.pushpop=function(t){return u(this.nodes,t,this.cmp)},t.prototype.heapify=function(){return s(this.nodes,this.cmp)},t.prototype.updateItem=function(t){return g(this.nodes,t,this.cmp)},t.prototype.clear=function(){return this.nodes=[]},t.prototype.empty=function(){return 0===this.nodes.length},t.prototype.size=function(){return this.nodes.length},t.prototype.clone=function(){var e;return e=new t,e.nodes=this.nodes.slice(0),e},t.prototype.toArray=function(){return this.nodes.slice(0)},t.prototype.insert=t.prototype.push,t.prototype.top=t.prototype.peek,t.prototype.front=t.prototype.peek,t.prototype.has=t.prototype.contains,t.prototype.copy=t.prototype.clone,t}(),function(e,i){return"function"==typeof t&&t.amd?t([],i):"object"==typeof r?n.exports=i():e.Heap=i()}(this,function(){return e})}).call(this)},{}],24:[function(t,e,n){var r=function(t){this.clear(),t&&this.union(t)},i=r.prototype;i.clear=function(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this},i.set=function(t,e,n,r){return this.x1=t,this.y1=e,this.x2=n,this.y2=r,this},i.add=function(t,e){return t<this.x1&&(this.x1=t),e<this.y1&&(this.y1=e),t>this.x2&&(this.x2=t),e>this.y2&&(this.y2=e),this},i.expand=function(t){return this.x1-=t,this.y1-=t,this.x2+=t,this.y2+=t,this},i.round=function(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this},i.translate=function(t,e){return this.x1+=t,this.x2+=t,this.y1+=e,this.y2+=e,this},i.rotate=function(t,e,n){var r=Math.cos(t),i=Math.sin(t),a=e-e*r+n*i,s=n-e*i-n*r,o=this.x1,l=this.x2,u=this.y1,c=this.y2;return this.clear().add(r*o-i*u+a,i*o+r*u+s).add(r*o-i*c+a,i*o+r*c+s).add(r*l-i*u+a,i*l+r*u+s).add(r*l-i*c+a,i*l+r*c+s)},i.union=function(t){return t.x1<this.x1&&(this.x1=t.x1),t.y1<this.y1&&(this.y1=t.y1),t.x2>this.x2&&(this.x2=t.x2),t.y2>this.y2&&(this.y2=t.y2),this},i.encloses=function(t){return t&&this.x1<=t.x1&&this.x2>=t.x2&&this.y1<=t.y1&&this.y2>=t.y2},i.intersects=function(t){return t&&!(this.x2<t.x1||this.x1>t.x2||this.y2<t.y1||this.y1>t.y2)},i.contains=function(t,e){return!(t<this.x1||t>this.x2||e<this.y1||e>this.y2)},i.width=function(){return this.x2-this.x1},i.height=function(){return this.y2-this.y1},e.exports=r},{}],25:[function(t,e,n){function r(){this._defs={},this._predicates={},this._scene=null,this.graph=new a,this._node=new s(this.graph),this._builder=null}function i(t){var e=this,n={};return u.isArray(t)?(t.forEach(function(t){n[t]=e._predicates[t]}),n):this._predicates[t]}var a=t("../dataflow/Graph"),s=t("../dataflow/Node"),o=t("../scene/GroupBuilder"),l=t("../dataflow/changeset"),u=t("datalib"),c=r.prototype;c.defs=function(t){return arguments.length?(this._defs=t,this):this._defs},c.data=function(){var t=this.graph.data.apply(this.graph,arguments);return arguments.length>1&&this._node.addListener(t.pipeline()[0]),t},c.predicate=function(t,e){return 1===arguments.length?i.call(this,t):this._predicates[t]=e},c.predicates=function(){return this._predicates},c.scene=function(t){if(!arguments.length)return this._scene;this._builder&&this._node.removeListener(this._builder.disconnect()),this._builder=new o(this,this._defs.marks,this._scene={}),this._node.addListener(this._builder.connect());var e=this._builder.pipeline();return e[e.length-1].addListener(t),this},c.addListener=function(t){this._node.addListener(t)},c.removeListener=function(t){this._node.removeListener(t)},c.fire=function(t){t||(t=l.create()),this.graph.propagate(t,this._node)},e.exports=r},{"../dataflow/Graph":29,"../dataflow/Node":30,"../dataflow/changeset":32,"../scene/GroupBuilder":66,datalib:17}],26:[function(t,e,n){(function(n){var r="undefined"!=typeof window?window.d3:"undefined"!=typeof n?n.d3:null,i=t("datalib"),a=t("../dataflow/Node"),s=t("../parse/streams"),o=t("../render/canvas/index"),l=t("../render/svg/index"),u=t("../scene/Transition"),c=t("../util/config"),d=t("../util/debug"),h=t("../dataflow/changeset"),f=function(t,e,n,r){this._el=null,this._model=null,this._width=this.__width=e||500,this._height=this.__height=n||300,this._autopad=1,this._padding={top:0,left:0,bottom:0,right:0},this._viewport=null,this._renderer=null,this._handler=null,this._io=o,t&&this.initialize(t)},p=f.prototype;p.model=function(t){return arguments.length?(this._model!==t&&(this._model=t,this._handler&&this._handler.model(t)),this):this._model},p.data=function(t){var e=this.model();return arguments.length?(i.keys(t).forEach(function(n){e.data(n).add(i.duplicate(t[n]))}),this):e.data()},p.width=function(t){
return arguments.length?(this.__width!==t&&(this._width=this.__width=t,this._el&&this.initialize(this._el.parentNode),this._strict&&(this._autopad=1)),this):this.__width},p.height=function(t){return arguments.length?(this.__height!==t&&(this._height=this.__height=t,this._el&&this.initialize(this._el.parentNode),this._strict&&(this._autopad=1)),this):this.__height},p.padding=function(t){return arguments.length?(this._padding!==t&&(i.isString(t)?(this._autopad=1,this._padding={top:0,left:0,bottom:0,right:0},this._strict="strict"===t):(this._autopad=0,this._padding=t,this._strict=!1),this._el&&(this._renderer.resize(this._width,this._height,t),this._handler.padding(t))),this):this._padding},p.autopad=function(t){if(this._autopad<1)return this;this._autopad=0;var e=this._padding,n=this.model().scene().bounds,r=c.autopadInset,i=n.x1<0?Math.ceil(-n.x1)+r:0,a=n.y1<0?Math.ceil(-n.y1)+r:0,s=n.x2>this._width?Math.ceil(+n.x2-this._width)+r:0,n=n.y2>this._height?Math.ceil(+n.y2-this._height)+r:0;return e={left:i,top:a,right:s,bottom:n},this._strict?(this._autopad=0,this._padding=e,this._width=Math.max(0,this.__width-(i+s)),this._height=Math.max(0,this.__height-(a+n)),this._model.width(this._width),this._model.height(this._height),this._el&&this.initialize(this._el.parentNode),this.update()):this.padding(e).update(t),this},p.viewport=function(t){return arguments.length?(this._viewport!==t&&(this._viewport=t,this._el&&this.initialize(this._el.parentNode)),this):this._viewport},p.renderer=function(t){return arguments.length?("canvas"===t&&(t=o),"svg"===t&&(t=l),this._io!==t&&(this._io=t,this._renderer=null,this._el&&this.initialize(this._el.parentNode),this._build&&this.render()),this):this._io},p.initialize=function(t){var e,n=this,i=n._width,a=n._height,o=n._padding;return r.select(t).select("div.vega").remove(),this._el=t=r.select(t).append("div").attr("class","vega").style("position","relative").node(),n._viewport&&r.select(t).style("width",(n._viewport[0]||i)+"px").style("height",(n._viewport[1]||a)+"px").style("overflow","auto"),n._renderer=(n._renderer||new this._io.Renderer).initialize(t,i,a,o),e=n._handler,n._handler=(new this._io.Handler).initialize(t,o,n).model(n._model),e?e.handlers().forEach(function(t){n._handler.on(t.type,t.handler)}):s(this),this},p.update=function(t){t=t||{};var e=this,n=t.duration?new u(t.duration,t.ease):null,r=h.create();return n&&(r.trans=n),void 0!==t.reflow&&(r.reflow=t.reflow),e._build||(e._renderNode=new a(e._model.graph).router(!0),e._renderNode.evaluate=function(t){d(t,["rendering"]);var n=e._model.scene();t.trans?t.trans.start(function(t){e._renderer.render(n,t)}):e._renderer.render(n);var r,i;for(r in t.data)i=e._model.data(r),i.revises()&&h.finalize(i.last());return t},e._model.scene(e._renderNode),e._build=!0),e._model.fire(r),e.autopad(t)},p.on=function(){return this._handler.on.apply(this._handler,arguments),this},p.off=function(){return this._handler.off.apply(this._handler,arguments),this},f.factory=function(t){return function(e){e=e||{};var n=t.defs(),r=(new f).model(t).width(n.width).height(n.height).padding(n.padding).renderer(e.renderer||"canvas");return e.el&&r.initialize(e.el),e.data&&r.data(e.data),r}},e.exports=f}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../dataflow/Node":30,"../dataflow/changeset":32,"../parse/streams":52,"../render/canvas/index":56,"../render/svg/index":61,"../scene/Transition":69,"../util/config":95,"../util/debug":97,datalib:17}],27:[function(t,e,n){function r(t){return i.prototype.init.call(this,t),this._data=[],this.router(!0).collector(!0)}var i=t("./Node"),a=t("./changeset"),s=t("../util/debug"),o=(t("../util/constants"),r.prototype=new i);o.data=function(){return this._data},o.evaluate=function(t){if(s(t,["collecting"]),t.reflow)return t=a.create(t),t.mod=this._data.slice(),t;if(t.rem.length){var e=t.rem.reduce(function(t,e){return t[e._id]=1,t},{});this._data=this._data.filter(function(t){return 1!==e[t._id]})}return t.add.length&&(this._data=this._data.length?this._data.concat(t.add):t.add),t.sort&&this._data.sort(t.sort),t},e.exports=r},{"../util/constants":96,"../util/debug":97,"./Node":30,"./changeset":32}],28:[function(t,e,n){function r(t,e,n){this._graph=t,this._name=e,this._data=[],this._source=null,this._facet=n,this._input=s.create(),this._output=null,this._pipeline=null,this._collector=null,this._revises=!1}function i(t){void 0===t._prev&&(t._prev=d.SENTINEL)}var a=t("datalib"),s=t("./changeset"),o=t("./tuple"),l=t("./Node"),u=t("./Collector"),c=t("../util/debug"),d=t("../util/constants"),h=r.prototype;h.name=function(t){return arguments.length?(this._name=t,this):this._name},h.source=function(t){return arguments.length?this._source=this._graph.data(t):this._source},h.add=function(t){var e=this._revises?null:void 0;return this._input.add=this._input.add.concat(a.array(t).map(function(t){return o.ingest(t,e)})),this},h.remove=function(t){var e=this._data.filter(t);return this._input.rem=this._input.rem.concat(e),this},h.update=function(t,e,n){{var r=this._input.mod,i=o.idMap(r);this._revises?null:void 0}return this._input.fields[e]=1,this._data.filter(t).forEach(function(t){var a=t[e],s=n(t);a!==s&&(o.set(t,e,s),1!==i[t._id]&&(r.push(t),i[t._id]=1))}),this},h.values=function(t){return arguments.length?(this._input.rem=this._data.slice(),t&&this.add(t),this):this._collector?this._collector.data():this._data},h.revises=function(t){return arguments.length?(!this._revises&&t&&(this._data.forEach(i),this._input.add.forEach(i)),this._revises=this._revises||t,this):this._revises},h.last=function(){return this._output},h.fire=function(t){t&&(this._input=t),this._graph.propagate(this._input,this._pipeline[0])},h.pipeline=function(t){var e=this;if(!arguments.length)return this._pipeline;t.length&&(e._collector=new u(this._graph),t.push(e._collector),e._revises=t.some(function(t){return t.revises()}));var n=new l(this._graph).router(!0).collector(!0);n.evaluate=function(t){c(t,["input",e._name]);var n,r=e._input,i=s.create(t);return a.keys(r.fields).forEach(function(t){i.fields[t]=1}),t.reflow?i.mod=e._data.slice():(r.rem.length&&(n=o.idMap(r.rem),e._data=e._data.filter(function(t){return 1!==n[t._id]})),r.add.length&&(e._data=e._data.concat(r.add)),e._input=s.create(),i.add=r.add,i.mod=r.mod,i.rem=r.rem),i.facet=e._facet,i},t.unshift(n);var r=new l(this._graph).router(!0).collector(!0);return r.evaluate=function(t){c(t,["output",e._name]);var n=s.create(t,!0);return e._facet&&(e._facet.values=e.values(),t.facet=null),e._output=t,n.data[e._name]=1,n},t.push(r),this._pipeline=t,this._graph.connect(e._pipeline),this},h.listener=function(){var t=new l(this._graph).router(!0),e=this,n=this._revises?null:void 0;return t.evaluate=function(t){e._srcMap=e._srcMap||{};var r=e._srcMap,i=s.create(t);return i.add=t.add.map(function(t){return r[t._id]=o.derive(t,void 0!==t._prev?t._prev:n)}),i.mod=t.mod.map(function(t){return r[t._id]}),i.rem=t.rem.map(function(t){var e=r[t._id];return r[t._id]=null,e}),e._input=i},t.addListener(this._pipeline[0]),t},h.addListener=function(t){return t instanceof r?this._collector?this._collector.addListener(t.listener()):this._pipeline[0].addListener(t.listener()):this._pipeline[this._pipeline.length-1].addListener(t),this},h.removeListener=function(t){this._pipeline[this._pipeline.length-1].removeListener(t)},h.listeners=function(t){return t?this._collector?this._collector.listeners():this._pipeline[0].listeners():this._pipeline[this._pipeline.length-1].listeners()},e.exports=r},{"../util/constants":96,"../util/debug":97,"./Collector":27,"./Node":30,"./changeset":32,"./tuple":33,datalib:17}],29:[function(t,e,n){function r(){this._stamp=0,this._rank=0,this._data={},this._signals={},this.doNotPropagate={}}function i(t){var e=this;return s.isArray(t)?t.map(function(t){e._signals[t]}):this._signals[t]}function a(t,e){var n,r,i,a;for(i=0,a=t.length;a>i;++i)n=t[i],n.collector()&&(r=n),e(n,r,i)}var s=t("datalib"),o=t("heap"),l=t("./Datasource"),u=t("./Signal"),c=(t("./changeset"),t("../util/debug")),d=t("../util/constants"),h=r.prototype;h.data=function(t,e,n){return 1===arguments.length?this._data[t]:this._data[t]=new l(this,t,n).pipeline(e)},h.signal=function(t,e){return 1===arguments.length?i.call(this,t):this._signals[t]=new u(this,t,e)},h.signalValues=function(t){var e=this;return s.isArray(t)?t.reduce(function(t,n){return t[n]=e._signals[n].value(),t},{}):this._signals[t].value()},h.signalRef=function(t){s.isArray(t)||(t=s.field(t));var e=this.signal(t.shift()).value();if(t.length>0){var n=Function("s","return s["+t.map(s.str).join("][")+"]");e=n.call(null,e)}return e};var f=function(t,e){return t.rank==e.rank?t.pulse.reflow?1:-1:t.rank-e.rank};h.propagate=function(t,e){var n,r,i,a,s,l,u,d,h=new o(f);if(t.stamp)throw"Pulse already has a non-zero stamp";for(t.stamp=++this._stamp,h.push({node:e,pulse:t,rank:e.rank()});h.size()>0;)if(n=h.pop(),i=n.node,a=n.pulse,s=n.rank,r=i._listeners,d=a.reflow&&i.last()>=a.stamp,!d)if(s==i.rank()){if(a=this.evaluate(a,i),a!==this.doNotPropagate)for(l=0,u=r.length;u>l;l++)h.push({node:r[l],pulse:a,rank:r[l]._rank})}else c(a,["Rank mismatch",s,i.rank()]),h.push({node:i,pulse:a,rank:i.rank()})},h.connect=function(t){c({},["connecting"]);var e=this;return a(t,function(n,r,i){var a=n.dependency(d.DATA),s=n.dependency(d.SIGNALS);a.length>0&&a.forEach(function(t){e.data(t).revises(n.revises()).addListener(r)}),s.length>0&&s.forEach(function(t){e.signal(t).addListener(r)}),i>0&&t[i-1].addListener(t[i])}),t},h.disconnect=function(t){c({},["disconnecting"]);var e=this;return a(t,function(t,n,r){var i=t.dependency(d.DATA),a=t.dependency(d.SIGNALS);i.length>0&&i.forEach(function(t){e.data(t).removeListener(n)}),a.length>0&&a.forEach(function(t){e.signal(t).removeListener(n)}),t.disconnect()}),t},h.reevaluate=function(t,e){var n=!t.reflow||t.reflow&&e.last()>=t.stamp,r=!!t.add.length||!!t.rem.length||e.router();return r=r||!n,r||e.reevaluate(t)},h.evaluate=function(t,e){return this.reevaluate(t,e)?(t=e.evaluate(t),e.last(t.stamp),t):t},e.exports=r},{"../util/constants":96,"../util/debug":97,"./Datasource":28,"./Signal":31,"./changeset":32,datalib:17,heap:22}],30:[function(t,e,n){function r(t){return t&&this.init(t),this}var i=t("datalib"),a=t("../util/constants"),s=[a.DATA,a.FIELDS,a.SCALES,a.SIGNALS],o=1,l=r.prototype;l.init=function(t){return this._id=o++,this._graph=t,this._rank=++t._rank,this._stamp=0,this._listeners=[],this._registered={},this._deps={data:[],fields:[],scales:[],signals:[]},this._isRouter=!1,this._isCollector=!1,this._revises=!1,this},l.clone=function(){var t=new r(this._graph);return t.evaluate=this.evaluate,t._deps=this._deps,t._isRouter=this._isRouter,t._isCollector=this._isCollector,t},l.rank=function(){return this._rank},l.last=function(t){return arguments.length?(this._stamp=t,this):this._stamp},l.dependency=function(t,e){var n=this._deps[t];if(1===arguments.length)return n;if(null===e)for(;n.length>0;)n.pop();else!i.isArray(e)&&n.indexOf(e)<0?n.push(e):n.push.apply(n,i.array(e));return this},l.router=function(t){return arguments.length?(this._isRouter=!!t,this):this._isRouter},l.collector=function(t){return arguments.length?(this._isCollector=!!t,this):this._isCollector},l.revises=function(t){return arguments.length?(this._revises=!!t,this):this._revises},l.listeners=function(){return this._listeners},l.addListener=function(t){if(!(t instanceof r))throw"Listener is not a Node";if(this._registered[t._id])return this;if(this._listeners.push(t),this._registered[t._id]=1,this._rank>t._rank)for(var e=[t];e.length;){var n=e.splice(0,1)[0];n._rank=++this._graph._rank,e.push.apply(e,n._listeners)}return this},l.removeListener=function(t){for(var e=!1,n=0,r=this._listeners.length;r>n&&!e;n++)this._listeners[n]===t&&(this._listeners.splice(n,1),this._registered[t._id]=null,e=!0);return e},l.disconnect=function(){this._listeners=[],this._registered={}},l.evaluate=function(t){return t},l.reevaluate=function(t){var e=this,n=!1;return s.some(function(r){return n=n||e._deps[r].some(function(e){return!!t[r][e]})})},e.exports=r},{"../util/constants":96,datalib:17}],31:[function(t,e,n){function r(t,e,n){return i.prototype.init.call(this,t),this._name=e,this._value=n,this}var i=t("./Node"),a=t("./changeset"),s=r.prototype=new i;s.name=function(){return this._name},s.value=function(t){return arguments.length?(this._value=t,this):this._value},s.fire=function(t){t||(t=a.create(null,!0)),t.signals[this._name]=1,this._graph.propagate(t,this)},e.exports=r},{"./Node":30,"./changeset":32}],32:[function(t,e,n){function r(t,e){var n={};return o(t,n),n.add=[],n.mod=[],n.rem=[],n.reflow=e,n}function a(t){t._prev=void 0===t._prev?void 0:l.SENTINEL}function s(t){for(i=0,len=t.add.length;i<len;++i)a(t.add[i]);for(i=0,len=t.mod.length;i<len;++i)a(t.mod[i])}function o(t,e){e.stamp=t?t.stamp:0,e.sort=t?t.sort:null,e.facet=t?t.facet:null,e.trans=t?t.trans:null,u.forEach(function(n){e[n]=t?t[n]:{}})}var l=t("../util/constants"),u=[l.DATA,l.FIELDS,l.SCALES,l.SIGNALS];e.exports={create:r,copy:o,finalize:s}},{"../util/constants":96}],33:[function(t,e,n){function r(t,e){return t=u.isObject(t)?t:{data:t},t._id=d++,t._prev=void 0!==e?e||c.SENTINEL:void 0,t}function i(t,e){return r(Object.create(t),e)}function a(t,e,n){var r=t[e];r!==n&&(s(t,e),t[e]=n)}function s(t,e){void 0!==t._prev&&(t._prev=t._prev===c.SENTINEL?{}:t._prev,t._prev[e]=t[e])}function o(){d=1}function l(t){return t.reduce(function(t,e){return t[e._id]=1,t},{})}var u=t("datalib"),c=t("../util/constants"),d=1;e.exports={ingest:r,derive:i,set:a,prev:s,reset:o,idMap:l}},{"../util/constants":96,datalib:17}],34:[function(t,e,n){var r=t("datalib");e.exports=function(e){function n(t){var e={fn:i(t),signals:r.keys(h),fields:r.keys(f)};return h={},f={},e}function i(t){if(t instanceof String)return t;var e=p[t.type];if(null==e)throw new Error("Unsupported type: "+t.type);return e(t)}e=e||{};var a=e.constants||t("./constants"),s=(e.functions||t("./functions"))(i),o=e.idWhiteList?r.toMap(e.idWhiteList):null,l=e.idBlackList?r.toMap(e.idBlackList):null,u=0,c="d",d="sg.",h={},f={},p={Literal:function(t){return t.raw},Identifier:function(t){var e=t.name;if(u>0)return e;if(a.hasOwnProperty(e))return a[e];if(o)return o.hasOwnProperty(e)?e:(h[e]=1,d+e);if(l&&l.hasOwnProperty(e))throw new Error("Illegal identifier: "+e);return e},Program:function(t){return t.body.map(i).join("\n")},MemberExpression:function(t){var e=!t.computed,n=i(t.object);e&&(u+=1);var r=i(t.property);return n===c&&(f[r]=1),e&&(u-=1),n+(e?"."+r:"["+r+"]")},CallExpression:function(t){if("Identifier"!==t.callee.type)throw new Error("Illegal callee type: "+t.callee.type);var e=t.callee.name,n=t.arguments,r=s.hasOwnProperty(e)&&s[e];if(!r)throw new Error("Unrecognized function: "+e);return r instanceof Function?r(n):r+"("+n.map(i).join(",")+")"},ArrayExpression:function(t){return"["+t.elements.map(i).join(",")+"]"},BinaryExpression:function(t){return"("+i(t.left)+t.operator+i(t.right)+")"},UnaryExpression:function(t){return"("+t.operator+i(t.argument)+")"},UpdateExpression:function(t){return"("+(prefix?t.operator+i(t.argument):i(t.argument)+t.operator)+")"},ConditionalExpression:function(t){return"("+i(t.test)+"?"+i(t.consequent)+":"+i(t.alternate)+")"},LogicalExpression:function(t){return"("+i(t.left)+t.operator+i(t.right)+")"},ObjectExpression:function(t){return"{"+t.properties.map(i).join(",")+"}"},Property:function(t){u+=1;var e=i(t.key);return u-=1,e+":"+i(t.value)},ExpressionStatement:function(t){return i(t.expression)}};return n}},{"./constants":35,"./functions":36,datalib:17}],35:[function(t,e,n){e.exports={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2"}},{}],36:[function(t,e,n){t("datalib");e.exports=function(t){function e(e,n,r,i){var a=t(n[0]);return r&&(a=r+"("+a+")",dl.startsWith(r,"new ")&&(a="("+a+")")),a+"."+e+(0>i?"":0===i?"()":"("+n.slice(1).map(t).join(",")+")")}var n="new Date",r="String",i="RegExp";return{isNaN:"isNaN",isFinite:"isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",now:"Date.now",datetime:"new Date",date:function(t){return e("getDate",t,n,0)},day:function(t){return e("getDay",t,n,0)},year:function(t){return e("getFullYear",t,n,0)},month:function(t){return e("getMonth",t,n,0)},hours:function(t){return e("getHours",t,n,0)},minutes:function(t){return e("getMinutes",t,n,0)},seconds:function(t){return e("getSeconds",t,n,0)},milliseconds:function(t){return e("getMilliseconds",t,n,0)},time:function(t){return e("getTime",t,n,0)},timezoneoffset:function(t){return e("getTimezoneOffset",t,n,0)},utcdate:function(t){return e("getUTCDate",t,n,0)},utcday:function(t){return e("getUTCDay",t,n,0)},utcyear:function(t){return e("getUTCFullYear",t,n,0)},utcmonth:function(t){return e("getUTCMonth",t,n,0)},utchours:function(t){return e("getUTCHours",t,n,0)},utcminutes:function(t){return e("getUTCMinutes",t,n,0)},utcseconds:function(t){return e("getUTCSeconds",t,n,0)},utcmilliseconds:function(t){return e("getUTCMilliseconds",t,n,0)},length:function(t){return e("length",t,null,-1)},indexof:function(t){return e("indexOf",t,null)},lastindexof:function(t){return e("lastIndexOf",t,null)},parseFloat:"parseFloat",parseInt:"parseInt",upper:function(t){return e("toUpperCase",t,r,0)},lower:function(t){return e("toLowerCase",t,r,0)},slice:function(t){return e("slice",t,r)},substring:function(t){return e("substring",t,r)},test:function(t){return e("test",t,i)},"if":function(e){if(e.length<3)throw new Error("Missing arguments to if function.");if(e.length>3)throw new Error("Too many arguments to if function.");var n=e.map(t);return n[0]+"?"+n[1]+":"+n[2]}}}},{datalib:17}],37:[function(t,e,n){var r=t("./parser"),i=t("./codegen");e.exports={parse:function(t,e){return r.parse("("+t+")",e)},code:function(t){return i(t)}}},{"./codegen":34,"./parser":38}],38:[function(t,e,n){e.exports=function(){"use strict";function t(t,e){if(!t)throw new Error("ASSERT: "+e)}function e(t){return t>=48&&57>=t}function n(t){return"0123456789abcdefABCDEF".indexOf(t)>=0}function r(t){return"01234567".indexOf(t)>=0}function i(t){return 32===t||9===t||11===t||12===t||160===t||t>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(t)>=0}function a(t){return 10===t||13===t||8232===t||8233===t}function s(t){return 36===t||95===t||t>=65&&90>=t||t>=97&&122>=t||92===t||t>=128&&Et.NonAsciiIdentifierStart.test(String.fromCharCode(t))}function o(t){return 36===t||95===t||t>=65&&90>=t||t>=97&&122>=t||t>=48&&57>=t||92===t||t>=128&&Et.NonAsciiIdentifierPart.test(String.fromCharCode(t))}function l(t){switch(t){case"class":case"enum":case"export":case"extends":case"import":case"super":return!0;default:return!1}}function u(t){switch(t){case"implements":case"interface":case"package":case"private":case"protected":case"public":case"static":case"yield":case"let":return!0;default:return!1}}function c(t){if(At&&u(t))return!0;switch(t.length){case 2:return"if"===t||"in"===t||"do"===t;case 3:return"var"===t||"for"===t||"new"===t||"try"===t||"let"===t;case 4:return"this"===t||"else"===t||"case"===t||"void"===t||"with"===t||"enum"===t;case 5:return"while"===t||"break"===t||"catch"===t||"throw"===t||"const"===t||"yield"===t||"class"===t||"super"===t;case 6:return"return"===t||"typeof"===t||"delete"===t||"switch"===t||"export"===t||"import"===t;case 7:return"default"===t||"finally"===t||"extends"===t;case 8:return"function"===t||"continue"===t||"debugger"===t;case 10:return"instanceof"===t;default:return!1}}function d(){var t,e;for(e=0===St;Tt>St;)if(t=Lt.charCodeAt(St),i(t))++St;else{if(!a(t))break;++St,13===t&&10===Lt.charCodeAt(St)&&++St,++Mt,Nt=St,e=!0}}function h(t){var e,r,i,a=0;for(r="u"===t?4:2,e=0;r>e;++e){if(!(Tt>St&&n(Lt[St])))return"";i=Lt[St++],a=16*a+"0123456789abcdef".indexOf(i.toLowerCase())}return String.fromCharCode(a)}function f(){var t,e,r,i;for(t=Lt[St],e=0,"}"===t&&U({},kt.UnexpectedToken,"ILLEGAL");Tt>St&&(t=Lt[St++],n(t));)e=16*e+"0123456789abcdef".indexOf(t.toLowerCase());return(e>1114111||"}"!==t)&&U({},kt.UnexpectedToken,"ILLEGAL"),65535>=e?String.fromCharCode(e):(r=(e-65536>>10)+55296,i=(e-65536&1023)+56320,String.fromCharCode(r,i))}function p(){var t,e;for(t=Lt.charCodeAt(St++),e=String.fromCharCode(t),92===t&&(117!==Lt.charCodeAt(St)&&U({},kt.UnexpectedToken,"ILLEGAL"),++St,t=h("u"),t&&"\\"!==t&&s(t.charCodeAt(0))||U({},kt.UnexpectedToken,"ILLEGAL"),e=t);Tt>St&&(t=Lt.charCodeAt(St),o(t));)++St,e+=String.fromCharCode(t),92===t&&(e=e.substr(0,e.length-1),117!==Lt.charCodeAt(St)&&U({},kt.UnexpectedToken,"ILLEGAL"),++St,t=h("u"),t&&"\\"!==t&&o(t.charCodeAt(0))||U({},kt.UnexpectedToken,"ILLEGAL"),e+=t);return e}function g(){var t,e;for(t=St++;Tt>St;){if(e=Lt.charCodeAt(St),92===e)return St=t,p();if(!o(e))break;++St}return Lt.slice(t,St)}function m(){var t,e,n;return t=St,e=92===Lt.charCodeAt(St)?p():g(),n=1===e.length?_t.Identifier:c(e)?_t.Keyword:"null"===e?_t.NullLiteral:"true"===e||"false"===e?_t.BooleanLiteral:_t.Identifier,{type:n,value:e,lineNumber:Mt,lineStart:Nt,start:t,end:St}}function v(){var t,e,n,r,i=St,a=Lt.charCodeAt(St),s=Lt[St];switch(a){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++St,Dt.tokenize&&(40===a?Dt.openParenToken=Dt.tokens.length:123===a&&(Dt.openCurlyToken=Dt.tokens.length)),{type:_t.Punctuator,value:String.fromCharCode(a),lineNumber:Mt,lineStart:Nt,start:i,end:St};default:if(t=Lt.charCodeAt(St+1),61===t)switch(a){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return St+=2,{type:_t.Punctuator,value:String.fromCharCode(a)+String.fromCharCode(t),lineNumber:Mt,lineStart:Nt,start:i,end:St};case 33:case 61:return St+=2,61===Lt.charCodeAt(St)&&++St,{type:_t.Punctuator,value:Lt.slice(i,St),lineNumber:Mt,lineStart:Nt,start:i,end:St}}}return r=Lt.substr(St,4),">>>="===r?(St+=4,{type:_t.Punctuator,value:r,lineNumber:Mt,lineStart:Nt,start:i,end:St}):(n=r.substr(0,3),">>>"===n||"<<="===n||">>="===n?(St+=3,{type:_t.Punctuator,value:n,lineNumber:Mt,lineStart:Nt,start:i,end:St}):(e=n.substr(0,2),s===e[1]&&"+-<>&|".indexOf(s)>=0||"=>"===e?(St+=2,{type:_t.Punctuator,value:e,lineNumber:Mt,lineStart:Nt,start:i,end:St}):"<>=!+-*%&|^/".indexOf(s)>=0?(++St,{type:_t.Punctuator,value:s,lineNumber:Mt,lineStart:Nt,start:i,end:St}):void U({},kt.UnexpectedToken,"ILLEGAL")))}function y(t){for(var e="";Tt>St&&n(Lt[St]);)e+=Lt[St++];return 0===e.length&&U({},kt.UnexpectedToken,"ILLEGAL"),s(Lt.charCodeAt(St))&&U({},kt.UnexpectedToken,"ILLEGAL"),{type:_t.NumericLiteral,value:parseInt("0x"+e,16),lineNumber:Mt,lineStart:Nt,start:t,end:St}}function _(t){for(var n="0"+Lt[St++];Tt>St&&r(Lt[St]);)n+=Lt[St++];return(s(Lt.charCodeAt(St))||e(Lt.charCodeAt(St)))&&U({},kt.UnexpectedToken,"ILLEGAL"),{type:_t.NumericLiteral,value:parseInt(n,8),octal:!0,lineNumber:Mt,lineStart:Nt,start:t,end:St}}function b(){var n,i,a;if(a=Lt[St],t(e(a.charCodeAt(0))||"."===a,"Numeric literal must start with a decimal digit or a decimal point"),i=St,n="","."!==a){if(n=Lt[St++],a=Lt[St],"0"===n){if("x"===a||"X"===a)return++St,y(i);if(r(a))return _(i);a&&e(a.charCodeAt(0))&&U({},kt.UnexpectedToken,"ILLEGAL")}for(;e(Lt.charCodeAt(St));)n+=Lt[St++];a=Lt[St]}if("."===a){for(n+=Lt[St++];e(Lt.charCodeAt(St));)n+=Lt[St++];a=Lt[St]}if("e"===a||"E"===a)if(n+=Lt[St++],a=Lt[St],("+"===a||"-"===a)&&(n+=Lt[St++]),e(Lt.charCodeAt(St)))for(;e(Lt.charCodeAt(St));)n+=Lt[St++];else U({},kt.UnexpectedToken,"ILLEGAL");return s(Lt.charCodeAt(St))&&U({},kt.UnexpectedToken,"ILLEGAL"),{type:_t.NumericLiteral,value:parseFloat(n),lineNumber:Mt,lineStart:Nt,start:i,end:St}}function x(){var e,n,i,s,o,l,u,c,d="",p=!1;for(u=Mt,c=Nt,e=Lt[St],t("'"===e||'"'===e,"String literal must starts with a quote"),n=St,++St;Tt>St;){if(i=Lt[St++],i===e){e="";break}if("\\"===i)if(i=Lt[St++],i&&a(i.charCodeAt(0)))++Mt,"\r"===i&&"\n"===Lt[St]&&++St,Nt=St;else switch(i){case"u":case"x":"{"===Lt[St]?(++St,d+=f()):(l=St,o=h(i),o?d+=o:(St=l,d+=i));break;case"n":d+="\n";break;case"r":d+="\r";break;case"t":d+="	";break;case"b":d+="\b";break;case"f":d+="\f";break;case"v":d+="";break;default:r(i)?(s="01234567".indexOf(i),0!==s&&(p=!0),Tt>St&&r(Lt[St])&&(p=!0,s=8*s+"01234567".indexOf(Lt[St++]),"0123".indexOf(i)>=0&&Tt>St&&r(Lt[St])&&(s=8*s+"01234567".indexOf(Lt[St++]))),d+=String.fromCharCode(s)):d+=i}else{if(a(i.charCodeAt(0)))break;d+=i}}return""!==e&&U({},kt.UnexpectedToken,"ILLEGAL"),{type:_t.StringLiteral,value:d,octal:p,startLineNumber:u,startLineStart:c,lineNumber:Mt,lineStart:Nt,start:n,end:St}}function w(t,e){var n,r=t;e.indexOf("u")>=0&&(r=r.replace(/\\u\{([0-9a-fA-F]+)\}/g,function(t,e){return parseInt(e,16)<=1114111?"x":void U({},kt.InvalidRegExp)}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{n=new RegExp(r)}catch(i){U({},kt.InvalidRegExp)}try{return new RegExp(t,e)}catch(a){return null}}function k(){var e,n,r,i,s;for(e=Lt[St],t("/"===e,"Regular expression literal must start with a slash"),n=Lt[St++],r=!1,i=!1;Tt>St;)if(e=Lt[St++],n+=e,"\\"===e)e=Lt[St++],a(e.charCodeAt(0))&&U({},kt.UnterminatedRegExp),n+=e;else if(a(e.charCodeAt(0)))U({},kt.UnterminatedRegExp);else if(r)"]"===e&&(r=!1);else{if("/"===e){i=!0;break}"["===e&&(r=!0)}return i||U({},kt.UnterminatedRegExp),s=n.substr(1,n.length-2),{value:s,literal:n}}function E(){var t,e,n,r;for(e="",n="";Tt>St&&(t=Lt[St],o(t.charCodeAt(0)));)if(++St,"\\"===t&&Tt>St)if(t=Lt[St],"u"===t){if(++St,r=St,t=h("u"))for(n+=t,e+="\\u";St>r;++r)e+=Lt[r];else St=r,n+="u",e+="\\u";F({},kt.UnexpectedToken,"ILLEGAL")}else e+="\\",F({},kt.UnexpectedToken,"ILLEGAL");else n+=t,e+=t;return{value:n,literal:e}}function L(){var t,e,n,r;return Ct=null,d(),t=St,e=k(),n=E(),r=w(e.value,n.value),Dt.tokenize?{type:_t.RegularExpression,value:r,regex:{pattern:e.value,flags:n.value},lineNumber:Mt,lineStart:Nt,start:t,end:St}:{literal:e.literal+n.literal,value:r,regex:{pattern:e.value,flags:n.value},start:t,end:St}}function A(){var t,e,n,r;return d(),t=St,e={start:{line:Mt,column:St-Nt}},n=L(),e.end={line:Mt,column:St-Nt},Dt.tokenize||(Dt.tokens.length>0&&(r=Dt.tokens[Dt.tokens.length-1],r.range[0]===t&&"Punctuator"===r.type&&("/"===r.value||"/="===r.value)&&Dt.tokens.pop()),Dt.tokens.push({type:"RegularExpression",value:n.literal,regex:n.regex,range:[t,St],loc:e})),n}function S(t){return t.type===_t.Identifier||t.type===_t.Keyword||t.type===_t.BooleanLiteral||t.type===_t.NullLiteral}function M(){var t,e;if(t=Dt.tokens[Dt.tokens.length-1],!t)return A();if("Punctuator"===t.type){if("]"===t.value)return v();if(")"===t.value)return e=Dt.tokens[Dt.openParenToken-1],!e||"Keyword"!==e.type||"if"!==e.value&&"while"!==e.value&&"for"!==e.value&&"with"!==e.value?v():A();if("}"===t.value){if(Dt.tokens[Dt.openCurlyToken-3]&&"Keyword"===Dt.tokens[Dt.openCurlyToken-3].type){if(e=Dt.tokens[Dt.openCurlyToken-4],!e)return v()}else{if(!Dt.tokens[Dt.openCurlyToken-4]||"Keyword"!==Dt.tokens[Dt.openCurlyToken-4].type)return v();if(e=Dt.tokens[Dt.openCurlyToken-5],!e)return A()}return v()}return A()}return"Keyword"===t.type&&"this"!==t.value?A():v()}function N(){var t;return d(),St>=Tt?{type:_t.EOF,lineNumber:Mt,lineStart:Nt,start:St,end:St}:(t=Lt.charCodeAt(St),s(t)?m():40===t||41===t||59===t?v():39===t||34===t?x():46===t?e(Lt.charCodeAt(St+1))?b():v():e(t)?b():Dt.tokenize&&47===t?M():v())}function T(){var t,e,n,r;return d(),t={start:{line:Mt,column:St-Nt}},e=N(),t.end={line:Mt,column:St-Nt},e.type!==_t.EOF&&(n=Lt.slice(e.start,e.end),r={type:bt[e.type],value:n,range:[e.start,e.end],loc:t},e.regex&&(r.regex={pattern:e.regex.pattern,flags:e.regex.flags}),Dt.tokens.push(r)),e}function C(){var t;return t=Ct,St=t.end,Mt=t.lineNumber,Nt=t.lineStart,Ct="undefined"!=typeof Dt.tokens?T():N(),St=t.end,Mt=t.lineNumber,Nt=t.lineStart,t}function I(){var t,e,n;t=St,e=Mt,n=Nt,Ct="undefined"!=typeof Dt.tokens?T():N(),St=t,Mt=e,Nt=n}function D(){this.line=Mt,this.column=St-Nt}function P(){this.start=new D,this.end=null}function O(t){this.start=t.type===_t.StringLiteral?{line:t.startLineNumber,column:t.start-t.startLineStart}:{line:t.lineNumber,column:t.start-t.lineStart},this.end=null}function j(){St=Ct.start,Ct.type===_t.StringLiteral?(Mt=Ct.startLineNumber,Nt=Ct.startLineStart):(Mt=Ct.lineNumber,Nt=Ct.lineStart),Dt.range&&(this.range=[St,0]),Dt.loc&&(this.loc=new P)}function z(t){Dt.range&&(this.range=[t.start,0]),Dt.loc&&(this.loc=new O(t))}function R(){var t,e,n,r;return t=St,e=Mt,n=Nt,d(),r=Mt!==e,St=t,Mt=e,Nt=n,r}function U(e,n){var r,i=Array.prototype.slice.call(arguments,2),a=n.replace(/%(\d)/g,function(e,n){return t(n<i.length,"Message reference must be in range"),i[n]});throw"number"==typeof e.lineNumber?(r=new Error("Line "+e.lineNumber+": "+a),r.index=e.start,r.lineNumber=e.lineNumber,r.column=e.start-Nt+1):(r=new Error("Line "+Mt+": "+a),r.index=St,r.lineNumber=Mt,r.column=St-Nt+1),r.description=a,r}function F(){try{U.apply(null,arguments)}catch(t){if(!Dt.errors)throw t;Dt.errors.push(t)}}function G(t){if(t.type===_t.EOF&&U(t,kt.UnexpectedEOS),t.type===_t.NumericLiteral&&U(t,kt.UnexpectedNumber),t.type===_t.StringLiteral&&U(t,kt.UnexpectedString),t.type===_t.Identifier&&U(t,kt.UnexpectedIdentifier),t.type===_t.Keyword){if(l(t.value))U(t,kt.UnexpectedReserved);else if(At&&u(t.value))return void F(t,kt.StrictReservedWord);U(t,kt.UnexpectedToken,t.value)}U(t,kt.UnexpectedToken,t.value)}function q(t){var e=C();(e.type!==_t.Punctuator||e.value!==t)&&G(e)}function B(t){if(Dt.errors){var e=Ct;e.type!==_t.Punctuator&&e.value!==t?F(e,kt.UnexpectedToken,e.value):C()}else q(t)}function W(t){return Ct.type===_t.Punctuator&&Ct.value===t}function V(t){return Ct.type===_t.Keyword&&Ct.value===t}function H(){var t;return 59===Lt.charCodeAt(St)||W(";")?void C():(t=Mt,d(),void(Mt===t&&(Ct.type===_t.EOF||W("}")||G(Ct))))}function K(){var t=[],e=new j;for(q("[");!W("]");)W(",")?(C(),t.push(null)):(t.push(ut()),W("]")||q(","));return C(),e.finishArrayExpression(t)}function X(){var t,e=new j;return t=C(),t.type===_t.StringLiteral||t.type===_t.NumericLiteral?(At&&t.octal&&F(t,kt.StrictOctalLiteral),e.finishLiteral(t)):e.finishIdentifier(t.value)}function J(){var t,e,n,r,i=new j;return t=Ct,t.type===_t.Identifier?(n=X(),q(":"),r=ut(),i.finishProperty("init",n,r)):t.type!==_t.EOF&&t.type!==_t.Punctuator?(e=X(),q(":"),r=ut(),i.finishProperty("init",e,r)):void G(t)}function Y(){var t,e,n,r,i=[],a={},s=String,o=new j;for(q("{");!W("}");)t=J(),e=t.key.type===xt.Identifier?t.key.name:s(t.key.value),r="init"===t.kind?wt.Data:"get"===t.kind?wt.Get:wt.Set,n="$"+e,Object.prototype.hasOwnProperty.call(a,n)?(a[n]===wt.Data?At&&r===wt.Data?F({},kt.StrictDuplicateProperty):r!==wt.Data&&F({},kt.AccessorDataProperty):r===wt.Data?F({},kt.AccessorDataProperty):a[n]&r&&F({},kt.AccessorGetSet),a[n]|=r):a[n]=r,i.push(t),W("}")||B(",");return q("}"),o.finishObjectExpression(i)}function Q(){var t;return q("("),++It.parenthesisCount,t=ct(),q(")"),t}function Z(){var t,e,n,r;if(W("("))return Q();if(W("["))return K();if(W("{"))return Y();if(t=Ct.type,r=new j,t===_t.Identifier||Pt[Ct.value])n=r.finishIdentifier(C().value);else if(t===_t.StringLiteral||t===_t.NumericLiteral)At&&Ct.octal&&F(Ct,kt.StrictOctalLiteral),n=r.finishLiteral(C());else{if(t===_t.Keyword)throw new Error("Disabled.");t===_t.BooleanLiteral?(e=C(),e.value="true"===e.value,n=r.finishLiteral(e)):t===_t.NullLiteral?(e=C(),e.value=null,n=r.finishLiteral(e)):W("/")||W("/=")?(n=r.finishLiteral("undefined"!=typeof Dt.tokens?A():L()),I()):G(C())}return n}function $(){var t=[];if(q("("),!W(")"))for(;Tt>St&&(t.push(ut()),!W(")"));)B(",");return q(")"),t}function tt(){var t,e=new j;return t=C(),S(t)||G(t),e.finishIdentifier(t.value);

}function et(){return q("."),tt()}function nt(){var t;return q("["),t=ct(),q("]"),t}function rt(){var t,e,n,r,i=It.allowIn;for(r=Ct,It.allowIn=!0,t=Z();;)if(W("."))n=et(),t=new z(r).finishMemberExpression(".",t,n);else if(W("("))e=$(),t=new z(r).finishCallExpression(t,e);else{if(!W("["))break;n=nt(),t=new z(r).finishMemberExpression("[",t,n)}return It.allowIn=i,t}function it(){var t;if(t=rt(),Ct.type===_t.Punctuator&&(W("++")||W("--"))&&!R())throw new Error("Disabled.");return t}function at(){var t,e,n;if(Ct.type!==_t.Punctuator&&Ct.type!==_t.Keyword)e=it();else{if(W("++")||W("--"))throw new Error("Disabled.");if(W("+")||W("-")||W("~")||W("!"))n=Ct,t=C(),e=at(),e=new z(n).finishUnaryExpression(t.value,e);else{if(V("delete")||V("void")||V("typeof"))throw new Error("Disabled.");e=it()}}return e}function st(t,e){var n=0;if(t.type!==_t.Punctuator&&t.type!==_t.Keyword)return 0;switch(t.value){case"||":n=1;break;case"&&":n=2;break;case"|":n=3;break;case"^":n=4;break;case"&":n=5;break;case"==":case"!=":case"===":case"!==":n=6;break;case"<":case">":case"<=":case">=":case"instanceof":n=7;break;case"in":n=e?7:0;break;case"<<":case">>":case">>>":n=8;break;case"+":case"-":n=9;break;case"*":case"/":case"%":n=11}return n}function ot(){var t,e,n,r,i,a,s,o,l,u;if(t=Ct,l=at(),r=Ct,i=st(r,It.allowIn),0===i)return l;for(r.prec=i,C(),e=[t,Ct],s=at(),a=[l,r,s];(i=st(Ct,It.allowIn))>0;){for(;a.length>2&&i<=a[a.length-2].prec;)s=a.pop(),o=a.pop().value,l=a.pop(),e.pop(),n=new z(e[e.length-1]).finishBinaryExpression(o,l,s),a.push(n);r=C(),r.prec=i,a.push(r),e.push(Ct),n=at(),a.push(n)}for(u=a.length-1,n=a[u],e.pop();u>1;)n=new z(e.pop()).finishBinaryExpression(a[u-1].value,a[u-2],n),u-=2;return n}function lt(){var t,e,n,r,i;return i=Ct,t=ot(),W("?")&&(C(),e=It.allowIn,It.allowIn=!0,n=ut(),It.allowIn=e,q(":"),r=ut(),t=new z(i).finishConditionalExpression(t,n,r)),t}function ut(){var t,e,n,r;return t=It.parenthesisCount,r=Ct,e=Ct,n=lt()}function ct(){var t;if(t=ut(),W(","))throw new Error("Disabled.");return t}function dt(t){var e=ct();return H(),t.finishExpressionStatement(e)}function ht(){var t,e,n=Ct.type;if(n===_t.EOF&&G(Ct),n===_t.Punctuator&&"{"===Ct.value)throw new Error("Disabled.");if(e=new j,n===_t.Punctuator)switch(Ct.value){case";":throw new Error("Disabled.");case"(":return dt(e)}else if(n===_t.Keyword)throw new Error("Disabled.");return t=ct(),H(),e.finishExpressionStatement(t)}function ft(){if(Ct.type===_t.Keyword)switch(Ct.value){case"const":case"let":throw new Error("Disabled.");case"function":throw new Error("Disabled.");default:return ht()}return Ct.type!==_t.EOF?ht():void 0}function pt(){for(var t,e,n,r,i=[];Tt>St&&(e=Ct,e.type===_t.StringLiteral)&&(t=ft(),i.push(t),t.expression.type===xt.Literal);)n=Lt.slice(e.start+1,e.end-1),"use strict"===n?(At=!0,r&&F(r,kt.StrictOctalLiteral)):!r&&e.octal&&(r=e);for(;Tt>St&&(t=ft(),"undefined"!=typeof t);)i.push(t);return i}function gt(){var t,e;return d(),I(),e=new j,At=!0,t=pt(),e.finishProgram(t)}function mt(){var t,e,n,r=[];for(t=0;t<Dt.tokens.length;++t)e=Dt.tokens[t],n={type:e.type,value:e.value},e.regex&&(n.regex={pattern:e.regex.pattern,flags:e.regex.flags}),Dt.range&&(n.range=e.range),Dt.loc&&(n.loc=e.loc),r.push(n);Dt.tokens=r}function vt(t,e){var n,r;n=String,"string"==typeof t||t instanceof String||(t=n(t)),Lt=t,St=0,Mt=Lt.length>0?1:0,Nt=0,Tt=Lt.length,Ct=null,It={allowIn:!0,labelSet:{},inFunctionBody:!1,inIteration:!1,inSwitch:!1,lastCommentStart:-1},Dt={},e=e||{},e.tokens=!0,Dt.tokens=[],Dt.tokenize=!0,Dt.openParenToken=-1,Dt.openCurlyToken=-1,Dt.range="boolean"==typeof e.range&&e.range,Dt.loc="boolean"==typeof e.loc&&e.loc,"boolean"==typeof e.tolerant&&e.tolerant&&(Dt.errors=[]);try{if(I(),Ct.type===_t.EOF)return Dt.tokens;for(C();Ct.type!==_t.EOF;)try{C()}catch(i){if(Dt.errors){Dt.errors.push(i);break}throw i}mt(),r=Dt.tokens,"undefined"!=typeof Dt.errors&&(r.errors=Dt.errors)}catch(a){throw a}finally{Dt={}}return r}function yt(t,e){var n,r;r=String,"string"==typeof t||t instanceof String||(t=r(t)),Lt=t,St=0,Mt=Lt.length>0?1:0,Nt=0,Tt=Lt.length,Ct=null,It={allowIn:!0,labelSet:{},parenthesisCount:0,inFunctionBody:!1,inIteration:!1,inSwitch:!1,lastCommentStart:-1},Dt={},"undefined"!=typeof e&&(Dt.range="boolean"==typeof e.range&&e.range,Dt.loc="boolean"==typeof e.loc&&e.loc,Dt.loc&&null!==e.source&&void 0!==e.source&&(Dt.source=r(e.source)),"boolean"==typeof e.tokens&&e.tokens&&(Dt.tokens=[]),"boolean"==typeof e.tolerant&&e.tolerant&&(Dt.errors=[]));try{n=gt(),"undefined"!=typeof Dt.tokens&&(mt(),n.tokens=Dt.tokens),"undefined"!=typeof Dt.errors&&(n.errors=Dt.errors)}catch(i){throw i}finally{Dt={}}return n}var _t,bt,xt,wt,kt,Et,Lt,At,St,Mt,Nt,Tt,Ct,It,Dt;_t={BooleanLiteral:1,EOF:2,Identifier:3,Keyword:4,NullLiteral:5,NumericLiteral:6,Punctuator:7,StringLiteral:8,RegularExpression:9},bt={},bt[_t.BooleanLiteral]="Boolean",bt[_t.EOF]="<end>",bt[_t.Identifier]="Identifier",bt[_t.Keyword]="Keyword",bt[_t.NullLiteral]="Null",bt[_t.NumericLiteral]="Numeric",bt[_t.Punctuator]="Punctuator",bt[_t.StringLiteral]="String",bt[_t.RegularExpression]="RegularExpression",xt={AssignmentExpression:"AssignmentExpression",ArrayExpression:"ArrayExpression",BinaryExpression:"BinaryExpression",CallExpression:"CallExpression",ConditionalExpression:"ConditionalExpression",ExpressionStatement:"ExpressionStatement",Identifier:"Identifier",Literal:"Literal",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",ObjectExpression:"ObjectExpression",Program:"Program",Property:"Property",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression"},wt={Data:1,Get:2,Set:4},kt={UnexpectedToken:"Unexpected token %0",UnexpectedNumber:"Unexpected number",UnexpectedString:"Unexpected string",UnexpectedIdentifier:"Unexpected identifier",UnexpectedReserved:"Unexpected reserved word",UnexpectedEOS:"Unexpected end of input",NewlineAfterThrow:"Illegal newline after throw",InvalidRegExp:"Invalid regular expression",UnterminatedRegExp:"Invalid regular expression: missing /",InvalidLHSInAssignment:"Invalid left-hand side in assignment",InvalidLHSInForIn:"Invalid left-hand side in for-in",MultipleDefaultsInSwitch:"More than one default clause in switch statement",NoCatchOrFinally:"Missing catch or finally after try",UnknownLabel:"Undefined label '%0'",Redeclaration:"%0 '%1' has already been declared",IllegalContinue:"Illegal continue statement",IllegalBreak:"Illegal break statement",IllegalReturn:"Illegal return statement",StrictModeWith:"Strict mode code may not include a with statement",StrictCatchVariable:"Catch variable may not be eval or arguments in strict mode",StrictVarName:"Variable name may not be eval or arguments in strict mode",StrictParamName:"Parameter name eval or arguments is not allowed in strict mode",StrictParamDupe:"Strict mode function may not have duplicate parameter names",StrictFunctionName:"Function name may not be eval or arguments in strict mode",StrictOctalLiteral:"Octal literals are not allowed in strict mode.",StrictDelete:"Delete of an unqualified identifier in strict mode.",StrictDuplicateProperty:"Duplicate data property in object literal not allowed in strict mode",AccessorDataProperty:"Object literal may not have data and accessor property with the same name",AccessorGetSet:"Object literal may not have multiple get/set accessors with the same name",StrictLHSAssignment:"Assignment to eval or arguments is not allowed in strict mode",StrictLHSPostfix:"Postfix increment/decrement may not have eval or arguments operand in strict mode",StrictLHSPrefix:"Prefix increment/decrement may not have eval or arguments operand in strict mode",StrictReservedWord:"Use of future reserved word in strict mode"},Et={NonAsciiIdentifierStart:new RegExp("[ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽͿΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԯԱ-Ֆՙա-ևא-תװ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࢠ-ࢲऄ-हऽॐक़-ॡॱ-ঀঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-హఽౘౙౠౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൠൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛸᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡷᢀ-ᢨᢪᢰ-ᣵᤀ-ᤞᥐ-ᥭᥰ-ᥴᦀ-ᦫᧁ-ᧇᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᳩ-ᳬᳮ-ᳱᳵᳶᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⸯ々-〇〡-〩〱-〵〸-〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚝꚠ-ꛯꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞭꞰꞱꟷ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꧠ-ꧤꧦ-ꧯꧺ-ꧾꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꩾ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꬰ-ꭚꭜ-ꭟꭤꭥꯀ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ]"),NonAsciiIdentifierPart:new RegExp("[ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮ̀-ʹͶͷͺ-ͽͿΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁ҃-҇Ҋ-ԯԱ-Ֆՙա-և֑-ׇֽֿׁׂׅׄא-תװ-ײؐ-ؚؠ-٩ٮ-ۓە-ۜ۟-۪ۨ-ۼۿܐ-݊ݍ-ޱ߀-ߵߺࠀ-࠭ࡀ-࡛ࢠ-ࢲࣤ-ॣ०-९ॱ-ঃঅ-ঌএঐও-নপ-রলশ-হ়-ৄেৈো-ৎৗড়ঢ়য়-ৣ০-ৱਁ-ਃਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹ਼ਾ-ੂੇੈੋ-੍ੑਖ਼-ੜਫ਼੦-ੵઁ-ઃઅ-ઍએ-ઑઓ-નપ-રલળવ-હ઼-ૅે-ૉો-્ૐૠ-ૣ૦-૯ଁ-ଃଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହ଼-ୄେୈୋ-୍ୖୗଡ଼ଢ଼ୟ-ୣ୦-୯ୱஂஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹா-ூெ-ைொ-்ௐௗ௦-௯ఀ-ఃఅ-ఌఎ-ఐఒ-నప-హఽ-ౄె-ైొ-్ౕౖౘౙౠ-ౣ౦-౯ಁ-ಃಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹ಼-ೄೆ-ೈೊ-್ೕೖೞೠ-ೣ೦-೯ೱೲഁ-ഃഅ-ഌഎ-ഐഒ-ഺഽ-ൄെ-ൈൊ-ൎൗൠ-ൣ൦-൯ൺ-ൿංඃඅ-ඖක-නඳ-රලව-ෆ්ා-ුූෘ-ෟ෦-෯ෲෳก-ฺเ-๎๐-๙ກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ູົ-ຽເ-ໄໆ່-ໍ໐-໙ໜ-ໟༀ༘༙༠-༩༹༵༷༾-ཇཉ-ཬཱ-྄྆-ྗྙ-ྼ࿆က-၉ၐ-ႝႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚ፝-፟ᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛸᜀ-ᜌᜎ-᜔ᜠ-᜴ᝀ-ᝓᝠ-ᝬᝮ-ᝰᝲᝳក-៓ៗៜ៝០-៩᠋-᠍᠐-᠙ᠠ-ᡷᢀ-ᢪᢰ-ᣵᤀ-ᤞᤠ-ᤫᤰ-᤻᥆-ᥭᥰ-ᥴᦀ-ᦫᦰ-ᧉ᧐-᧙ᨀ-ᨛᨠ-ᩞ᩠-᩿᩼-᪉᪐-᪙ᪧ᪰-᪽ᬀ-ᭋ᭐-᭙᭫-᭳ᮀ-᯳ᰀ-᰷᱀-᱉ᱍ-ᱽ᳐-᳔᳒-ᳶ᳸᳹ᴀ-᷵᷼-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼ‌‍‿⁀⁔ⁱⁿₐ-ₜ⃐-⃥⃜⃡-⃰ℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯ⵿-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⷠ-ⷿⸯ々-〇〡-〯〱-〵〸-〼ぁ-ゖ゙゚ゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘫꙀ-꙯ꙴ-꙽ꙿ-ꚝꚟ-꛱ꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞭꞰꞱꟷ-ꠧꡀ-ꡳꢀ-꣄꣐-꣙꣠-ꣷꣻ꤀-꤭ꤰ-꥓ꥠ-ꥼꦀ-꧀ꧏ-꧙ꧠ-ꧾꨀ-ꨶꩀ-ꩍ꩐-꩙ꩠ-ꩶꩺ-ꫂꫛ-ꫝꫠ-ꫯꫲ-꫶ꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꬰ-ꭚꭜ-ꭟꭤꭥꯀ-ꯪ꯬꯭꯰-꯹가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻ︀-️︠-︭︳︴﹍-﹏ﹰ-ﹴﹶ-ﻼ０-９Ａ-Ｚ＿ａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ]")},z.prototype=j.prototype={finish:function(){Dt.range&&(this.range[1]=St),Dt.loc&&(this.loc.end=new D,Dt.source&&(this.loc.source=Dt.source))},finishArrayExpression:function(t){return this.type=xt.ArrayExpression,this.elements=t,this.finish(),this},finishAssignmentExpression:function(t,e,n){return this.type=xt.AssignmentExpression,this.operator=t,this.left=e,this.right=n,this.finish(),this},finishBinaryExpression:function(t,e,n){return this.type="||"===t||"&&"===t?xt.LogicalExpression:xt.BinaryExpression,this.operator=t,this.left=e,this.right=n,this.finish(),this},finishCallExpression:function(t,e){return this.type=xt.CallExpression,this.callee=t,this.arguments=e,this.finish(),this},finishConditionalExpression:function(t,e,n){return this.type=xt.ConditionalExpression,this.test=t,this.consequent=e,this.alternate=n,this.finish(),this},finishExpressionStatement:function(t){return this.type=xt.ExpressionStatement,this.expression=t,this.finish(),this},finishIdentifier:function(t){return this.type=xt.Identifier,this.name=t,this.finish(),this},finishLiteral:function(t){return this.type=xt.Literal,this.value=t.value,this.raw=Lt.slice(t.start,t.end),t.regex&&("//"==this.raw&&(this.raw="/(?:)/"),this.regex=t.regex),this.finish(),this},finishMemberExpression:function(t,e,n){return this.type=xt.MemberExpression,this.computed="["===t,this.object=e,this.property=n,this.finish(),this},finishObjectExpression:function(t){return this.type=xt.ObjectExpression,this.properties=t,this.finish(),this},finishProgram:function(t){return this.type=xt.Program,this.body=t,this.finish(),this},finishProperty:function(t,e,n){return this.type=xt.Property,this.key=e,this.value=n,this.kind=t,this.finish(),this},finishUnaryExpression:function(t,e){return this.type="++"===t||"--"===t?xt.UpdateExpression:xt.UnaryExpression,this.operator=t,this.argument=e,this.prefix=!0,this.finish(),this}};var Pt={"if":1,"this":1};return{tokenize:vt,parse:yt}}()},{}],39:[function(t,e,n){function r(t,e,n,r){(e||[]).forEach(function(e,a){n[a]=n[a]||s(t),i(e,a,n[a],r)})}function i(t,e,n,r){void 0!==t.scale&&n.scale(r.scale(t.scale)),n.orient(t.orient||l[t.type]),n.offset(t.offset||0),n.layer(t.layer||"front"),n.grid(t.grid||!1),n.title(t.title||null),n.titleOffset(null!=t.titleOffset?t.titleOffset:o.axis.titleOffset),n.tickValues(t.values||null),n.tickFormat(t.format||null),n.tickSubdivide(t.subdivide||0),n.tickPadding(t.tickPadding||o.axis.padding);var i=[];if(void 0!==t.tickSize)for(var s=0;3>s;++s)i.push(t.tickSize);else{var u=o.axis.tickSize;i=[u,u,u]}if(null!=t.tickSizeMajor&&(i[0]=t.tickSizeMajor),null!=t.tickSizeMinor&&(i[1]=t.tickSizeMinor),null!=t.tickSizeEnd&&(i[2]=t.tickSizeEnd),i.length&&n.tickSize.apply(n,i),null!=t.ticks){var c=a.isArray(t.ticks)?t.ticks:[t.ticks];n.ticks.apply(n,c)}else n.ticks(o.axis.ticks);var d=t.properties;d&&d.ticks?(n.majorTickProperties(d.majorTicks?a.extend({},d.ticks,d.majorTicks):d.ticks),n.minorTickProperties(d.minorTicks?a.extend({},d.ticks,d.minorTicks):d.ticks)):(n.majorTickProperties(d&&d.majorTicks||{}),n.minorTickProperties(d&&d.minorTicks||{})),n.tickLabelProperties(d&&d.labels||{}),n.titleProperties(d&&d.title||{}),n.gridLineProperties(d&&d.grid||{}),n.domainProperties(d&&d.axis||{})}var a=t("datalib"),s=t("../scene/axis"),o=t("../util/config"),l={x:"bottom",y:"left",top:"top",bottom:"bottom",left:"left",right:"right"};e.exports=r},{"../scene/axis":70,"../util/config":95,datalib:17}],40:[function(t,e,n){var r=t("datalib"),i=t("../util/config"),a=t("./transforms"),s=t("./modify"),o=function(t,e,n){function a(e){return function(i,a){i?r.error("LOADING FAILED: "+e.url):t.data(e.name).values(r.read(a,e.format)),0===--s&&n()}}var s=0;return(e||[]).forEach(function(e){e.url&&(s+=1,r.load(r.extend({url:e.url},i.load),a(e))),o.datasource(t,e)}),0===s&&setTimeout(n,1),e};o.datasource=function(t,e){var n=(e.transform||[]).map(function(e){return a(t,e)}),i=(e.modify||[]).map(function(n){return s(t,n,e)}),o=t.data(e.name,i.concat(n));return e.values?o.values(r.read(e.values,e.format)):e.source&&(o.source(e.source).revises(o.revises()).addListener(o),t.removeListener(o.pipeline()[0])),o},e.exports=o},{"../util/config":95,"./modify":46,"./transforms":53,datalib:17}],41:[function(t,e,n){function r(t,e){function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n}function i(t,e,n,r,i,a){this.message=t,this.expected=e,this.found=n,this.offset=r,this.line=i,this.column=a,this.name="SyntaxError"}function a(t){function e(e){function n(e,n,r){var i,a;for(i=n;r>i;i++)a=t.charAt(i),"\n"===a?(e.seenCR||e.line++,e.column=1,e.seenCR=!1):"\r"===a||"\u2028"===a||"\u2029"===a?(e.line++,e.column=1,e.seenCR=!0):(e.column++,e.seenCR=!1)}return Ut!==e&&(Ut>e&&(Ut=0,Ft={line:1,column:1,seenCR:!1}),n(Ft,Ut,e),Ut=e),Ft}function n(t){Gt>zt||(zt>Gt&&(Gt=zt,qt=[]),qt.push(t))}function r(n,r,a){function s(t){var e=1;for(t.sort(function(t,e){return t.description<e.description?-1:t.description>e.description?1:0});e<t.length;)t[e-1]===t[e]?t.splice(e,1):e++}function o(t,e){function n(t){function e(t){return t.charCodeAt(0).toString(16).toUpperCase()}return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(t){return"\\x0"+e(t)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(t){return"\\x"+e(t)}).replace(/[\u0180-\u0FFF]/g,function(t){return"\\u0"+e(t)}).replace(/[\u1080-\uFFFF]/g,function(t){return"\\u"+e(t)})}var r,i,a,s=new Array(t.length);for(a=0;a<t.length;a++)s[a]=t[a].description;return r=t.length>1?s.slice(0,-1).join(", ")+" or "+s[t.length-1]:s[0],i=e?'"'+n(e)+'"':"end of input","Expected "+r+" but "+i+" found."}var l=e(a),u=a<t.length?t.charAt(a):null;return null!==r&&s(r),new i(null!==n?n:o(r,u),r,u,a,l.line,l.column)}function a(){var t;return t=s()}function s(){var e,r,i,a,l,u;return e=zt,r=o(),r!==y?(i=g(),i!==y?(44===t.charCodeAt(zt)?(a=w,zt++):(a=y,0===Bt&&n(k)),a!==y?(l=g(),l!==y?(u=s(),u!==y?(Rt=e,r=E(r,u),e=r):(zt=e,e=x)):(zt=e,e=x)):(zt=e,e=x)):(zt=e,e=x)):(zt=e,e=x),e===y&&(e=zt,r=o(),r!==y&&(Rt=e,r=L(r)),e=r),e}function o(){var e,r,i,a,s,u,c,d,h,f,p,m,v,_;return e=zt,91===t.charCodeAt(zt)?(r=A,zt++):(r=y,0===Bt&&n(S)),r!==y?(i=g(),i!==y?(a=l(),a!==y?(s=g(),s!==y?(44===t.charCodeAt(zt)?(u=w,zt++):(u=y,0===Bt&&n(k)),u!==y?(c=g(),c!==y?(d=l(),d!==y?(h=g(),h!==y?(93===t.charCodeAt(zt)?(f=M,zt++):(f=y,0===Bt&&n(N)),f!==y?(p=g(),p!==y?(62===t.charCodeAt(zt)?(m=T,zt++):(m=y,0===Bt&&n(C)),m!==y?(v=g(),v!==y?(_=o(),_!==y?(Rt=e,r=I(a,d,_),e=r):(zt=e,e=x)):(zt=e,e=x)):(zt=e,e=x)):(zt=e,e=x)):(zt=e,e=x)):(zt=e,e=x)):(zt=e,e=x)):(zt=e,e=x)):(zt=e,e=x)):(zt=e,e=x)):(zt=e,e=x)):(zt=e,e=x)):(zt=e,e=x),e===y&&(e=l()),e}function l(){var t,e,n,r;if(t=zt,e=u(),e!==y){if(n=[],r=f(),r!==y)for(;r!==y;)n.push(r),r=f();else n=x;n!==y?(Rt=t,e=D(e,n),t=e):(zt=t,t=x)}else zt=t,t=x;return t===y&&(t=zt,e=u(),e!==y&&(Rt=t,e=P(e)),t=e),t}function u(){var e,r,i,a;if(e=zt,r=c(),r===y&&(r=d()),r===y&&(r=O),r!==y?(i=h(),i!==y?(Rt=e,r=j(r,i),e=r):(zt=e,e=x)):(zt=e,e=x),e===y){if(e=zt,r=[],z.test(t.charAt(zt))?(i=t.charAt(zt),zt++):(i=y,0===Bt&&n(R)),i!==y)for(;i!==y;)r.push(i),z.test(t.charAt(zt))?(i=t.charAt(zt),zt++):(i=y,0===Bt&&n(R));else r=x;r!==y&&(Rt=e,r=U(r)),e=r,e===y&&(e=zt,40===t.charCodeAt(zt)?(r=F,zt++):(r=y,0===Bt&&n(G)),r!==y?(i=s(),i!==y?(41===t.charCodeAt(zt)?(a=q,zt++):(a=y,0===Bt&&n(B)),a!==y?(Rt=e,r=W(i),e=r):(zt=e,e=x)):(zt=e,e=x)):(zt=e,e=x))}return e}function c(){var e,r,i,a;return e=zt,46===t.charCodeAt(zt)?(r=V,zt++):(r=y,0===Bt&&n(H)),r!==y?(i=p(),i!==y?(58===t.charCodeAt(zt)?(a=K,zt++):(a=y,0===Bt&&n(X)),a!==y?(Rt=e,r=J(i),e=r):(zt=e,e=x)):(zt=e,e=x)):(zt=e,e=x),e}function d(){var e,r,i,a;return e=zt,35===t.charCodeAt(zt)?(r=Y,zt++):(r=y,0===Bt&&n(Q)),r!==y?(i=p(),i!==y?(58===t.charCodeAt(zt)?(a=K,zt++):(a=y,0===Bt&&n(X)),a!==y?(Rt=e,r=Z(i),e=r):(zt=e,e=x)):(zt=e,e=x)):(zt=e,e=x),e}function h(){var e;return t.substr(zt,9)===$?(e=$,zt+=9):(e=y,0===Bt&&n(tt)),e===y&&(t.substr(zt,7)===et?(e=et,zt+=7):(e=y,0===Bt&&n(nt)),e===y&&(t.substr(zt,5)===rt?(e=rt,zt+=5):(e=y,0===Bt&&n(it)),e===y&&(t.substr(zt,8)===at?(e=at,zt+=8):(e=y,0===Bt&&n(st)),e===y&&(t.substr(zt,5)===ot?(e=ot,zt+=5):(e=y,0===Bt&&n(lt)),e===y&&(t.substr(zt,7)===ut?(e=ut,zt+=7):(e=y,0===Bt&&n(ct)),e===y&&(t.substr(zt,8)===dt?(e=dt,zt+=8):(e=y,0===Bt&&n(ht)),e===y&&(t.substr(zt,5)===ft?(e=ft,zt+=5):(e=y,0===Bt&&n(pt)),e===y&&(t.substr(zt,10)===gt?(e=gt,zt+=10):(e=y,0===Bt&&n(mt)),e===y&&(t.substr(zt,9)===vt?(e=vt,zt+=9):(e=y,0===Bt&&n(yt)),e===y&&(t.substr(zt,8)===_t?(e=_t,zt+=8):(e=y,0===Bt&&n(bt)),e===y&&(t.substr(zt,9)===xt?(e=xt,zt+=9):(e=y,0===Bt&&n(wt)),e===y&&(t.substr(zt,10)===kt?(e=kt,zt+=10):(e=y,0===Bt&&n(Et)),e===y&&(t.substr(zt,10)===Lt?(e=Lt,zt+=10):(e=y,0===Bt&&n(At)),e===y&&(t.substr(zt,9)===St?(e=St,zt+=9):(e=y,0===Bt&&n(Mt)),e===y&&(t.substr(zt,8)===Nt?(e=Nt,zt+=8):(e=y,0===Bt&&n(Tt))))))))))))))))),e}function f(){var e,r,i,a;return e=zt,91===t.charCodeAt(zt)?(r=A,zt++):(r=y,0===Bt&&n(S)),r!==y?(i=p(),i!==y?(93===t.charCodeAt(zt)?(a=M,zt++):(a=y,0===Bt&&n(N)),a!==y?(Rt=e,r=Ct(i),e=r):(zt=e,e=x)):(zt=e,e=x)):(zt=e,e=x),e}function p(){var e,r,i;if(e=zt,r=[],It.test(t.charAt(zt))?(i=t.charAt(zt),zt++):(i=y,0===Bt&&n(Dt)),i!==y)for(;i!==y;)r.push(i),It.test(t.charAt(zt))?(i=t.charAt(zt),zt++):(i=y,0===Bt&&n(Dt));else r=x;return r!==y&&(Rt=e,r=Pt(r)),e=r}function g(){var e,r;for(e=[],Ot.test(t.charAt(zt))?(r=t.charAt(zt),zt++):(r=y,0===Bt&&n(jt));r!==y;)e.push(r),Ot.test(t.charAt(zt))?(r=t.charAt(zt),zt++):(r=y,0===Bt&&n(jt));return e}var m,v=arguments.length>1?arguments[1]:{},y={},_={start:a},b=a,x=y,w=",",k={type:"literal",value:",",description:'","'},E=function(t,e){return[t].concat(e)},L=function(t){return[t]},A="[",S={type:"literal",value:"[",description:'"["'},M="]",N={type:"literal",value:"]",description:'"]"'},T=">",C={type:"literal",value:">",description:'">"'},I=function(t,e,n){return{start:t,end:e,middle:n}},D=function(t,e){return t.filters=e,t},P=function(t){return t},O=null,j=function(t,e){return{event:e,target:t}},z=/^[:a-zA-z0-9_\-]/,R={type:"class",value:"[:a-zA-z0-9_\\-]",description:"[:a-zA-z0-9_\\-]"},U=function(t){return{signal:t.join("")}},F="(",G={type:"literal",value:"(",description:'"("'},q=")",B={type:"literal",value:")",description:'")"'},W=function(t){return{stream:t}},V=".",H={type:"literal",value:".",description:'"."'},K=":",X={type:"literal",value:":",description:'":"'},J=function(t){return{type:"class",value:t}},Y="#",Q={type:"literal",value:"#",description:'"#"'},Z=function(t){return{type:"id",value:t}},$="mousedown",tt={type:"literal",value:"mousedown",description:'"mousedown"'},et="mouseup",nt={type:"literal",value:"mouseup",description:'"mouseup"'},rt="click",it={type:"literal",value:"click",description:'"click"'},at="dblclick",st={type:"literal",value:"dblclick",description:'"dblclick"'},ot="wheel",lt={type:"literal",value:"wheel",description:'"wheel"'},ut="keydown",ct={type:"literal",value:"keydown",description:'"keydown"'},dt="keypress",ht={type:"literal",value:"keypress",description:'"keypress"'},ft="keyup",pt={type:"literal",value:"keyup",description:'"keyup"'},gt="mousewheel",mt={type:"literal",value:"mousewheel",description:'"mousewheel"'},vt="mousemove",yt={type:"literal",value:"mousemove",description:'"mousemove"'},_t="mouseout",bt={type:"literal",value:"mouseout",description:'"mouseout"'},xt="mouseover",wt={type:"literal",value:"mouseover",description:'"mouseover"'},kt="mouseenter",Et={type:"literal",value:"mouseenter",description:'"mouseenter"'},Lt="touchstart",At={type:"literal",value:"touchstart",description:'"touchstart"'},St="touchmove",Mt={type:"literal",value:"touchmove",description:'"touchmove"'},Nt="touchend",Tt={type:"literal",value:"touchend",description:'"touchend"'},Ct=function(t){return t},It=/^['"a-zA-Z0-9_.><=! \t\-]/,Dt={type:"class",value:"['\"a-zA-Z0-9_.><=! \\t\\-]",description:"['\"a-zA-Z0-9_.><=! \\t\\-]"},Pt=function(t){return t.join("")},Ot=/^[ \t\r\n]/,jt={type:"class",value:"[ \\t\\r\\n]",description:"[ \\t\\r\\n]"},zt=0,Rt=0,Ut=0,Ft={line:1,column:1,seenCR:!1},Gt=0,qt=[],Bt=0;if("startRule"in v){if(!(v.startRule in _))throw new Error("Can't start parsing from rule \""+v.startRule+'".');b=_[v.startRule]}if(m=b(),m!==y&&zt===t.length)return m;throw m!==y&&zt<t.length&&n({type:"end",description:"end of input"}),r(null,qt,Gt)}r(i,Error),e.exports={SyntaxError:i,parse:a}},{}],42:[function(t,e,n){var r=t("datalib"),i=t("../expression"),a=function(){var t=i.parse,e=i.code({idWhiteList:["d","e","i","p","sg"]});return function(n){var r=e(t(n));return r.fn=Function("d","e","i","p","sg",'"use strict"; return ('+r.fn+");"),r}}();a.eval=function(t,e,n,i,a,s,o){return o=t.signalValues(r.array(o)),e.call(null,n,i,a,s,o)},e.exports=a},{"../expression":37,datalib:17}],43:[function(t,e,n){var r=t("datalib"),i=t("../util/config"),a=t("../util/constants");e.exports=function(t,e,n){function s(t){return function(e,n){if(e)r.error("LOADING FAILED: "+t.url);else{var i=r.isObject(n)?n:JSON.parse(n);o(t.name,i)}0==--m&&l()}}function o(t,e){v={},y={},e.signals&&b.push.apply(b,d(t,e.signals)),e.predicates&&x.push.apply(x,h(t,e.predicates)),p(t,e.marks)}function l(){r.keys(_).length>0&&u(e.marks),e.signals=r.array(e.signals),e.predicates=r.array(e.predicates),e.signals.unshift.apply(e.signals,b),e.predicates.unshift.apply(e.predicates,x),n()}function u(t){var e,n,i,s;for(t=r.array(t),i=0,s=t.length;s>i;i++)e=t[i],(n=_[e.type])?(t[i]=r.duplicate(n),e.from&&(t[i].from=e.from),e.properties&&[a.ENTER,a.UPDATE,a.EXIT].forEach(function(a){t[i].properties[a]=r.extend(n.properties[a],e.properties[a])})):e.marks&&u(e.marks)}function c(t,e){return r.isString(e)?e+"_"+t:(r.keys(e).forEach(function(n){var r=new RegExp("\\b"+n+"\\b","g");t=t.replace(r,e[n])}),t)}function d(t,e){return e=r.array(e),e.forEach(function(e){e.name=v[e.name]=c(e.name,t)}),e.forEach(function(t){(t.streams||[]).forEach(function(t){t.type=c(t.type,v),t.expr=c(t.expr,v)})}),e}function h(t,e){return e=r.array(e),e.forEach(function(e){e.name=y[e.name]=c(e.name,t),[e.operands,e.range].forEach(function(t){(t||[]).forEach(function(t){t.signal?t.signal=c(t.signal,v):t.predicate&&f(t)})})}),e}function f(t){t.predicate=y[t.predicate],r.keys(t.input).forEach(function(e){var n=t.input[e];n.signal&&(n.signal=c(n.signal,v))})}function p(t,e){(e||[]).forEach(function(e){g(e.properties.enter),g(e.properties.update),g(e.properties.exit),_[c(e.name,t)]=e})}function g(t){r.keys(t).forEach(function(e){var n=t[e];n.signal?n.signal=c(n.signal,v):n.rule&&n.rule.forEach(function(t){t.signal&&(t.signal=c(t.signal,v)),t.predicate&&f(t)})})}var m=0,v={},y={},_={},b=[],x=[];return(e.interactors||[]).forEach(function(t){t.url&&(m+=1,r.load(r.extend({url:t.url},i.load),s(t)))}),0===m&&setTimeout(l,1),e}},{"../util/config":95,"../util/constants":96,datalib:17}],44:[function(t,e,n){var r=t("datalib"),i=t("./properties");e.exports=function a(t,e){var n=e.properties,s=e.marks;return r.keys(n).forEach(function(r){n[r]=i(t,e.type,n[r])}),e.delay&&(e.delay=i(t,e.type,{delay:e.delay})),s&&(e.marks=s.map(function(e){return a(t,e)})),e}},{"./properties":49,datalib:17}],45:[function(t,e,n){var r=t("./mark");e.exports=function(t,e,n,i){return{type:"group",width:n,height:i,scales:e.scales||[],axes:e.axes||[],marks:(e.marks||[]).map(function(e){return r(t,e)})}}},{"./mark":44}],46:[function(t,e,n){var r=t("datalib"),i=t("../dataflow/Node"),a=t("../dataflow/tuple"),s=t("../util/debug"),o=t("../util/constants"),l=function(t,e,n,r){for(var i=n.length-1;i>=0;--i)n[i][t]==e&&r.push.apply(r,n.splice(i,1))};e.exports=function(t,e,n){var u=t.graph,c=e.signal?r.field(e.signal):null,d=c?c[0]:null,h=e.predicate?t.predicate(e.predicate):null,f=null===h,p=new i(u);return p.evaluate=function(r){if(null!==h){var i={};(h.data||[]).forEach(function(e){i[e]=t.data(e).values()}),f=h({},i,u.signalValues(h.signals||[]),t._predicates)}if(s(r,[e.type+"ing",f]),!f)return r;var d={},p=c?u.signalRef(e.signal):null,g=t.data(n.name),m=g.revises()?null:void 0,v=null;if(d[e.field]=p,e.type==o.ADD)v=a.ingest(d,m),r.add.push(v),g._data.push(v);else if(e.type==o.REMOVE)l(e.field,p,r.add,r.rem),l(e.field,p,r.mod,r.rem),g._data=g._data.filter(function(t){return t[e.field]!==p});else if(e.type==o.TOGGLE){var y=[],_=[];l(e.field,p,r.rem,y),l(e.field,p,r.add,_),l(e.field,p,r.mod,_),0==y.length&&0==_.length&&y.push(a.ingest(d)),r.add.push.apply(r.add,y),g._data.push.apply(g._data,y),r.rem.push.apply(r.rem,_),g._data=g._data.filter(function(t){return-1===_.indexOf(t)})}else e.type==o.CLEAR&&(r.rem.push.apply(r.rem,r.add),r.rem.push.apply(r.rem,r.mod),r.add=[],r.mod=[],g._data=[]);return r.fields[e.field]=1,r},d&&p.dependency(o.SIGNALS,d),h&&p.dependency(o.SIGNALS,h.signals),p}},{"../dataflow/Node":30,"../dataflow/tuple":33,"../util/constants":96,"../util/debug":97,datalib:17}],47:[function(t,e,n){var r=t("datalib");e.exports=function(t){if(null==t)return"auto";if(r.isString(t))return"strict"===t?"strict":"auto";if(r.isObject(t))return t;var e=r.isNumber(t)?t:20;return{top:e,left:e,right:e,bottom:e}}},{datalib:17}],48:[function(t,e,n){var r=t("datalib");e.exports=function(t,e){function n(t,e){var n=r.field(t),i="signals["+n.map(r.str).join("][")+"]";return e[n.shift()]=1,i}function i(e){var i=[],a=[],s={},o={};return r.array(e).forEach(function(e,l){var u="o"+l,c="";if(void 0!==e.value)c=r.str(e.value);else if(e.arg)c="args["+r.str(e.arg)+"]";else if(e.signal)c=n(e.signal,s);else if(e.predicate){var d=t.predicate(e.predicate);d.signals.forEach(function(t){s[t]=1}),d.data.forEach(function(t){o[t]=1}),r.keys(e.input).forEach(function(t){var i=e.input[t];c+="args["+r.str(t)+"] = ",i.signal?c+=n(i.signal,s):i.arg&&(c+="args["+r.str(i.arg)+"]"),c+=", "}),c+="predicates["+r.str(e.predicate)+"](args, db, signals, predicates)"}i.push(u),a.push(u+"=("+c+")")}),{code:"var "+i.join(", ")+";\n"+a.join(";\n")+";\n",signals:r.keys(s),data:r.keys(o)}}function a(t){var e=i(t.operands);return"="==t.type&&(t.type="=="),{code:e.code+"return "+["o0","o1"].join(t.type)+";",signals:e.signals,data:e.data}}function s(t){for(var e=i(t.operands),n=[],r=0,a=t.operands.length;n.push("o"+r++)<a;);return"and"==t.type?t.type="&&":"or"==t.type&&(t.type="||"),{code:e.code+"return "+n.join(t.type)+";",signals:e.signals,data:e.data}}function o(t){var e=[t.item];t.range&&e.push.apply(e,t.range),t.scale&&e.push(t.scale);var n=i(e),a=n.code;if(t.data){var s=r.field(t.field).map(r.str);a+="var where = function(d) { return d["+s.join("][")+"] == o0 };\n",a+="return db["+r.str(t.data)+"].filter(where).length > 0;"}else t.range&&(t.scale&&(a+="o1 = o3(o1);\no2 = o3(o2);\n"),a+="return o1 < o2 ? o1 <= o0 && o0 <= o2 : o2 <= o0 && o0 <= o1");return{code:a,signals:n.signals,data:n.data.concat(t.data?[t.data]:[])}}var l={"=":a,"==":a,"!=":a,">":a,">=":a,"<":a,"<=":a,and:s,"&&":s,or:s,"||":s,"in":o};return(e||[]).forEach(function(e){var n=l[e.type](e),r=Function("args","db","signals","predicates",n.code);r.signals=n.signals,r.data=n.data,t.predicate(e.name,r)}),e}},{datalib:17}],49:[function(t,e,n){(function(n){function r(t,e,n){var r,o,d,h,f="",p=l.keys(n),g={},m={signals:{},scales:{},data:{}};for(f+="var o = trans ? {} : item;\n",r=0,o=p.length;o>r;++r)h=n[d=p[r]],f+=r>0?"\n  ":"  ",h.rule?(h=a(t,d,h.rule),f+="\n  "+h.code):(h=s(d,h),f+="this.tpl.set(o, "+l.str(d)+", "+h.val+");"),g[d]=!0,["signals","scales","data"].forEach(function(t){null!=h[t]&&l.array(h[t]).forEach(function(e){m[t][e]=1})});g.x2&&(g.x?(f+="\n  if (o.x > o.x2) { var t = o.x;this.tpl.set(o, 'x', o.x2);this.tpl.set(o, 'x2', t); };",f+="\n  this.tpl.set(o, 'width', (o.x2 - o.x));"):f+=g.width?"\n  this.tpl.set(o, 'x', (o.x2 - o.width));":"\n  this.tpl.set(o, 'x', o.x2);"),g.y2&&(g.y?(f+="\n  if (o.y > o.y2) { var t = o.y;this.tpl.set(o, 'y', o.y2);this.tpl.set(o, 'y2', t);};",f+="\n  this.tpl.set(o, 'height', (o.y2 - o.y));"):f+=g.height?"\n  this.tpl.set(o, 'y', (o.y2 - o.height));":"\n  this.tpl.set(o, 'y', o.y2);"),i(e,g)&&(f+="\n  item.touch();"),f+="\n  if (trans) trans.interpolate(item, o);";try{var v=Function("item","group","trans","db","signals","predicates",f);return v.tpl=c,v.util=l,v.d3=u,{encode:v,signals:l.keys(m.signals),scales:l.keys(m.scales),data:l.keys(m.data)}}catch(y){l.error(y),l.log(f)}}function i(t,e){return e.path||("area"===t||"line"===t)&&(e.x||e.x2||e.width||e.y||e.y2||e.height||e.tension||e.interpolate)}function a(t,e,n){var r=[],i=[],a=[],o=[],u="";return(n||[]).forEach(function(c,d){var h,f=c.predicate,p=t.predicate(f),g=[],m=e+"_arg"+d;l.keys(c.input).forEach(function(t){var e=s(d,c.input[t]);g.push(l.str(t)+": "+e.val),e.signals&&r.push.apply(r,l.array(e.signals)),e.scales&&i.push.apply(i,l.array(e.scales))}),h=s(e,c),h.signals&&r.push.apply(r,l.array(h.signals)),h.scales&&i.push.apply(i,l.array(h.scales)),f?(r.push.apply(r,p.signals),a.push.apply(a,p.data),o.push(m+" = {"+g.join(", ")+"}"),u+="if(predicates["+l.str(f)+"]("+m+", db, signals, predicates)) {\n    this.tpl.set(o, "+l.str(e)+", "+h.val+");\n",u+=n[d+1]?"  } else ":"  }"):u+="{\n    this.tpl.set(o, "+l.str(e)+", "+h.val+");\n  }"}),u="var "+o.join(",\n      ")+";\n  "+u,{code:u,signals:r,scales:i,data:a}}function s(t,e){if(null==e)return null;var n="fill"===t||"stroke"===t,r=[];if(n){if(e.c)return o("hcl",e.h,e.c,e.l);if(e.h||e.s)return o("hsl",e.h,e.s,e.l);if(e.l||e.a)return o("lab",e.l,e.a,e.b);if(e.r||e.g||e.b)return o("rgb",e.r,e.g,e.b)}var i=null,a=null;if(void 0!==e.value&&(i=l.str(e.value)),void 0!==e.signal&&(a=l.field(e.signal),i="signals["+a.map(l.str).join("][")+"]",r.push(a.shift())),null!=e.group){var s="group.datum";l.isString(e.group)&&(s=h[e.group]?"group."+e.group:"group.datum["+l.field(e.group).map(l.str).join("][")+"]")}if(null!=e.field?l.isString(e.field)?(i="item.datum["+l.field(e.field).map(l.str).join("][")+"]",null!=e.group&&(i="this.util.accessor("+i+")("+s+")")):e.field.signal?(a=l.field(e.field.signal),i="item.datum[signals["+a.map(l.str).join("][")+"]]",null!=e.group&&(i="this.util.accessor("+i+")("+s+")"),r.push(a.shift())):i="this.util.accessor(group.datum["+l.field(e.field.group).map(l.str).join("][")+"])(item.datum)":null!=e.group&&(i=s),
null!=e.scale){var u=null;l.isString(e.scale)?u=l.str(e.scale):e.scale.signal?(a=l.field(e.scale.signal),u="signals["+a.map(l.str).join("][")+"]",r.push(a.shift())):u=(e.scale.group?"group":"item")+".datum["+l.str(e.scale.group||e.scale.field)+"]",u="group.scale("+u+")",e.invert&&(u+=".invert"),i=null!==i||e.band||e.mult||e.offset?u+(e.band?".rangeBand()":"("+(null!==i?i:"item.datum.data")+")"):u}return i="("+(e.mult?l.number(e.mult)+" * ":"")+i+")"+(e.offset?" + "+l.number(e.offset):""),{val:i,signals:r,scales:e.scale}}function o(t,e,n,r){var i=e?s("",e):d.color[t][0],a=n?s("",n):d.color[t][1],o=r?s("",r):d.color[t][2];return signals=[],scales=[],[i,a,o].forEach(function(t){t.signals&&signals.push.apply(signals,t.signals),t.scales&&scales.push(t.scales)}),{val:"(this.d3."+t+"("+[i.val,a.val,o.val].join(",")+') + "")',signals:signals,scales:scales}}var l=t("datalib"),u="undefined"!=typeof window?window.d3:"undefined"!=typeof n?n.d3:null,c=t("../dataflow/tuple"),d=t("../util/config"),h={width:1,height:1,"mark.group.width":1,"mark.group.height":1};e.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../dataflow/tuple":33,"../util/config":95,datalib:17}],50:[function(t,e,n){var r=t("./expr"),i=t("../util/constants");e.exports=function(t,e){var n=t.graph;return(e||[]).forEach(function(a){var s,o=n.signal(a.name,a.init);a.expr&&(s=r(a.expr),o.evaluate=function(i){var l=r.eval(n,s.fn,null,null,null,null,s.signals);return e.scale&&(l=t.scale(e,l)),o.value(l),i.signals[a.name]=1,i},o.dependency(i.SIGNALS,s.signals),s.signals.forEach(function(t){n.signal(t).addListener(o)}))}),e}},{"../util/constants":96,"./expr":42}],51:[function(t,e,n){var r=t("datalib"),i=t("../core/Model"),a=t("../core/View"),s=t("../parse/padding"),o=t("../parse/marks"),l=t("../parse/signals"),u=t("../parse/predicates"),c=t("../parse/data"),d=t("../parse/interactors");e.exports=function(t,e,n){t=r.duplicate(t),n=n||a.factory;var h=t.width||500,f=t.height||500,p=t.viewport||null,g=new i;d(g,t,function(){g.defs({width:h,height:f,viewport:p,padding:s(t.padding),signals:l(g,t.signals),predicates:u(g,t.predicates),marks:o(g,t,h,f),data:c(g,t.data,function(){e(n(g))})})})}},{"../core/Model":25,"../core/View":26,"../parse/data":40,"../parse/interactors":43,"../parse/marks":45,"../parse/padding":47,"../parse/predicates":48,"../parse/signals":50,datalib:17}],52:[function(t,e,n){(function(n){var r=t("datalib"),i="undefined"!=typeof window?window.d3:"undefined"!=typeof n?n.d3:null,a=t("../dataflow/Node"),s=t("../dataflow/changeset"),o=t("./events"),l=t("./expr"),u=t("../util/constants"),c="start",d="middle",h="end";e.exports=function(t){function e(t,e,n){n&&n.scale||(n=n&&n.mark?n.mark.group:m.scene().items[0]);var r=n.scale(t.scale.signal||t.scale);return r?t.invert?r.invert(e):r(e):e}function n(t,n,r,i){var s=new a(v),o=i.item?v.signal(i.item.signal):null;s.evaluate=function(a){if(!a.signals[n.signal])return v.doNotPropagate;var s=l.eval(v,r.fn,null,null,null,null,r.signals);return i.scale&&(s=e(i,s,o?o.value():null)),t.value(s),a.signals[t.name()]=1,a.reflow=!0,a},s.dependency(u.SIGNALS,n.signal),s.addListener(t),v.signal(n.signal).addListener(s)}function f(t,e,n,i){var s=e.filters||[],o=e.target;o&&s.push("i."+o.type+"=="+r.str(o.value)),_[e.event]=_[e.event]||[],_[e.event].push({signal:t,exp:n,filters:s.map(function(t){return l(t)}),spec:i}),b[e.event]=b[e.event]||new a(v),b[e.event].addListener(t)}function p(t,e,r,i){var s=t.name(),o=l("true"),u={};u[c]=v.signal(s+c,!1),u[d]=v.signal(s+d,!1),u[h]=v.signal(s+h,!1);var p=new a(v);p.evaluate=function(e){return u[c].value()===!0&&u[h].value()===!1?e.signals[s+c]?v.doNotPropagate:(t.value(u[d].value()),e.signals[s]=1,e):(u[h].value()===!0&&(u[c].value(!1),u[h].value(!1)),v.doNotPropagate)},p.addListener(t),[c,d,h].forEach(function(t){var a=t==d?r:o,s=t==d?i:{};e[t].event?f(u[t],e[t],a,s):e[t].signal?n(u[t],e[t],a,s):e[t].stream&&g(u[t],e[t].stream,a,s),u[t].addListener(p)})}function g(t,e,r,i){e.forEach(function(e){e.event?f(t,e,r,i):e.signal?n(t,e,r,i):e.start?p(t,e,r,i):e.stream&&g(t,e.stream,r,i)})}var m=t.model(),v=m.graph,y=m.defs().signals,_={},b={};(y||[]).forEach(function(t){var e=v.signal(t.name);t.expr||(t.streams||[]).forEach(function(t){var n=o.parse(t.type),r=l(t.expr);g(e,n,r,t)})}),r.keys(_).forEach(function(n){var r=_[n],a=b[n];t.on(n,function(n,o){var u,c,d,h,f,p=s.create(null,!0),g=t.padding(),m=!1;n.preventDefault(),h=i.mouse((i.event=n,t._el)),o=o||{},f=o.datum||{};var y={x:h[0]-g.left,y:h[1]-g.top};for(d=0;d<r.length;d++)c=r[d],m=c.filters.some(function(t){return!l.eval(v,t.fn,f,n,o,y,t.signals)}),m||(u=l.eval(v,c.exp.fn,f,n,o,y,c.exp.signals),c.spec.scale&&(u=e(c.spec,u,o)),c.signal.value(u),p.signals[c.signal.name()]=1);v.propagate(p,a)})})}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../dataflow/Node":30,"../dataflow/changeset":32,"../util/constants":96,"./events":41,"./expr":42,datalib:17}],53:[function(t,e,n){var r=t("datalib"),i=t("../transforms/index");e.exports=function a(t,e){var n=new i[e.type](t.graph);if("facet"==e.type){var s=(e.transform||[]).map(function(e){return a(t,e)});n.pipeline(s)}return e.output&&n.output(e.output),r.keys(e).forEach(function(t){"type"!==t&&"output"!==t&&("transform"!==t||"facet"!==e.type)&&n[t].set(n,e[t])}),n}},{"../transforms/index":92,datalib:17}],54:[function(t,e,n){(function(n){function r(t){var e=t.indexOf(".");return 0>e?t:t.slice(0,e)}var i=t("datalib"),a="undefined"!=typeof window?window.d3:"undefined"!=typeof n?n.d3:null,s=t("./marks"),o=function(t,e){this._active=null,this._handlers={},t&&this.initialize(t),e&&this.model(e)},l=o.prototype;l.initialize=function(t,e,n){this._el=a.select(t).node(),this._canvas=a.select(t).select("canvas.marks").node(),this._padding=e,this._obj=n||null;var r=this._canvas,i=this;return u.forEach(function(t){r.addEventListener(t,function(e){l[t].call(i,e)})}),this},l.padding=function(t){return this._padding=t,this},l.model=function(t){return arguments.length?(this._model=t,this):this._model},l.handlers=function(){var t=this._handlers;return i.keys(t).reduce(function(e,n){return t[n].reduce(function(t,e){return t.push(e),t},e)},[])};var u=["mousedown","mouseup","click","dblclick","wheel","keydown","keypress","keyup","mousewheel","touchstart"];u.forEach(function(t){l[t]=function(e){this.fire(t,e)}}),u.push("mousemove"),u.push("mouseout"),u.push("touchmove"),u.push("touchend"),l.touchmove=l.mousemove=function(t){var e=this._padding,n=t.target.getBoundingClientRect(),r=t.clientX-n.left,i=t.clientY-n.top,a=this._active,s=this.pick(this._model.scene(),r,i,r-e.left,i-e.top);return s===a?(this.fire("mousemove",t),void("touchmove"==t.type&&this.fire("touchmove",t))):(a&&(this.fire("mouseout",t),"touchend"==t.type&&this.fire("touchend",t)),this._active=s,void(s&&(this.fire("mouseover",t),"touchstart"==t.type&&this.fire("touchstart",t))))},l.touchend=l.mouseout=function(t){this._active&&(this.fire("mouseout",t),this.fire("touchend",t)),this._active=null},l.DOMMouseScroll=function(t){this.fire("mousewheel",t)},l.fire=function(t,e){var n=this._active,r=this._handlers[t];if(r)for(var i=0,a=r.length;a>i;++i)r[i].handler.call(this._obj,e,n)},l.on=function(t,e){var n=r(t),i=this._handlers;return i=i[n]||(i[n]=[]),i.push({type:t,handler:e}),this},l.off=function(t,e){var n=r(t),i=this._handlers[n];if(i){for(var a=i.length;--a>=0;)i[a].type===t&&(e&&i[a].handler!==e||i.splice(a,1));return this}},l.context=function(){return this._canvas.getContext("2d")},l.pick=function(t,e,n,r,i){var a=this.context(),o=t.marktype,l=s.pick[o];return l.call(this,a,t,e,n,r,i)},e.exports=o}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./marks":57,datalib:17}],55:[function(t,e,n){(function(n){function r(t,e){var n=window.devicePixelRatio||1,r=e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1,i=n/r;if(n!==r){var a=t.width,s=t.height;t.setAttribute("width",a*i),t.setAttribute("height",s*i),t.style.width=a+"px",t.style.height=s+"px"}return i}function i(t){if(!t.vgLineDash){var e=[];t.setLineDash?(t.vgLineDash=function(t){this.setLineDash(t||e)},t.vgLineDashOffset=function(t){this.lineDashOffset=t}):void 0!==t.webkitLineDash?(t.vgLineDash=function(t){this.webkitLineDash=t||e},t.vgLineDashOffset=function(t){this.webkitLineDashOffset=t}):void 0!==t.mozDash?(t.vgLineDash=function(t){this.mozDash=t},t.vgLineDashOffset=function(t){}):(t.vgLineDash=function(t){},t.vgLineDashOffset=function(t){})}}function a(t,e){for(var n=new c(e);null!=(t=t.mark.group);)n.translate(t.x||0,t.y||0);return n}function s(t){return t?u.array(t).reduce(function(t,e){return t.union(a(e,e.bounds)).union(a(e,e["bounds:prev"]))},new c):null}function o(t,e){var n=null;return e&&(n=new c(e).round(),t.beginPath(),t.rect(n.x1,n.y1,n.width(),n.height()),t.clip()),n}var l="undefined"!=typeof window?window.d3:"undefined"!=typeof n?n.d3:null,u=t("datalib"),c=t("../../core/Bounds"),d=t("../../util/config"),h=t("./marks"),f=function(){this._ctx=null,this._el=null,this._imgload=0},p=f.prototype;p.initialize=function(t,e,n,r){if(this._el=t,!t)return this;var i=l.select(t).selectAll("canvas.marks").data([1]);return i.enter().append("canvas").attr("class","marks"),i.exit().remove(),this.resize(e,n,r)},p.resize=function(t,e,n){if(this._width=t,this._height=e,this._padding=n,this._el){var a=l.select(this._el).select("canvas.marks");a.attr("width",t+n.left+n.right).attr("height",e+n.top+n.bottom);var s;this._ctx=a.node().getContext("2d"),this._ctx._ratio=s=r(a.node(),this._ctx)||1,this._ctx.setTransform(s,0,0,s,s*n.left,s*n.top)}return i(this._ctx),this},p.context=function(t){return t?(this._ctx=t,this):this._ctx},p.element=function(){return this._el},p.pendingImages=function(){return this._imgload},p.render=function(t,e){var n,r=this._ctx,i=this._padding,a=this._width+i.left+i.right,l=this._height+i.top+i.bottom,u=null;this._scene=t,r.save(),u=o(r,s(e)),r.clearRect(-i.left,-i.top,a,l),this.draw(r,t,u),e&&(r.restore(),r.save(),n=o(r,s(e)),u.encloses(n)||(r.clearRect(-i.left,-i.top,a,l),this.draw(r,t,n))),r.restore(),this._scene=null},p.draw=function(t,e,n){var r=e.marktype,i=h.draw[r];i.call(this,t,e,n)},p.renderAsync=function(t){var e=this;e._async_id&&clearTimeout(e._async_id),e._async_id=setTimeout(function(){e.render(t),delete e._async_id},50)},p.loadImage=function(t){var e,r=this,i=r._scene,a=null;return r._imgload+=1,u.isNode?(a=new("undefined"!=typeof window?window.canvas:"undefined"!=typeof n?n.canvas:null).Image,u.load(u.extend({url:t},d.load),function(t,e){return t?void u.error(t):(a.src=e,a.loaded=!0,void(r._imgload-=1))})):(a=new Image,e=d.baseURL+t,a.onload=function(){a.loaded=!0,r._imgload-=1,r.renderAsync(i)},a.src=e),a},e.exports=f}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../core/Bounds":24,"../../util/config":95,"./marks":57,datalib:17}],56:[function(t,e,n){e.exports={Handler:t("./Handler"),Renderer:t("./Renderer")}},{"./Handler":54,"./Renderer":55}],57:[function(t,e,n){function r(t){return(t.fontStyle?t.fontStyle+" ":"")+(t.fontVariant?t.fontVariant+" ":"")+(t.fontWeight?t.fontWeight+" ":"")+(null!=t.fontSize?t.fontSize:T.render.fontSize)+"px "+(t.font||T.render.font)}function i(t,e){var n=e.x||0,r=e.y||0,i=e.innerRadius||0,a=e.outerRadius||0,s=(e.startAngle||0)-Math.PI/2,o=(e.endAngle||0)-Math.PI/2;t.beginPath(),0===i?t.moveTo(n,r):t.arc(n,r,i,s,o,0),t.arc(n,r,a,o,s,1),t.closePath()}function a(t,e){var n=e[0],r=n.mark,i=r.pathCache||(r.pathCache=I(C.area(e)));D(t,i)}function s(t,e){var n=e[0],r=n.mark,i=r.pathCache||(r.pathCache=I(C.line(e)));D(t,i)}function o(t,e){if(null!=e.path){var n=e.pathCache||(e.pathCache=I(e.path));return D(t,n,e.x,e.y)}}function l(t,e){t.beginPath();var n,r,i,a,s=null!=e.size?e.size:100,o=e.x,l=e.y;if(null==e.shape||"circle"===e.shape)return n=Math.sqrt(s/Math.PI),t.arc(o,l,n,0,2*Math.PI,0),void t.closePath();switch(e.shape){case"cross":n=Math.sqrt(s/5)/2,r=3*n,t.moveTo(o-r,l-n),t.lineTo(o-n,l-n),t.lineTo(o-n,l-r),t.lineTo(o+n,l-r),t.lineTo(o+n,l-n),t.lineTo(o+r,l-n),t.lineTo(o+r,l+n),t.lineTo(o+n,l+n),t.lineTo(o+n,l+r),t.lineTo(o-n,l+r),t.lineTo(o-n,l+n),t.lineTo(o-r,l+n);break;case"diamond":a=Math.sqrt(s/(2*O)),i=a*O,t.moveTo(o,l-a),t.lineTo(o+i,l),t.lineTo(o,l+a),t.lineTo(o-i,l);break;case"square":r=Math.sqrt(s),n=r/2,t.rect(o-n,l-n,r,r);break;case"triangle-down":i=Math.sqrt(s/P),a=i*P/2,t.moveTo(o,l+a),t.lineTo(o+i,l-a),t.lineTo(o-i,l-a);break;case"triangle-up":i=Math.sqrt(s/P),a=i*P/2,t.moveTo(o,l-a),t.lineTo(o+i,l+a),t.lineTo(o-i,l+a)}t.closePath()}function u(t,e){var n=e[0],r=n.strokeWidth,i=n.strokeCap;t.lineWidth=null!=r?r:T.render.lineWidth,t.lineCap=null!=i?i:T.render.lineCap,s(t,e)}function c(t,e){var n=e.x||0,r=e.y||0,i=null!=e.x2?e.x2:n,a=null!=e.y2?e.y2:r,s=e.strokeWidth,o=e.strokeCap;t.lineWidth=null!=s?s:T.render.lineWidth,t.lineCap=null!=o?o:T.render.lineCap,t.beginPath(),t.moveTo(n,r),t.lineTo(i,a)}function d(t,e,n,r){var i,a,s,o=n.fill,l=n.stroke;t(e,r),i=null==n.opacity?1:n.opacity,0!=i&&(o||l)&&(o&&(e.globalAlpha=i*(null==n.fillOpacity?1:n.fillOpacity),e.fillStyle=b(e,n,o),e.fill()),l&&(s=null!=(s=n.strokeWidth)?s:T.render.lineWidth,s>0&&(e.globalAlpha=i*(null==n.strokeOpacity?1:n.strokeOpacity),e.strokeStyle=b(e,n,l),e.lineWidth=s,e.lineCap=null!=(a=n.strokeCap)?a:T.render.lineCap,e.vgLineDash(n.strokeDash||null),e.vgLineDashOffset(n.strokeDashOffset||0),e.stroke())))}function h(t,e,n,r){var i,a,s;for(i=0,a=n.items.length;a>i;++i)s=n.items[i],(!r||r.intersects(s.bounds))&&d(t,e,s,s)}function f(t,e,n){if(e.items.length)for(var r,i,a,s,o,l,u,c,d,h,f=e.items,p=0,g=f.length;g>p;++p)r=f[p],(!n||n.intersects(r.bounds))&&(u=r.x||0,c=r.y||0,d=r.width||0,h=r.height||0,s=null==r.opacity?1:r.opacity,0!=s&&((i=r.fill)&&(t.globalAlpha=s*(null==r.fillOpacity?1:r.fillOpacity),t.fillStyle=b(t,r,i),t.fillRect(u,c,d,h)),(a=r.stroke)&&(l=null!=(l=r.strokeWidth)?l:T.render.lineWidth,l>0&&(t.globalAlpha=s*(null==r.strokeOpacity?1:r.strokeOpacity),t.strokeStyle=b(t,r,a),t.lineWidth=l,t.lineCap=null!=(o=r.strokeCap)?o:T.render.lineCap,t.vgLineDash(r.strokeDash||null),t.vgLineDashOffset(r.strokeDashOffset||0),t.strokeRect(u,c,d,h)))))}function p(t,e,n){if(e.items.length)for(var r,i,a,s,o,l,u,c,d,h=e.items,f=0,p=h.length;p>f;++f)r=h[f],(!n||n.intersects(r.bounds))&&(l=r.x||0,u=r.y||0,c=null!=r.x2?r.x2:l,d=null!=r.y2?r.y2:u,a=null==r.opacity?1:r.opacity,0!=a&&(i=r.stroke)&&(o=null!=(o=r.strokeWidth)?o:T.render.lineWidth,o>0&&(t.globalAlpha=a*(null==r.strokeOpacity?1:r.strokeOpacity),t.strokeStyle=b(t,r,i),t.lineWidth=o,t.lineCap=null!=(s=r.strokeCap)?s:T.render.lineCap,t.vgLineDash(r.strokeDash||null),t.vgLineDashOffset(r.strokeDashOffset||0),t.beginPath(),t.moveTo(l,u),t.lineTo(c,d),t.stroke())))}function g(t,e,n){if(e.items.length)for(var r,i=this,a=e.items,s=0,o=a.length;o>s;++s)if(r=a[s],!n||n.intersects(r.bounds)){r.image&&r.image.url===r.url||(r.image=i.loadImage(r.url),r.image.url=r.url);var l,u,c,d,h;c=r.width||r.image&&r.image.width||0,d=r.height||r.image&&r.image.height||0,l=(r.x||0)-("center"===r.align?c/2:"right"===r.align?c:0),u=(r.y||0)-("middle"===r.baseline?d/2:"bottom"===r.baseline?d:0),r.image.loaded&&(t.globalAlpha=null!=(h=r.opacity)?h:1,t.drawImage(r.image,l,u,c,d))}}function m(t,e,n){if(e.items.length)for(var i,a,s,o,l,u,c,d,h,f=e.items,p=0,g=f.length;g>p;++p)i=f[p],(!n||n.intersects(i.bounds))&&(t.font=r(i),t.textAlign=i.align||"left",t.textBaseline=i.baseline||"alphabetic",o=null==i.opacity?1:i.opacity,0!=o&&(u=i.x||0,c=i.y||0,(d=i.radius)&&(h=(i.theta||0)-Math.PI/2,u+=d*Math.cos(h),c+=d*Math.sin(h)),i.angle?(t.save(),t.translate(u,c),t.rotate(i.angle*Math.PI/180),u=i.dx||0,c=i.dy||0):(u+=i.dx||0,c+=i.dy||0),(a=i.fill)&&(t.globalAlpha=o*(null==i.fillOpacity?1:i.fillOpacity),t.fillStyle=b(t,i,a),t.fillText(i.text,u,c)),(s=i.stroke)&&(l=null!=(l=i.strokeWidth)?l:1,l>0&&(t.globalAlpha=o*(null==i.strokeOpacity?1:i.strokeOpacity),t.strokeStyle=b(i,s),t.lineWidth=l,t.strokeText(i.text,u,c))),i.angle&&t.restore()))}function v(t){return function(e,n,r){h(t,e,n,r)}}function y(t){return function(e,n,r){n.items.length&&(!r||r.intersects(n.items[0].bounds))&&d(t,e,n.items[0],n.items)}}function _(t,e,n){if(e.items.length){var r,i,a,s,o,l,u,c,d,h=e.items,p=this;for(f(t,e,n),l=0,u=h.length;u>l;++l){for(r=h[l],i=r.axisItems||[],a=r.legendItems||[],s=r.x||0,o=r.y||0,t.save(),t.translate(s,o),r.clip&&(t.beginPath(),t.rect(0,0,r.width||0,r.height||0),t.clip()),n&&n.translate(-s,-o),c=0,d=i.length;d>c;++c)"back"===i[c].def.layer&&p.draw(t,i[c],n);for(c=0,d=r.items.length;d>c;++c)p.draw(t,r.items[c],n);for(c=0,d=i.length;d>c;++c)"back"!==i[c].def.layer&&p.draw(t,i[c],n);for(c=0,d=a.length;d>c;++c)p.draw(t,a[c],n);n&&n.translate(s,o),t.restore()}}}function b(t,e,n){return n.id?x(t,n,e.bounds):n}function x(t,e,n){var r,i,a=n.width(),s=n.height(),o=n.x1+e.x1*a,l=n.y1+e.y1*s,u=n.x1+e.x2*a,c=n.y1+e.y2*s,d=t.createLinearGradient(o,l,u,c),h=e.stops;for(r=0,i=h.length;i>r;++r)d.addColorStop(h[r].offset,h[r].color);return d}function w(t,e,n,r,i,a){if(0===e.items.length||e.bounds&&!e.bounds.contains(i,a))return!1;var s,o,l,u,c,d,h,f=e.items,p=this;for(d=f.length;--d>=0;){for(o=f[d],u=o.x||0,c=o.y||0,t.save(),t.translate(u,c),h=o.items.length;--h>=0;)if(s=o.items[h],s.interactive!==!1&&(l=p.pick(s,n,r,i-u,a-c)))return t.restore(),l;t.restore()}return e.interactive?k(z.group,t,e,n,r,i,a):!1}function k(t,e,n,r,i,a,s){if(!n.items.length)return!1;var o,l,u;for(1!==e._ratio&&(r*=e._ratio,i*=e._ratio),u=n.items.length;--u>=0;)if(o=n.items[u],l=o.bounds,(!l||l.contains(a,s))&&l&&t(e,o,r,i,a,s))return o;return!1}function E(t,e,n,r,i,a){if(!e.items.length)return!1;var s,o=e.items;return s=o[0].bounds,s&&!s.contains(i,a)?!1:(1!==t._ratio&&(n*=t._ratio,r*=t._ratio),z.area(t,o,n,r)?o[0]:!1)}function L(t,e,n,r,i,a){if(!e.items.length)return!1;var s,o=e.items;return s=o[0].bounds,s&&!s.contains(i,a)?!1:(1!==t._ratio&&(n*=t._ratio,r*=t._ratio),z.line(t,o,n,r)?o[0]:!1)}function A(t){return function(e,n,r,i,a,s){return k(t,e,n,r,i,a,s)}}function S(t,e,n,r,i,a){if(!e.fontSize)return!1;if(!e.angle)return!0;var s=N.text(e,j,!0),o=-e.angle*Math.PI/180,l=Math.cos(o),u=Math.sin(o),n=e.x,r=e.y,c=l*i-u*a+(n-n*l+r*u),d=u*i+l*a+(r-n*u-r*l);return s.contains(c,d)}var M=t("../../core/Bounds"),N=t("../../util/bounds"),T=t("../../util/config"),C=t("./path"),I=C.parse,D=C.render,P=(Math.PI/2,Math.sqrt(3)),O=Math.tan(30*Math.PI/180),j=new M,z={text:S,rect:function(t,e,n,r){return!0},image:function(t,e,n,r){return!0},group:function(t,e,n,r){return e.fill||e.stroke},rule:function(t,e,n,r){return t.isPointInStroke?(c(t,e),t.isPointInStroke(n,r)):!1},line:function(t,e,n,r){return t.isPointInStroke?(u(t,e),t.isPointInStroke(n,r)):!1},arc:function(t,e,n,r){return i(t,e),t.isPointInPath(n,r)},area:function(t,e,n,r){return a(t,e),t.isPointInPath(n,r)},path:function(t,e,n,r){return o(t,e),t.isPointInPath(n,r)},symbol:function(t,e,n,r){return l(t,e),t.isPointInPath(n,r)}};e.exports={draw:{group:_,area:y(a),line:y(s),arc:v(i),path:v(o),symbol:v(l),rect:f,rule:p,text:m,image:g,drawOne:y,drawAll:v},pick:{group:w,area:E,line:L,arc:A(z.arc),path:A(z.path),symbol:A(z.symbol),rect:A(z.rect),rule:A(z.rule),text:A(z.text),image:A(z.image),pickAll:k}}},{"../../core/Bounds":24,"../../util/bounds":94,"../../util/config":95,"./path":58}],58:[function(t,e,n){(function(n){function r(t){var e,n,r,i=[];t=t.slice().replace(m[0],"###$1").split(m[1]).slice(1);for(var a,s,o=0,l=t.length;l>o;o++){e=t[o],n=e.slice(1).trim().replace(m[2],"$1###-").split(m[3]),s=[e.charAt(0)];for(var a=0,u=n.length;u>a;a++)r=parseFloat(n[a]),isNaN(r)||s.push(r);var c=s[0].toLowerCase(),d=g[c];if(s.length-1>d)for(var h=1,f=s.length;f>h;h+=d)i.push([s[0]].concat(s.slice(h,h+d)));else i.push(s)}return i}function i(t,e,n,r,i,a,l){for(var u=r[0],c=r[1],d=r[2],h=r[3],f=r[4],p=r[5],g=r[6],m=s(p,g,u,c,h,f,d,e,n),v=0;v<m.length;v++){var y=o.apply(null,m[v]);t.bezierCurveTo.apply(t,y),i.add(y[0]-a,y[1]-l),i.add(y[2]-a,y[3]-l),i.add(y[4]-a,y[5]-l)}}function a(t,e,n,r){for(var i=n[0],a=n[1],l=n[2],u=n[3],c=n[4],d=n[5],h=n[6],f=s(d,h,i,a,u,c,l,t,e),p=0;p<f.length;p++){var g=o.apply(null,f[p]);r.add(g[0],g[1]),r.add(g[2],g[3]),r.add(g[4],g[5])}}function s(t,e,n,r,i,a,s,o,l){if(h=_.call(arguments),v[h])return v[h];var u=s*(Math.PI/180),c=Math.sin(u),d=Math.cos(u);n=Math.abs(n),r=Math.abs(r);var f=d*(o-t)*.5+c*(l-e)*.5,p=d*(l-e)*.5-c*(o-t)*.5,g=f*f/(n*n)+p*p/(r*r);g>1&&(g=Math.sqrt(g),n*=g,r*=g);var m=d/n,y=c/n,b=-c/r,x=d/r,w=m*o+y*l,k=b*o+x*l,E=m*t+y*e,L=b*t+x*e,A=(E-w)*(E-w)+(L-k)*(L-k),S=1/A-.25;0>S&&(S=0);var M=Math.sqrt(S);a==i&&(M=-M);var N=.5*(w+E)-M*(L-k),T=.5*(k+L)+M*(E-w),C=Math.atan2(k-T,w-N),I=Math.atan2(L-T,E-N),D=I-C;0>D&&1==a?D+=2*Math.PI:D>0&&0==a&&(D-=2*Math.PI);for(var P=Math.ceil(Math.abs(D/(.5*Math.PI+.001))),O=[],j=0;P>j;j++){var z=C+j*D/P,R=C+(j+1)*D/P;O[j]=[N,T,z,R,n,r,c,d]}return v[h]=O}function o(t,e,n,r,i,a,s,o){if(h=_.call(arguments),y[h])return y[h];var l=o*i,u=-s*a,c=s*i,d=o*a,f=Math.cos(n),p=Math.sin(n),g=Math.cos(r),m=Math.sin(r),v=.5*(r-n),b=Math.sin(.5*v),x=8/3*b*b/Math.sin(v),w=t+f-x*p,k=e+p+x*f,E=t+g,L=e+m,A=E+x*m,S=L-x*g;return y[h]=[l*w+u*k,c*w+d*k,l*A+u*S,c*A+d*S,l*E+u*L,c*E+d*L]}function l(t,e,n,r){var a,s,o,l,u,c=null,d=0,h=0,f=0,g=0,m=new p;void 0==n&&(n=0),void 0==r&&(r=0),t.beginPath();for(var v=0,y=e.length;y>v;++v){switch(a=e[v],a[0]){case"l":d+=a[1],h+=a[2],t.lineTo(d+n,h+r),m.add(d,h);break;case"L":d=a[1],h=a[2],t.lineTo(d+n,h+r),m.add(d,h);break;case"h":d+=a[1],t.lineTo(d+n,h+r),m.add(d,h);break;case"H":d=a[1],t.lineTo(d+n,h+r),m.add(d,h);break;case"v":h+=a[1],t.lineTo(d+n,h+r),m.add(d,h);break;case"V":h=a[1],t.lineTo(d+n,h+r),m.add(d,h);break;case"m":d+=a[1],h+=a[2],t.moveTo(d+n,h+r),m.add(d,h);break;case"M":d=a[1],h=a[2],t.moveTo(d+n,h+r),m.add(d,h);break;case"c":s=d+a[5],o=h+a[6],f=d+a[3],g=h+a[4],t.bezierCurveTo(d+a[1]+n,h+a[2]+r,f+n,g+r,s+n,o+r),m.add(d+a[1],h+a[2]),m.add(f,g),m.add(s,o),d=s,h=o;break;case"C":d=a[5],h=a[6],f=a[3],g=a[4],t.bezierCurveTo(a[1]+n,a[2]+r,f+n,g+r,d+n,h+r),m.add(a[1],a[2]),m.add(f,g),m.add(d,h);break;case"s":s=d+a[3],o=h+a[4],f=2*d-f,g=2*h-g,t.bezierCurveTo(f+n,g+r,d+a[1]+n,h+a[2]+r,s+n,o+r),m.add(f,g),m.add(d+a[1],h+a[2]),m.add(s,o),f=d+a[1],g=h+a[2],d=s,h=o;break;case"S":s=a[3],o=a[4],f=2*d-f,g=2*h-g,t.bezierCurveTo(f+n,g+r,a[1]+n,a[2]+r,s+n,o+r),d=s,h=o,m.add(a[1],a[2]),m.add(f,g),m.add(s,o),f=a[1],g=a[2];break;case"q":s=d+a[3],o=h+a[4],f=d+a[1],g=h+a[2],t.quadraticCurveTo(f+n,g+r,s+n,o+r),d=s,h=o,m.add(f,g),m.add(s,o);break;case"Q":s=a[3],o=a[4],t.quadraticCurveTo(a[1]+n,a[2]+r,s+n,o+r),d=s,h=o,f=a[1],g=a[2],m.add(f,g),m.add(s,o);break;case"t":s=d+a[1],o=h+a[2],null===c[0].match(/[QqTt]/)?(f=d,g=h):"t"===c[0]?(f=2*d-l,g=2*h-u):"q"===c[0]&&(f=2*d-f,g=2*h-g),l=f,u=g,t.quadraticCurveTo(f+n,g+r,s+n,o+r),d=s,h=o,f=d+a[1],g=h+a[2],m.add(f,g),m.add(s,o);break;case"T":s=a[1],o=a[2],f=2*d-f,g=2*h-g,t.quadraticCurveTo(f+n,g+r,s+n,o+r),d=s,h=o,m.add(f,g),m.add(s,o);break;case"a":i(t,d+n,h+r,[a[1],a[2],a[3],a[4],a[5],a[6]+d+n,a[7]+h+r],m,n,r),d+=a[6],h+=a[7];break;case"A":i(t,d+n,h+r,[a[1],a[2],a[3],a[4],a[5],a[6]+n,a[7]+r],m,n,r),d=a[6],h=a[7];break;case"z":case"Z":t.closePath()}c=a}return m.translate(n,r)}function u(t,e){for(var n,r,i,s,o,l=null,u=0,c=0,d=0,h=0,f=0,p=t.length;p>f;++f){switch(n=t[f],n[0]){case"l":u+=n[1],c+=n[2],e.add(u,c);break;case"L":u=n[1],c=n[2],e.add(u,c);break;case"h":u+=n[1],e.add(u,c);break;case"H":u=n[1],e.add(u,c);break;case"v":c+=n[1],e.add(u,c);break;case"V":c=n[1],e.add(u,c);break;case"m":u+=n[1],c+=n[2],e.add(u,c);break;case"M":u=n[1],c=n[2],e.add(u,c);break;case"c":r=u+n[5],i=c+n[6],d=u+n[3],h=c+n[4],e.add(u+n[1],c+n[2]),e.add(d,h),e.add(r,i),u=r,c=i;break;case"C":u=n[5],c=n[6],d=n[3],h=n[4],e.add(n[1],n[2]),e.add(d,h),e.add(u,c);break;case"s":r=u+n[3],i=c+n[4],d=2*u-d,h=2*c-h,e.add(d,h),e.add(u+n[1],c+n[2]),e.add(r,i),d=u+n[1],h=c+n[2],u=r,c=i;break;case"S":r=n[3],i=n[4],d=2*u-d,h=2*c-h,u=r,c=i,e.add(n[1],n[2]),e.add(d,h),e.add(r,i),d=n[1],h=n[2];break;case"q":r=u+n[3],i=c+n[4],d=u+n[1],h=c+n[2],u=r,c=i,e.add(d,h),e.add(r,i);break;case"Q":r=n[3],i=n[4],u=r,c=i,d=n[1],h=n[2],e.add(d,h),e.add(r,i);break;case"t":r=u+n[1],i=c+n[2],null===l[0].match(/[QqTt]/)?(d=u,h=c):"t"===l[0]?(d=2*u-s,h=2*c-o):"q"===l[0]&&(d=2*u-d,h=2*c-h),s=d,o=h,u=r,c=i,d=u+n[1],h=c+n[2],e.add(d,h),e.add(r,i);break;case"T":r=n[1],i=n[2],d=2*u-d,h=2*c-h,u=r,c=i,e.add(d,h),e.add(r,i);break;case"a":a(u,c,[n[1],n[2],n[3],n[4],n[5],n[6]+u,n[7]+c],e),u+=n[6],c+=n[7];break;case"A":a(u,c,[n[1],n[2],n[3],n[4],n[5],n[6],n[7]],e),u=n[6],c=n[7];break;case"z":case"Z":}l=n}return e}function c(t){var e=t[0],n=f.svg.area().x(function(t){return t.x}).y1(function(t){return t.y}).y0(function(t){return t.y+t.height});return e.interpolate&&n.interpolate(e.interpolate),null!=e.tension&&n.tension(e.tension),n(t)}function d(t){var e=t[0],n=f.svg.line().x(function(t){return t.x}).y(function(t){return t.y});return e.interpolate&&n.interpolate(e.interpolate),null!=e.tension&&n.tension(e.tension),n(t)}var h,f="undefined"!=typeof window?window.d3:"undefined"!=typeof n?n.d3:null,p=t("../../core/Bounds"),g={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},m=[/([MLHVCSQTAZmlhvcsqtaz])/g,/###/,/(\d)-/g,/\s|,|###/],v={},y={},_=Array.prototype.join;e.exports={parse:r,render:l,bounds:u,area:c,line:d}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../core/Bounds":24}],59:[function(t,e,n){function r(t){var e=this;return function(n){var r=n.target,i=r.__data__;i&&(i=i.mark?i:i[0]),t.call(e._obj,n,i)}}function i(t){var e=t.indexOf(".");return 0>e?t:t.slice(0,e)}var a=t("datalib"),s=function(t,e){this._active=null,this._handlers={},t&&this.initialize(t),e&&this.model(e)},o=s.prototype;o.initialize=function(t,e,n){return this._el=d3.select(t).node(),this._svg=d3.select(t).select("svg.marks").node(),this._padding=e,this._obj=n||null,this},o.padding=function(t){return this._padding=t,this},o.model=function(t){return arguments.length?(this._model=t,this):this._model},o.handlers=function(){var t=this._handlers;return a.keys(t).reduce(function(e,n){return t[n].reduce(function(t,e){return t.push(e),t},e)},[])},o.on=function(t,e){var n=i(t),a=this._handlers,s=d3.select(this._svg).node(),o={type:t,handler:e,svg:r.call(this,e)};return a=a[n]||(a[n]=[]),a.push(o),s.addEventListener(n,o.svg),this},o.off=function(t,e){var n=i(t),r=this._handlers[n],a=d3.select(this._svg).node();if(r){for(var s=r.length;--s>=0;)r[s].type===t&&(e&&r[s].handler!==e||(a.removeEventListener(n,r[s].svg),r.splice(s,1)));return this}},e.exports=s},{datalib:17}],60:[function(t,e,n){var r=t("datalib"),i=t("./marks"),a=function(){this._svg=null,this._ctx=null,this._el=null,this._defs={gradient:{},clipping:{}}},s=a.prototype;s.initialize=function(t,e,n,r){return this._el=t,d3.select(t).select("svg.marks").remove(),this._svg=d3.select(t).append("svg").attr("class","marks"),this._ctx=this._svg.append("g"),this.resize(e,n,r)},s.resize=function(t,e,n){return this._width=t,this._height=e,this._padding=n,this._svg.attr("width",t+n.left+n.right).attr("height",e+n.top+n.bottom),this._ctx.attr("transform","translate("+n.left+","+n.top+")"),this},s.context=function(){return this._ctx},s.element=function(){return this._el},s.updateDefs=function(){var t,e,n=this._svg,i=this._defs,a=r.keys(i.gradient),s=r.keys(i.clipping),o=n.select("defs");return 0===a.length&&0==s.length?void o.remove():(o.empty()&&(o=n.insert("defs",":first-child")),t=o.selectAll("linearGradient").data(a,r.identity),t.enter().append("linearGradient").attr("id",r.identity),t.exit().remove(),t.each(function(t){var e=i.gradient[t],n=d3.select(this);n.attr({x1:e.x1,x2:e.x2,y1:e.y1,y2:e.y2}),stop=n.selectAll("stop").data(e.stops),stop.enter().append("stop"),stop.exit().remove(),stop.attr("offset",function(t){return t.offset}).attr("stop-color",function(t){return t.color})}),e=o.selectAll("clipPath").data(s,r.identity),e.enter().append("clipPath").attr("id",r.identity),e.exit().remove(),void e.each(function(t){var e=i.clipping[t],n=d3.select(this).selectAll("rect").data([1]);n.enter().append("rect"),n.attr("x",0).attr("y",0).attr("width",e.width).attr("height",e.height)}))},s.render=function(t,e){i.current=this,e?this.renderItems(r.array(e)):this.draw(this._ctx,t,-1),this.updateDefs(),delete i.current},s.renderItems=function(t){var e,n,r,a,s;for(a=0,s=t.length;s>a;++a)e=t[a],n=e._svg,r=e.mark.marktype,e=i.nested[r]?e.mark.items:e,i.update[r].call(n,e),i.style.call(n,e)},s.draw=function(t,e,n){var r=e.marktype,a=i.draw[r];a.call(this,t,e,n)},e.exports=a},{"./marks":62,datalib:17}],61:[function(t,e,n){arguments[4][56][0].apply(n,arguments)},{"./Handler":59,"./Renderer":60,dup:56}],62:[function(t,e,n){(function(n){function r(t){return t.x||0}function i(t){return t.y||0}function a(t){return t.y+t.height||0}function s(t){return null==t.size?100:t.size}function o(t){return t.shape||"circle"}function l(t){var e,n,r,i,a,s=t.mark?t:t.length?t[0]:null;if(null!==s)for(e=0,n=j.length;n>e;++e)r=j[e],i=O[r],a=s[r],null==a?"fill"===i?this.style.setProperty(i,"none",null):this.style.removeProperty(i):(a.id&&(z.current._defs.gradient[a.id]=a,a="url(#"+a.id+")"),this.style.setProperty(i,a+"",null))}function u(t){var e=t.x||0,n=t.y||0;this.setAttribute("transform","translate("+e+","+n+")"),this.setAttribute("d",M(t))}function c(t){if(t.length){var e=t[0];N.interpolate(e.interpolate||"linear").tension(null==e.tension?.7:e.tension),this.setAttribute("d",N(t))}}function d(t){if(t.length){var e=t[0];T.interpolate(e.interpolate||"linear").tension(null==e.tension?.7:e.tension),this.setAttribute("d",T(t))}}function h(t){var e=t.x||0,n=t.y||0;this.setAttribute("transform","translate("+e+","+n+")"),null!=t.path&&this.setAttribute("d",t.path)}function f(t){this.setAttribute("x",t.x||0),this.setAttribute("y",t.y||0),this.setAttribute("width",t.width||0),this.setAttribute("height",t.height||0)}function p(t){var e=t.x||0,n=t.y||0;this.setAttribute("x1",e),this.setAttribute("y1",n),this.setAttribute("x2",null!=t.x2?t.x2:e),this.setAttribute("y2",null!=t.y2?t.y2:n)}function g(t){var e=t.x||0,n=t.y||0;this.setAttribute("transform","translate("+e+","+n+")"),this.setAttribute("d",C(t))}function m(t){var e=t.width||t.image&&t.image.width||0,n=t.height||t.image&&t.image.height||0,r=t.x-("center"===t.align?e/2:"right"===t.align?e:0),i=t.y-("middle"===t.baseline?n/2:"bottom"===t.baseline?n:0),a=S.baseURL+t.url;this.setAttributeNS("http://www.w3.org/1999/xlink","href",a),this.setAttribute("x",r),this.setAttribute("y",i),this.setAttribute("width",e),this.setAttribute("height",n)}function v(t){return(t.fontStyle?t.fontStyle+" ":"")+(t.fontVariant?t.fontVariant+" ":"")+(t.fontWeight?t.fontWeight+" ":"")+(null!=t.fontSize?t.fontSize:S.render.fontSize)+"px "+(t.font||S.render.font)}function y(t){var e=t.x||0,n=t.y||0,r=t.dx||0,i=t.dy||0,a=t.angle||0,s=t.radius||0,o=P[t.align||"left"],l="top"===t.baseline?".9em":"middle"===t.baseline?".35em":0;if(s){var u=(t.theta||0)-Math.PI/2;e+=s*Math.cos(u),n+=s*Math.sin(u)}this.setAttribute("x",e+r),this.setAttribute("y",n+i),this.setAttribute("text-anchor",o),a?this.setAttribute("transform","rotate("+a+" "+e+","+n+")"):this.removeAttribute("transform"),l?this.setAttribute("dy",l):this.removeAttribute("dy"),this.textContent=t.text,this.style.setProperty("font",v(t),null)}function _(t){var e=t.x||0,n=t.y||0;if(this.setAttribute("transform","translate("+e+","+n+")"),t.clip){var r={width:t.width||0,height:t.height||0},i=t.clip_id||(t.clip_id="clip"+D++);z.current._defs.clipping[i]=r,this.setAttribute("clip-path","url(#"+i+")")}}function b(t){var e=t.width||0,n=t.height||0;this.setAttribute("width",e),this.setAttribute("height",n)}function x(t){var e="type-"+t.type;

return t.name&&(e+=" "+t.name),e}function w(t,e,n){return function(r,i,a){k(r,i,a,"mark_",t,e,n)}}function k(t,e,n,r,i,a,s){var o=s?[e.items]:e.items,u=e.interactive===!1?"none":null,c=t.node().childNodes,d="g"!==i,h=(h=c[n+1])?A.select(h):t.append("g").attr("id","g"+ ++I).attr("class",x(e.def)),f=h.attr("id"),p="#"+f+" > "+i,g=h.selectAll(p).data(o),m=g.enter().append(i);return d?(h.style("pointer-events",u),m.each(function(t){t.mark?t._svg=this:t.length&&(t[0]._svg=this)})):m.append("rect").attr("class","background").style("pointer-events",u),g.exit().remove(),g.each(a),d?g.each(l):h.selectAll(p+" > rect.background").each(b).each(l),h}function E(t,e,n,r){var i,a,s,o=k(t,e,n,r||"group_","g",_),l=o.node().childNodes,u=l.length;for(i=0;u>i;++i){var c=l[i].__data__.items,d=l[i].__data__.legendItems||[],h=l[i].__data__.axisItems||[],f=A.select(l[i]),p=0;for(a=0,s=h.length;s>a;++a)"back"===h[a].def.layer&&E.call(this,f,h[a],p++,"axis_");for(a=0,s=c.length;s>a;++a)this.draw(f,c[a],p++);for(a=0,s=h.length;s>a;++a)"back"!==h[a].def.layer&&E.call(this,f,h[a],p++,"axis_");for(a=0,s=d.length;s>a;++a)E.call(this,f,d[a],p++,"legend_")}}var L=t("datalib"),A="undefined"!=typeof window?window.d3:"undefined"!=typeof n?n.d3:null,S=t("../../util/config"),M=A.svg.arc(),N=A.svg.area().x(r).y1(i).y0(a),T=A.svg.line().x(r).y(i),C=A.svg.symbol().type(o).size(s),I=0,D=0,P={left:"start",center:"middle",right:"end"},O={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeWidth:"stroke-width",strokeOpacity:"stroke-opacity",strokeCap:"stroke-linecap",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",opacity:"opacity"},j=L.keys(O),z=e.exports={update:{group:f,area:c,line:d,arc:u,path:h,symbol:g,rect:f,rule:p,text:y,image:m},nested:{area:!0,line:!0},style:l,draw:{group:E,area:w("path",c,!0),line:w("path",d,!0),arc:w("path",u),path:w("path",h),symbol:w("path",g),rect:w("rect",f),rule:w("line",p),text:w("text",y),image:w("image",m),draw:w},current:null}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../util/config":95,datalib:17}],63:[function(t,e,n){function r(t,e){return this._mark=e,i.prototype.init.call(this,t.graph).router(!0)}var i=t("../dataflow/Node"),a=t("../util/bounds"),s=t("../util/constants"),o=t("../util/debug"),l=r.prototype=new i;l.evaluate=function(t){return o(t,["bounds",this._mark.marktype]),a.mark(this._mark),this._mark.marktype===s.GROUP&&a.mark(this._mark,null,!1),t.reflow=!0,t},e.exports=r},{"../dataflow/Node":30,"../util/bounds":94,"../util/constants":96,"../util/debug":97}],64:[function(t,e,n){function r(){return arguments.length?this.init.apply(this,arguments):this}function i(){var t,e,n,r,i,a=this._def.from,s=a.mark;s?(e=["vg",this._parent_id,s].join("_"),n={name:e,transform:a.transform,modify:a.modify}):(t=this._model.data(this._from),e=["vg",this._from,this._def.type,t.listeners(!0).length].join("_"),n={name:e,source:this._from,transform:a.transform,modify:a.modify}),this._from=e,this._ds=g.datasource(this._model,n);var o=this._ds.revises();if(s)r=this.sibling(s).revises(o),r._isSuper?r.addListener(this._ds.listener()):r._bounder.addListener(this._ds.listener());else{var i=this._ds.source().revises(o).last();input=v.create(i),input.add=i.add,input.mod=i.mod,input.rem=i.rem,input.stamp=null,this._graph.propagate(input,this._ds.listener())}}function a(){var t=this._revises?null:void 0,e=m.ingest(new p(this._mark),t);return this._def.width&&m.set(e,"width",this._def.width),this._def.height&&m.set(e,"height",this._def.height),e}function s(t,e,n,r,i,s){var o,l,u,c,d,h;for(o=0,u=t.length;u>o;++o)d=t[o],c=e?this._map[l=e(d)]:i[o],h=c?!1:(c=a.call(this),!0),c.status=h?_.ENTER:_.UPDATE,c.datum=d,m.set(c,"key",l),this._map[l]=c,n.push(c),h?r.add.push(c):(!s||s&&s[d._id])&&r.mod.push(c)}function o(t,e,n){var r,i,a,o,l=v.create(t),c=u(this._def.key||"_id"),d=(t.add,t.mod),h=t.rem,f=[];for(r=0,a=h.length;a>r;++r)o=this._map[i=c(h[r])],o.status=_.EXIT,f.push(o),l.rem.push(o),this._map[i]=null;return s.call(this,e,c,f,l,null,m.idMap(n?e:d)),this._mark.items=f,l}function l(t,e,n){var r,i,a,o=v.create(t),l=u(this._def.key),c=this._mark.items||[],d=[];for(r=0,i=c.length;i>r;++r)a=c[r],a.status=_.EXIT,l&&(this._map[a.key]=a);for(s.call(this,e,l,d,o,c,n?m.idMap(e):null),r=0,i=c.length;i>r;++r)a=c[r],a.status===_.EXIT&&(m.set(a,"key",l?a.key:this._items.length),d.splice(0,0,a),o.rem.push(a));return this._mark.items=d,o}function u(t){if(null==t)return null;var e=c.array(t).map(c.accessor);return function(t){for(var n="",r=0,i=e.length;i>r;++r)r>0&&(n+="|"),n+=String(e[r](t));return n}}var c=t("datalib"),d=t("../dataflow/Node"),h=t("./Encoder"),f=t("./Bounder"),p=t("./Item"),g=t("../parse/data"),m=t("../dataflow/tuple"),v=t("../dataflow/changeset"),y=t("../util/debug"),_=t("../util/constants"),b=r.prototype=new d;b.init=function(t,e,n,r,a,s){return d.prototype.init.call(this,t.graph).router(!0).collector(!0),this._model=t,this._def=e,this._mark=n,this._from=(e.from?e.from.data:null)||s,this._ds=c.isString(this._from)?t.data(this._from):null,this._map={},this._revises=!1,n.def=e,n.marktype=e.type,n.interactive=!(e.interactive===!1),n.items=[],this._parent=r,this._parent_id=a,e.from&&(e.from.mark||e.from.transform||e.from.modify)&&i.call(this),this._isSuper=this._def.type!==_.GROUP,this._encoder=new h(this._model,this._mark),this._bounder=new f(this._model,this._mark),this._ds&&this._encoder.dependency(_.DATA,this._from),this.dependency(_.DATA,this._encoder.dependency(_.DATA)),this.dependency(_.SCALES,this._encoder.dependency(_.SCALES)),this.dependency(_.SIGNALS,this._encoder.dependency(_.SIGNALS)),this},b.revises=function(t){return arguments.length?(!this._revises&&t&&this._items.forEach(function(t){void 0===t._prev&&(t._prev=_.SENTINEL)}),this._revises=this._revises||t,this):this._revises},b.pipeline=function(){return[this]},b.connect=function(){var t=this;return this._model.graph.connect(this.pipeline()),this._encoder.dependency(_.SCALES).forEach(function(e){t._parent.scale(e).addListener(t)}),this._parent&&(this._isSuper?this.addListener(this._parent._collector):this._bounder.addListener(this._parent._collector)),this},b.disconnect=function(){var t=this;return this._listeners.length?(d.prototype.disconnect.call(this),this._model.graph.disconnect(this.pipeline()),this._encoder.dependency(_.SCALES).forEach(function(e){t._parent.scale(e).removeListener(t)}),this):this},b.sibling=function(t){return this._parent.child(t,this._parent_id)},b.evaluate=function(t){y(t,["building",this._from,this._def.type]);var e,n,r,i;return this._ds?(e=v.create(t),i=c.duplicate(e.data),delete e.data[this._ds.name()],n=this._encoder.reevaluate(e),e.data=i,n&&(e.mod=this._mark.items.slice()),r=this._ds.last(),r?r.stamp>this._stamp&&(e=o.call(this,r,this._ds.values(),n)):e.reflow=!0):(n=this._encoder.reevaluate(t),i=c.isFunction(this._def.from)?this._def.from():[_.SENTINEL],e=l.call(this,t,i,n)),e=this._graph.evaluate(e,this._encoder),this._isSuper?this._graph.evaluate(e,this._bounder):e},e.exports=r},{"../dataflow/Node":30,"../dataflow/changeset":32,"../dataflow/tuple":33,"../parse/data":40,"../util/constants":96,"../util/debug":97,"./Bounder":63,"./Encoder":65,"./Item":67,datalib:17}],65:[function(t,e,n){function r(t,e){var n=e.def.properties||{},r=n.update;return a.prototype.init.call(this,t.graph),this._model=t,this._mark=e,r&&(this.dependency(s.DATA,r.data),this.dependency(s.SCALES,r.scales),this.dependency(s.SIGNALS,r.signals)),this}function i(t,e,n,r){var i=this._model,a=t.encode,s=this._graph.signalValues(t.signals||[]),o=(t.data||[]).reduce(function(t,e){return t[e]=i.data(e).values(),t},{});a.call(a,e,e.mark.group||e,n,o,s,i.predicates())}var a=t("../dataflow/Node"),s=t("../util/constants"),o=t("../util/debug"),l={},u=r.prototype=new a;u.evaluate=function(t){o(t,["encoding",this._mark.def.type]);var e,n,r,a=(this._mark.items,this._mark.def.properties||{}),u=a.enter,c=a.update,d=a.exit;for(e=0,n=t.rem.length;n>e;++e)r=t.rem[e],c&&i.call(this,c,r,t.trans),d&&i.call(this,d,r,t.trans),t.trans&&!d?t.trans.interpolate(r,l):t.trans||r.remove();for(e=0,n=t.add.length;n>e;++e)r=t.add[e],u&&i.call(this,u,r,t.trans),c&&i.call(this,c,r,t.trans),r.status=s.UPDATE;if(c)for(e=0,n=t.mod.length;n>e;++e)r=t.mod[e],i.call(this,c,r,t.trans);return t},e.exports=r},{"../dataflow/Node":30,"../util/constants":96,"../util/debug":97}],66:[function(t,e,n){function r(){return this._children={},this._scaler=null,this._recursor=null,this._scales={},this.scale=a.bind(this),arguments.length?this.init.apply(this,arguments):this}function i(t){var e,n,r,i,a,s=this,u=this._def.marks&&this._def.marks.length>0,d=this._def.axes&&this._def.axes.length>0,h=!1;for(e=0,n=t.add.length;n>e;++e)r=t.add[e],u&&o.call(this,t,r),d&&l.call(this,t,r);for(e=t.add.length-1;e>=0;--e)for(r=t.add[e],j=this._children[r._id].length-1;j>=0;--j)c=this._children[r._id][j],c.builder.connect(),i=c.builder.pipeline(),a=c.builder._def,h=a.type!==v.GROUP,h=h&&void 0!==this._model.data(c.from),h=h&&1==i[i.length-1].listeners().length,c.inline=h,h?c.builder.evaluate(t):this._recursor.addListener(c.builder);for(e=0,n=t.mod.length;n>e;++e)r=t.mod[e],u&&s._children[r._id].forEach(function(t){t.type!=v.MARK||t.inline||void 0===s._model.data(t.from)||s._recursor.removeListener(t.builder)}),d&&(g(s._model,s._def.axes,r.axes,r),r.axes.forEach(function(t,e){t.def()}));for(e=0,n=t.rem.length;n>e;++e)r=t.rem[e],s._children[r._id].forEach(function(t){s._recursor.removeListener(t.builder),t.builder.disconnect()}),delete s._children[r._id];return t}function a(t,e){var n=this;if(2===arguments.length)return n._scales[t]=e,e;for(;null==e&&(e=n._scales[t],n=n.mark?n.mark.group:n._parent););return e}function s(t,e){m(t,["building group",e._id]),e._scales=e._scales||{},e.scale=a.bind(e),e.items=e.items||[],this._children[e._id]=this._children[e._id]||[],e.axes=e.axes||[],e.axisItems=e.axisItems||[]}function o(t,e){m(t,["building marks",e._id]);var n,i,a,s,o,l,u=this._def.marks;for(s=0,o=u.length;o>s;++s)n=u[s],i=n.from||{},a="vg_"+e.datum._id,e.items[s]={group:e},l=n.type===v.GROUP?new r:new f,l.init(this._model,n,e.items[s],this,e._id,a),this._children[e._id].push({builder:l,from:i.data||(i.mark?"vg_"+e._id+"_"+i.mark:a),type:v.MARK})}function l(t,e){var n=e.axes,i=e.axisItems,a=this;g(this._model,this._def.axes,n,e),n.forEach(function(t,n){var s=a._def.axes[n].scale,o=t.def(),l=null;i[n]={group:e,axisDef:o},l=o.type===v.GROUP?new r:new f,l.init(a._model,o,i[n],a).dependency(v.SCALES,s),a._children[e._id].push({builder:l,type:v.AXIS,scale:s})})}var u=t("datalib"),d=t("../dataflow/Node"),h=t("../dataflow/Collector"),f=t("./Builder"),p=t("./Scale"),g=t("../parse/axes"),m=t("../util/debug"),v=t("../util/constants"),y=r.prototype=new f;y.init=function(t,e,n,r,a,s){var o=this;this._scaler=new d(t.graph),(e.scales||[]).forEach(function(e){e=o.scale(e.name,new p(t,e,o)),o._scaler.addListener(e)}),this._recursor=new d(t.graph),this._recursor.evaluate=i.bind(this);var l=(e.axes||[]).reduce(function(t,e){return t[e.scale]=1,t},{});return this._recursor.dependency(v.SCALES,u.keys(l)),this._collector=new h(t.graph),f.prototype.init.apply(this,arguments)},y.evaluate=function(t){var e=f.prototype.evaluate.apply(this,arguments),n=this;return e.add.forEach(function(t){s.call(n,e,t)}),e},y.pipeline=function(){return[this,this._scaler,this._recursor,this._collector,this._bounder]},y.disconnect=function(){var t=this;return u.keys(t._children).forEach(function(e){t._children[e].forEach(function(e){t._recursor.removeListener(e.builder),e.builder.disconnect()})}),t._children={},f.prototype.disconnect.call(this)},y.child=function(t,e){for(var n,r=this._children[e],i=0,a=r.length;a>i&&(n=r[i],n.type!=v.MARK||n.builder._def.name!=t);++i);return n.builder},e.exports=r},{"../dataflow/Collector":27,"../dataflow/Node":30,"../parse/axes":39,"../util/constants":96,"../util/debug":97,"./Builder":64,"./Scale":68,datalib:17}],67:[function(t,e,n){function r(t){this.mark=t}var i=r.prototype;i.hasPropertySet=function(t){var e=this.mark.def.properties;return e&&null!=e[t]},i.cousin=function(t,e){if(0===t)return this;t=t||-1;var n=this.mark,r=n.group,i=null==e?n.items.indexOf(this):e,a=r.items.indexOf(n)+t;return r.items[a].items[i]},i.sibling=function(t){if(0===t)return this;t=t||-1;var e=this.mark,n=e.items.indexOf(this)+t;return e.items[n]},i.remove=function(){var t=this,e=t.mark.items,n=e.indexOf(t);return n>=0&&(n===e.length-1?e.pop():e.splice(n,1)),t},i.touch=function(){this.pathCache&&(this.pathCache=null),this.mark.pathCache&&(this.mark.pathCache=null)},e.exports=r},{}],68:[function(t,e,n){(function(n){function r(t,e,n){return this._model=t,this._def=e,this._parent=n,this._updated=!1,p.prototype.init.call(this,t.graph)}function i(t){var e=this._def.name,n=e+":prev",r=a.call(this,t.scale(e)),i=r.type===y.ORDINAL?s:o,l=d.call(this,t);return i.call(this,r,l,t),t.scale(e,r),t.scale(n,t.scale(n)||r),r}function a(t){var e=this._def.type||y.LINEAR;if(!t||e!==t.type){var n=v.scale[e]||f.scale[e];n||h.error("Unrecognized scale type: "+e),(t=n()).type=t.type||e,t.scaleName=this._def.name,t._prev={}}return t}function s(t,e,n){var r,i,a=this._def,s=t._prev,o=!1;h.isObject(a.range)&&!h.isArray(a.range)&&(o=!0,e=l.call(this,y.RANGE,a.range,t,n)),r=l.call(this,y.DOMAIN,a.domain,t,n),r&&!h.equal(s.domain,r)&&(t.domain(r),s.domain=r,this._updated=!0),h.equal(s.range,e)||(i="string"==typeof e[0],i||e.length>2||1===e.length||o?t.range(e):a.points?t.rangePoints(e,a.padding||0):a.round||void 0===a.round?t.rangeRoundBands(e,a.padding||0):t.rangeBands(e,a.padding||0),s.range=e,this._updated=!0)}function o(t,e,n){var r,i,a=this._def,s=t._prev;r=a.type===y.QUANTILE?l.call(this,y.DOMAIN,a.domain,t,n):c.call(this,t,n),r&&!h.equal(s.domain,r)&&(t.domain(r),s.domain=r,this._updated=!0),"height"===a.range&&(e=e.reverse()),h.equal(s.range,e)||(t[a.round&&t.rangeRound?"rangeRound":"range"](e),s.range=e,this._updated=!0,this._stamp>0||(a.exponent&&a.type===y.POWER&&t.exponent(a.exponent),a.clamp&&t.clamp(!0),a.nice&&(a.type===y.TIME?(i=f.time[a.nice],i||h.error("Unrecognized interval: "+i),t.nice(i)):t.nice())))}function l(t,e,n,r){if(null==e)return[];if(h.isArray(e))return e.map(u.bind(this));var i,a,s,o,l,c,d,f,p,m=this,v=this._graph,_=e.fields||h.array(e),b=n.type===y.ORDINAL||n.type===y.QUANTILE,x="_"+t,w=n[x],k={ops:[]},E=e.sort;for(w||(w=n[x]=new g(v),k.ops=[],w.singleton(!0),b&&E&&k.ops.push(E.stat)),i=0,a=_.length;a>i;++i)if(l=_[i],d=l.data||"vg_"+r.datum._id,f=v.data(d).revises(!0).last(),!(f.stamp<=this._stamp)){if(c=h.array(l.field).map(function(t){return t.group?h.accessor(t.group)(r.datum):t}),b)for(k.name=E?E.field:"_id",w.fields.set(w,[k]),s=0,o=c.length;o>s;++s)w.group_by.set(w,c[s]).evaluate(f);else for(s=0,o=c.length;o>s;++s)k.name=c[s],k.ops=[y.MIN,y.MAX],w.fields.set(w,[k]).evaluate(f);this.dependency(y.DATA,d),w.dependency(y.SIGNALS).forEach(function(t){m.dependency(y.SIGNALS,t)})}return f=w.data(),b?(p=h.keys(f).filter(function(t){return null!=f[t]}),E&&(E=E.order.signal?v.signalRef(E.order.signal):E.order,E=(E==y.DESC?"-":"+")+"tpl."+k.name,E=h.comparator(E),p=p.map(function(t){return{key:t,tpl:f[t].tpl}}).sort(E).map(function(t){return t.key})),p):(f=f[""],null===f?[]:[f[y.SINGLETON].min,f[y.SINGLETON].max])}function u(t){var e,n=t.signal;return n?(this.dependency(y.SIGNALS,(e=h.field(n))[0]),this._graph.signalRef(e)):t}function c(t,e){var n,r=this._def,i=[null,null];return void 0!==r.domain&&(i=h.isObject(r.domain)?l.call(this,y.DOMAIN,r.domain,t,e):i),n=i.length-1,void 0!==r.domainMin&&(i[0]=h.isObject(r.domainMin)?r.domainMin.signal?u.call(this,r.domainMin):l.call(this,y.DOMAIN+y.MIN,r.domainMin,t,e)[0]:r.domainMin),void 0!==r.domainMax&&(i[n]=h.isObject(r.domainMax)?r.domainMax.signal?u.call(this,r.domainMax):l.call(this,y.DOMAIN+y.MAX,r.domainMax,t,e)[1]:r.domainMax),r.type===y.LOG||r.type===y.TIME||!r.zero&&void 0!==r.zero||(i[0]=Math.min(0,i[0]),i[n]=Math.max(0,i[n])),i}function d(t){var e=this._def,n=[null,null];if(void 0!==e.range)if("string"==typeof e.range)if(_[e.range])n=[0,t[e.range]];else{if(!v.range[e.range])return h.error("Unrecogized range: "+e.range),n;n=v.range[e.range]}else if(h.isArray(e.range))n=e.range.map(u.bind(this));else{if(h.isObject(e.range))return null;n=[0,e.range]}if(void 0!==e.rangeMin&&(n[0]=e.rangeMin.signal?u.call(this,e.rangeMin):e.rangeMin),void 0!==e.rangeMax&&(n[n.length-1]=e.rangeMax.signal?u.call(this,e.rangeMax):e.rangeMax),void 0!==e.reverse){var r=e.reverse;h.isObject(r)&&(r=h.accessor(r.field)(t.datum)),r&&(n=n.reverse())}return n}var h=t("datalib"),f="undefined"!=typeof window?window.d3:"undefined"!=typeof n?n.d3:null,p=t("../dataflow/Node"),g=t("../transforms/Aggregate"),m=t("../dataflow/changeset"),v=(t("../util/debug"),t("../util/config")),y=t("../util/constants"),_={width:1,height:1},b=r.prototype=new p;b.evaluate=function(t){var e=this,n=function(t){i.call(e,t)};return this._updated=!1,t.add.forEach(n),t.mod.forEach(n),this._updated&&(t.scales[this._def.name]=1),m.create(t,!0)},b.dependency=function(t,e){if(2==arguments.length){e=h.array(e);for(var n=0,r=e.length;r>n;++n)this._graph[t==y.DATA?y.DATA:y.SIGNAL](e[n]).addListener(this._parent)}return p.prototype.dependency.call(this,t,e)},e.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../dataflow/Node":30,"../dataflow/changeset":32,"../transforms/Aggregate":71,"../util/config":95,"../util/constants":96,"../util/debug":97,datalib:17}],69:[function(t,e,n){function r(t,e){this.duration=t||500,this.ease=e&&d3.ease(e)||d3.ease("cubic-in-out"),this.updates={next:null}}function i(t){for(var e,n,r,i,a,o,l=this.updates,u=l,c=u.next,d=this.duration,h=!0;null!=c;u=c,c=u.next)if(e=c.item,n=e.delay||0,r=(t-n)/d,0>r)h=!1;else{for(r>1&&(r=1),i=c.ease(r),a=0,o=c.length;o>a;++a)e[c[a].property]=c[a](i);e.touch(),s.item(e),1===r?(c.remove&&e.remove(),u.next=c.next,c=u):h=!1}return this.callback(),h}var a=t("../dataflow/tuple"),s=t("../util/bounds"),o=t("../util/constants"),l=r.prototype,u={text:1,url:1};l.interpolate=function(t,e,n){var r,i,s,l,c=null;for(r in e)i=t[r],s=e[r],i!==s&&(u[r]||void 0===i?a.set(t,r,s):"number"!=typeof i||isFinite(i)?(l=d3.interpolate(i,s),l.property=r,(c||(c=[])).push(l)):a.set(t,r,s));return null===c&&t.status===o.EXIT&&(c=[]),null!=c&&(c.item=t,c.ease=t.mark.ease||this.ease,c.next=this.updates.next,this.updates.next=c),this},l.start=function(t){for(var e=this,n=e.updates,r=n.next;null!=r;n=r,r=n.next)r.item.status===o.EXIT&&(r.remove=!0);e.callback=t,d3.timer(function(t){return i.call(e,t)})},e.exports=r},{"../dataflow/tuple":33,"../util/bounds":94,"../util/constants":96}],70:[function(t,e,n){function r(t){function e(){w.type=null}function n(e){var n,r,i;"ordinal"===e.type?(n={scale:e.scaleName,offset:.5+e.rangeBand()/2},r=n):(n={scale:e.scaleName,offset:.5},r={scale:e.scaleName+":prev",offset:.5}),i=s(e),G.gridLines||(G.gridLines=h()),G.majorTicks||(G.majorTicks=h()),G.minorTicks||(G.minorTicks=h()),G.tickLabels||(G.tickLabels=f()),G.domain||(G.domain=g()),G.title||(G.title=p()),G.gridLines.properties.enter.stroke={value:v.axis.gridColor},l(a,G.gridLines,r,n,1/0),l(a,G.majorTicks,r,n,A),l(a,G.minorTicks,r,n,S),o(a,G.tickLabels,r,n,A,N),c(a,G.domain,i,M),u(a,G.title,i,x),m.extend(G.gridLines.properties.update,O),m.extend(G.majorTicks.properties.update,z),m.extend(G.minorTicks.properties.update,R),m.extend(G.tickLabels.properties.update,j),m.extend(G.domain.properties.update,F),m.extend(G.title.properties.update,U);var y=[G.gridLines,G.majorTicks,G.minorTicks,G.tickLabels,G.domain,G.title];m.extend(w,{type:"group",interactive:!1,properties:{enter:{encode:d,scales:[e.scaleName],signals:[],data:[]},update:{encode:d,scales:[e.scaleName],signals:[],data:[]}}}),w.marks=y.map(function(e){return _(t,e)})}var r,a=v.axis.orient,y=0,x=v.axis.titleOffset,w={},k="front",E=!1,L=null,A=v.axis.tickSize,S=v.axis.tickSize,M=v.axis.tickSize,N=v.axis.padding,T=null,C=null,I=null,D=0,P=[v.axis.ticks],O={},j={},z={},R={},U={},F={},G={gridLines:null,majorTicks:null,minorTicks:null,tickLabels:null,domain:null,title:null},q={};return q.def=function(){w.type||n(r),I=C?"time"===r.type?d3.time.format(C):d3.format(C):null;var t=function(t){return{data:t}},e=null==T?r.ticks?r.ticks.apply(r,P):r.domain():T,s=i(r,e,D).map(t);e=e.map(t);var o=null==I?r.tickFormat?r.tickFormat.apply(r,P):String:I;e.forEach(function(t){t.label=o(t.data)});var l=L?[L].map(t):[];return w.marks[0].from=function(){return E?e:[]},w.marks[1].from=function(){return e},w.marks[2].from=function(){return s},w.marks[3].from=w.marks[1].from,w.marks[4].from=function(){return[1]},w.marks[5].from=function(){return l},w.offset=y,w.orient=a,w.layer=k,w},q.scale=function(t){return arguments.length?(r!==t&&(r=t,e()),q):r},q.orient=function(t){return arguments.length?(a!==t&&(a=t in b?t+"":v.axis.orient,e()),q):a},q.title=function(t){return arguments.length?(L!==t&&(L=t,e()),q):L},q.ticks=function(){return arguments.length?(P=arguments,q):P},q.tickValues=function(t){return arguments.length?(T=t,q):T},q.tickFormat=function(t){return arguments.length?(C!==t&&(C=t,e()),q):C},q.tickSize=function(t,n){if(!arguments.length)return A;var r=arguments.length-1,i=+t,a=r>1?+n:A,s=r>0?+arguments[r]:A;return(A!==i||S!==a||M!==s)&&e(),A=i,S=a,M=s,q},q.tickSubdivide=function(t){return arguments.length?(D=+t,q):D},q.offset=function(t){return arguments.length?(y=m.isObject(t)?t:+t,q):y},q.tickPadding=function(t){return arguments.length?(N!==+t&&(N=+t,e()),q):N},q.titleOffset=function(t){return arguments.length?(x!==+t&&(x=+t,e()),q):x},q.layer=function(t){return arguments.length?(k!==t&&(k=t,e()),q):k},q.grid=function(t){return arguments.length?(E!==t&&(E=t,e()),q):E},q.gridLineProperties=function(t){return arguments.length?(O!==t&&(O=t),q):O},q.majorTickProperties=function(t){return arguments.length?(z!==t&&(z=t),q):z},q.minorTickProperties=function(t){return arguments.length?(R!==t&&(R=t),q):R},q.tickLabelProperties=function(t){return arguments.length?(j!==t&&(j=t),q):j},q.titleProperties=function(t){return arguments.length?(U!==t&&(U=t),q):U},q.domainProperties=function(t){return arguments.length?(F!==t&&(F=t),q):F},q.reset=function(){e()},q}function i(t,e,n){if(r=[],n&&e.length>1){for(var r,i,s,o=a(t.domain()),l=-1,u=e.length,c=(e[1]-e[0])/++n;++l<u;)for(i=n;--i>0;)(s=+e[l]-i*c)>=o[0]&&r.push(s);for(--l,i=0;++i<n&&(s=+e[l]+i*c)<o[1];)r.push(s)}return r}function a(t){var e=t[0],n=t[t.length-1];return n>e?[e,n]:[n,e]}function s(t){return t.rangeExtent?t.rangeExtent():a(t.range())}function o(t,e,n,r,i,a){i=Math.max(i,0)+a,("left"===t||"top"===t)&&(i*=-1),"top"===t||"bottom"===t?(m.extend(e.properties.enter,{x:n,y:{value:i}}),m.extend(e.properties.update,{x:r,y:{value:i},align:{value:"center"},baseline:{value:w[t]}})):(m.extend(e.properties.enter,{x:{value:i},y:n}),m.extend(e.properties.update,{x:{value:i},y:r,align:{value:x[t]},baseline:{value:"middle"}}))}function l(t,e,n,r,i){var a="left"===t||"top"===t?-1:1;i=i===1/0?"top"===t||"bottom"===t?{group:"mark.group.height",mult:-a}:{group:"mark.group.width",mult:-a}:{value:a*i},"top"===t||"bottom"===t?(m.extend(e.properties.enter,{x:n,y:{value:0},y2:i}),m.extend(e.properties.update,{x:r,y:{value:0},y2:i}),m.extend(e.properties.exit,{x:r})):(m.extend(e.properties.enter,{x:{value:0},x2:i,y:n}),m.extend(e.properties.update,{x:{value:0},x2:i,y:r}),m.extend(e.properties.exit,{y:r}))}function u(t,e,n,r){var i=~~((n[0]+n[1])/2),a="top"===t||"left"===t?-1:1;"bottom"===t||"top"===t?m.extend(e.properties.update,{x:{value:i},y:{value:a*r},angle:{value:0}}):m.extend(e.properties.update,{x:{value:a*r},y:{value:i},angle:{value:-90}})}function c(t,e,n,r){var i;("top"===t||"left"===t)&&(r=-1*r),i="bottom"===t||"top"===t?"M"+n[0]+","+r+"V0H"+n[1]+"V"+r:"M"+r+","+n[0]+"H0V"+n[1]+"H"+r,e.properties.update.path={value:i}}function d(t,e,n,r,i,a){var s=n?{}:t,o=t.mark.def.offset,l=t.mark.def.orient,u=e.width,c=e.height;switch(m.isObject(o)&&(o=-e.scale(o.scale)(o.value)),l){case"left":y.set(s,"x",-o),y.set(s,"y",0);break;case"right":y.set(s,"x",u+o),y.set(s,"y",0);break;case"bottom":y.set(s,"x",0),y.set(s,"y",c+o);break;case"top":y.set(s,"x",0),y.set(s,"y",-o);break;default:y.set(s,"x",0),y.set(s,"y",0)}n&&n.interpolate(t,s)}function h(){return{type:"rule",interactive:!1,key:"data",properties:{enter:{stroke:{value:v.axis.tickColor},strokeWidth:{value:v.axis.tickWidth},opacity:{value:1e-6}},exit:{opacity:{value:1e-6}},update:{opacity:{value:1}}}}}function f(){return{type:"text",interactive:!0,key:"data",properties:{enter:{fill:{value:v.axis.tickLabelColor},font:{value:v.axis.tickLabelFont},fontSize:{value:v.axis.tickLabelFontSize},opacity:{value:1e-6},text:{field:"label"}},exit:{opacity:{value:1e-6}},update:{opacity:{value:1}}}}}function p(){return{type:"text",interactive:!0,properties:{enter:{font:{value:v.axis.titleFont},fontSize:{value:v.axis.titleFontSize},fontWeight:{value:v.axis.titleFontWeight},fill:{value:v.axis.titleColor},align:{value:"center"},baseline:{value:"middle"},text:{field:"data"}},update:{}}}}function g(){return{type:"path",interactive:!1,properties:{enter:{x:{value:.5},y:{value:.5},stroke:{value:v.axis.axisColor},strokeWidth:{value:v.axis.axisWidth}},update:{}}}}var m=t("datalib"),v=t("../util/config"),y=t("../dataflow/tuple"),_=t("../parse/mark"),b={top:1,right:1,bottom:1,left:1},x={bottom:"center",top:"center",left:"right",right:"left"},w={bottom:"top",top:"bottom",left:"middle",right:"middle"};e.exports=r},{"../dataflow/tuple":33,"../parse/mark":44,"../util/config":95,datalib:17}],71:[function(t,e,n){function r(t){return s.prototype.init.call(this,t),a.addParameters(this,{group_by:{type:"array<field>"}}),this._output={count:"count",avg:"avg",min:"min",max:"max",sum:"sum",mean:"mean","var":"var",stdev:"stdev",varp:"varp",stdevp:"stdevp",median:"median"},this._fieldsDef=null,this._Aggregators=null,this._singleton=!1,this}var i=t("datalib"),a=t("./Transform"),s=t("./GroupBy"),o=(t("../dataflow/tuple"),t("../dataflow/changeset"),t("./measures")),l=t("../util/debug"),u=t("../util/constants"),c=r.prototype=new s;c.fields={set:function(t,e){var n,r,a,s={};for(n=0,r=e.length;r>n;++n)a=e[n],a.name.signal&&(s[a.name.signal]=1),i.array(a.ops).forEach(function(t){t.signal&&(s[t.signal]=1)});return t._fieldsDef=e,t._Aggregators=null,t.aggs(),t.dependency(u.SIGNALS,i.keys(s)),t}},c.singleton=function(t){return arguments.length?(this._singleton=t,this):this._singleton},c.aggs=function(){var t,e,n,r,a,s=this,l=this._graph,c=this._fieldsDef,d=this._Aggregators;if(d)return d;for(d=this._Aggregators=[],e=0;e<c.length;e++)t=c[e],0!==t.ops.length&&(n=t.name.signal?l.signalRef(t.name.signal):t.name,r=i.array(t.ops.signal?l.signalRef(t.ops.signal):t.ops),a=r.map(function(t){return t=t.signal?l.signalRef(t.signal):t,o[t](n+"_"+s._output[t])}),d.push({accessor:i.accessor(n),field:this._singleton?u.SINGLETON:n,measures:o.create(a)}));return d},c._reset=function(t,e){return this._Aggregators=null,this.aggs(),s.prototype._reset.call(this,t,e)},c._keys=function(t){return this._gb.fields.length?s.prototype._keys.call(this,t):{keys:[],key:""}},c._new_cell=function(t,e){for(var n,r=s.prototype._new_cell.call(this,t,e),i=this.aggs(),a=0,o=i.length;o>a;a++)n=i[a],r[n.field]=new n.measures(r,r.tpl);return r},c._add=function(t){var e,n=this._cell(t),r=this.aggs(),i=0,a=r.length;for(n.cnt++;a>i;i++)e=r[i],n[e.field].add(e.accessor(t));n.flg|=u.MOD_CELL},c._rem=function(t){var e,n=this._cell(t),r=this.aggs(),i=0,a=r.length;for(n.cnt--;a>i;i++)e=r[i],n[e.field].rem(e.accessor(t));n.flg|=u.MOD_CELL},c.transform=function(t,e){l(t,["aggregate"]),this._gb=this.group_by.get(this._graph);var n,r,i,a=s.prototype.transform.call(this,t,e),o=this.aggs(),u=o.length;for(r in this._cells)if(i=this._cells[r])for(n=0;u>n;n++)i[o[n].field].set();return a},e.exports=r},{"../dataflow/changeset":32,"../dataflow/tuple":33,"../util/constants":96,"../util/debug":97,"./GroupBy":82,"./Transform":88,"./measures":93,datalib:17}],72:[function(t,e,n){function r(){}var i=t("./Transform"),a=t("../dataflow/Collector"),s=r.prototype=new i;s.init=function(t){return i.prototype.init.call(this,t),this._collector=new a(t),this},s.transform=function(t){this._collector.evaluate(t);var e=this._collector.data();return this.batchTransform(t,e)},s.batchTransform=function(t,e){},e.exports=r},{"../dataflow/Collector":27,"./Transform":88}],73:[function(t,e,n){function r(t){return a.prototype.init.call(this,t),a.addParameters(this,{field:{type:"field"},min:{type:"value"},max:{type:"value"},step:{type:"value"},maxbins:{type:"value","default":20}}),this._output={bin:"bin"},this}var i=t("datalib"),a=t("./Transform"),s=t("../dataflow/tuple"),o=r.prototype=new a;o.transform=function(t){function e(e){var i=n.field.get().accessor(e);i=null==i?null:a.start+a.step*~~((i-a.start)/a.step),s.set(e,r,i,t.stamp)}var n=this,r=this._output.bin,a=i.bin({min:this.min.get(),max:this.max.get(),step:this.step.get(),maxbins:this.maxbins.get()});return t.add.forEach(e),t.mod.forEach(e),t.rem.forEach(e),t},e.exports=r},{"../dataflow/tuple":33,"./Transform":88,datalib:17}],74:[function(t,e,n){function r(t){return u.prototype.init.call(this,t),u.addParameters(this,{"with":{type:"data"},diagonal:{type:"value","default":"true"}}),this._output={left:"a",right:"b"},this._collector=new c(t),this._lastRem=null,this._lastWith=null,this._ids={},this._cache={},this.router(!0)}function i(t,e){var n=this._cache[t._id]=this._cache[t._id]||{c:[],s:this._stamp};n.c.push(e)}function a(t,e,n,r,a){for(var s,o,l,u=e?n:this._collector.data(),c=0,d=u.length,f=void 0!==a._prev?null:void 0;d>c;++c)o=u[c],l=e?a._id+"_"+o._id:o._id+"_"+a._id,this._ids[l]||(a._id!=o._id||r)&&(s=h.ingest({},f),s[this._output.left]=e?a:o,s[this._output.right]=e?o:a,t.add.push(s),i.call(this,a,s),i.call(this,o,s),this._ids[l]=1)}function s(t,e,n){var r=this,i=this._cache[n._id];this._lastRem>i.s&&(i.c=i.c.filter(function(t){var n=t[r._output[e?"right":"left"]];return null!==r._cache[n._id]}),i.s=this._lastRem),t.mod.push.apply(t.mod,i.c)}function o(t,e){t.rem.push.apply(t.rem,this._cache[e._id].c),this._cache[e._id]=null,this._lastRem=this._stamp}function l(t,e){(t.add.length||t.rem.length)&&(e.fields[this._output.left]=1,e.fields[this._output.right]=1)}var u=t("./Transform"),c=t("../dataflow/Collector"),d=t("../util/debug"),h=t("../dataflow/tuple"),f=t("../dataflow/changeset"),p=r.prototype=new u;p.transform=function(t){d(t,["crossing"]),this._collector.evaluate(t);var e=this["with"].get(this._graph),n=this.diagonal.get(this._graph),r=!e.name,i=this._collector.data(),u=r?t:e.source.last(),c=r?i:e.source.values(),h=f.create(t),p=o.bind(this,h);return t.rem.forEach(p),t.add.forEach(a.bind(this,h,!0,c,n)),!r&&u.stamp>this._lastWith&&(u.rem.forEach(p),u.add.forEach(a.bind(this,h,!1,i,n)),u.mod.forEach(s.bind(this,h,!1)),l.call(this,u,h),this._lastWith=u.stamp),t.mod.forEach(s.bind(this,h,!0)),l.call(this,t,h),h},e.exports=r},{"../dataflow/Collector":27,"../dataflow/changeset":32,"../dataflow/tuple":33,"../util/debug":97,"./Transform":88}],75:[function(t,e,n){function r(t){return a.prototype.init.call(this,t),i.addParameters(this,{keys:{type:"array<field>"}}),this._pipeline=[],this}var i=t("./Transform"),a=t("./GroupBy"),s=t("../dataflow/tuple"),o=t("../dataflow/changeset"),l=t("../util/debug"),u=t("../util/constants"),c=r.prototype=new a;c.pipeline=function(t){return arguments.length?(this._pipeline=t,this):this._pipeline},c._reset=function(t,e){var n,r;for(n in this._cells)r=this._cells[n],r&&(e.rem.push(r.tpl),r["delete"]());this._cells={}},c._new_tuple=function(t,e){return s.ingest(e,null)},c._new_cell=function(t,e){var n=a.prototype._new_cell.call(this,t,e),r=this._pipeline.map(function(t){return t.clone()}),i=this,s=n.tpl;return n.ds=this._graph.data("vg_"+s._id,r,s),n["delete"]=function(){l({},["deleting cell",e.key]),i.removeListener(r[0]),i._graph.disconnect(r);

},this.addListener(r[0]),n},c._add=function(t){var e=a.prototype._add.call(this,t);return e.ds._input.add.push(t),e},c._mod=function(t,e){var n=a.prototype._mod.call(this,t,e);return n.flg&u.ADD_CELL||n.ds._input.mod.push(t),n.flg|=u.MOD_CELL,n},c._rem=function(t){var e=a.prototype._rem.call(this,t);return e.ds._input.rem.push(t),e},c.transform=function(t,e){l(t,["faceting"]),this._gb=this.keys.get(this._graph);var n,r,i=a.prototype.transform.call(this,t,e);for(n in this._cells)r=this._cells[n],null!=r&&(0===r.cnt?r["delete"]():o.copy(t,r.ds._input));return i},e.exports=r},{"../dataflow/changeset":32,"../dataflow/tuple":33,"../util/constants":96,"../util/debug":97,"./GroupBy":82,"./Transform":88}],76:[function(t,e,n){function r(t){return a.prototype.init.call(this,t),a.addParameters(this,{test:{type:"expr"}}),this._skip={},this}function i(t){return o.eval(this._graph,this.test.get(this._graph),t,null,null,null,this.dependency(u.SIGNALS))}var a=t("./Transform"),s=t("../dataflow/changeset"),o=t("../parse/expr"),l=t("../util/debug"),u=t("../util/constants"),c=r.prototype=new a;c.transform=function(t){l(t,["filtering"]);var e=s.create(t),n=this._skip,r=this;return t.rem.forEach(function(t){1!==n[t._id]?e.rem.push(t):n[t._id]=0}),t.add.forEach(function(t){i.call(r,t)?e.add.push(t):n[t._id]=1}),t.mod.forEach(function(t){var a=i.call(r,t),s=1===n[t._id];a&&s?(n[t._id]=0,e.add.push(t)):a&&!s?e.mod.push(t):!a&&s||(e.rem.push(t),n[t._id]=1)}),e},e.exports=r},{"../dataflow/changeset":32,"../parse/expr":42,"../util/constants":96,"../util/debug":97,"./Transform":88}],77:[function(t,e,n){function r(t){return o.prototype.init.call(this,t),o.addParameters(this,{fields:{type:"array<field>"}}),this._output={key:"key",value:"value"},this._cache={},this.router(!0).revises(!0)}function i(t,e){for(var n in this._cache)e.rem.push.apply(e.rem,this._cache[n]);this._cache={}}function a(t,e,n){var r=this._cache[t._id]||(this._cache[t._id]=Array(n));return r[e]||(r[e]=u.derive(t,t._prev))}function s(t,e,n,r,i){for(var s,o,l,c=0,d=t.length,h=e.length;d>c;++c)for(o=t[c],s=0;h>s;++s)l=a.call(this,o,s,h),u.set(l,this._output.key,e[s]),u.set(l,this._output.value,n[s](o)),r.push(l)}var o=t("./Transform"),l=t("../util/debug"),u=t("../dataflow/tuple"),c=t("../dataflow/changeset"),d=r.prototype=new o;d.transform=function(t,e){l(t,["folding"]);var n=this,r=this.fields.get(this._graph),a=r.fields,o=r.accessors,u=c.create(t);return e&&i.call(this,t,u),s.call(this,t.add,a,o,u.add,t.stamp),s.call(this,t.mod,a,o,e?u.add:u.mod,t.stamp),t.rem.forEach(function(t){u.rem.push.apply(u.rem,n._cache[t._id]),n._cache[t._id]=null}),(t.add.length||t.rem.length||a.some(function(e){return!!t.fields[e]}))&&(u.fields[this._output.key]=1,u.fields[this._output.value]=1),u},e.exports=r},{"../dataflow/changeset":32,"../dataflow/tuple":33,"../util/debug":97,"./Transform":88}],78:[function(t,e,n){(function(n){function r(t){return s.prototype.init.call(this,t),s.addParameters(this,{size:{type:"array<value>","default":[500,500]},links:{type:"data"},linkDistance:{type:"field","default":20},linkStrength:{type:"field","default":1},charge:{type:"field","default":30},chargeDistance:{type:"field","default":1/0},iterations:{type:"value","default":500},friction:{type:"value","default":.9},theta:{type:"value","default":.8},gravity:{type:"value","default":.1},alpha:{type:"value","default":.1}}),this._nodes=[],this._links=[],this._layout=a.layout.force(),this._output={x:"layout:x",y:"layout:y",source:"_source",target:"_target"},this}function i(t,e){var n=t[e].get(t._graph);return n.accessor?function(t){return n.accessor(t.tuple)}:n.field}var a="undefined"!=typeof window?window.d3:"undefined"!=typeof n?n.d3:null,s=t("./Transform"),o=t("../dataflow/tuple"),l=r.prototype=new s;l.transform=function(t){var e=this._graph,n=this.links.get(e).source.last(),r=this._layout,a=this._output,s=this._nodes,l=this._links,u=this.iterations.get(e);t.add.forEach(function(t){s.push({tuple:t})}),n.add.forEach(function(t){var e={tuple:t,source:s[t.source],target:s[t.target]};o.set(t,a.source,e.source.tuple),o.set(t,a.target,e.target.tuple),l.push(e)}),r.size(this.size.get(e)).linkDistance(i(this,"linkDistance")).linkStrength(i(this,"linkStrength")).charge(i(this,"charge")).chargeDistance(i(this,"chargeDistance")).friction(this.friction.get(e)).theta(this.theta.get(e)).gravity(this.gravity.get(e)).alpha(this.alpha.get(e)).nodes(s).links(l),r.start();for(var c=0;u>c;++c)r.tick();if(r.stop(),s.forEach(function(t){o.set(t.tuple,a.x,t.x),o.set(t.tuple,a.y,t.y)}),t.rem.length>0){var d=o.idMap(t.rem);this._nodes=s.filter(function(t){return!d[t.tuple._id]})}if(n.rem.length>0){var h=o.idMap(n.rem);this._links=l.filter(function(t){return!h[t.tuple._id]})}return t.fields[a.x]=1,t.fields[a.y]=1,t},e.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../dataflow/tuple":33,"./Transform":88}],79:[function(t,e,n){function r(t){return i.prototype.init.call(this,t),i.addParameters(this,{field:{type:"value"},expr:{type:"expr"}}),this}var i=t("./Transform"),a=t("../dataflow/tuple"),s=t("../parse/expr"),o=t("../util/debug"),l=t("../util/constants"),u=r.prototype=new i;u.transform=function(t){function e(t){var e=s.eval(n,i,t,null,null,null,u);a.set(t,r,e)}o(t,["formulating"]);var n=this._graph,r=this.field.get(n),i=this.expr.get(n),u=this.dependency(l.SIGNALS);return t.add.forEach(e),this.reevaluate(t)&&t.mod.forEach(e),t.fields[r]=1,t},e.exports=r},{"../dataflow/tuple":33,"../parse/expr":42,"../util/constants":96,"../util/debug":97,"./Transform":88}],80:[function(t,e,n){(function(n){function r(t){return s.prototype.init.call(this,t),s.addParameters(this,r.Parameters),s.addParameters(this,{lon:{type:"field"},lat:{type:"field"}}),this._output={x:"geo:x",y:"geo:y"},this}var i=t("datalib"),a="undefined"!=typeof window?window.d3:"undefined"!=typeof n?n.d3:null,s=t("./Transform"),o=t("../dataflow/tuple");r.Parameters={projection:{type:"value","default":"mercator"},center:{type:"array[value]"},translate:{type:"array[value]"},rotate:{type:"array[value]"},scale:{type:"value"},precision:{type:"value"},clipAngle:{type:"value"},clipExtent:{type:"value"}},r.d3Projection=function(){var t,e,n,s=this._graph,o=this.projection.get(s),l=r.Parameters;o!==this._mode&&(this._mode=o,this._projection=a.geo[o]()),t=this._projection;for(e in l)"projection"!==e&&t[e]&&(n=this[e].get(s),void 0===n||i.isArray(n)&&0===n.length||n!==t[e]()&&t[e](n));return t};var l=r.prototype=new s;l.transform=function(t){function e(t){var e=[a(t),s(t)],n=l(e);o.set(t,i.x,n[0]),o.set(t,i.y,n[1])}var n=this._graph,i=this._output,a=this.lon.get(n).accessor,s=this.lat.get(n).accessor,l=r.d3Projection.call(this);return t.add.forEach(e),this.reevaluate(t)&&(t.mod.forEach(e),t.rem.forEach(e)),t.fields[i.x]=1,t.fields[i.y]=1,t},e.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../dataflow/tuple":33,"./Transform":88,datalib:17}],81:[function(t,e,n){(function(n){function r(t){return o.prototype.init.call(this,t),o.addParameters(this,s.Parameters),o.addParameters(this,{value:{type:"field","default":null}}),this._output={path:"geo:path"},this}var i=t("datalib"),a="undefined"!=typeof window?window.d3:"undefined"!=typeof n?n.d3:null,s=t("./Geo"),o=t("./Transform"),l=t("../dataflow/tuple"),u=r.prototype=new o;u.transform=function(t){function e(t){l.set(t,r.path,c(o(t)))}var n=this._graph,r=this._output,o=this.value.get(n).accessor||i.identity,u=s.d3Projection.call(this),c=a.geo.path().projection(u);return t.add.forEach(e),this.reevaluate(t)&&(t.mod.forEach(e),t.rem.forEach(e)),t.fields[r.path]=1,t},e.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../dataflow/tuple":33,"./Geo":80,"./Transform":88,datalib:17}],82:[function(t,e,n){function r(t){return t&&this.init(t),this}var i=t("./Transform"),a=t("../dataflow/tuple"),s=t("../dataflow/changeset"),o=t("../util/constants"),l=r.prototype=new i;l.init=function(t){return this._gb=null,this._cells={},i.prototype.init.call(this,t).router(!0).revises(!0)},l.data=function(){return this._cells},l._reset=function(t,e){var n,r;for(n in this._cells)(r=this._cells[n])&&e.rem.push(r.tpl);this._cells={}},l._keys=function(t){var e,n=this._gb.accessors||[this._gb.accessor],r=n.reduce(function(n,r){return void 0!==(e=r(t))?(n.push(e),n):n},[]),i=r.join("|");return r.length>0?{keys:r,key:i}:void 0},l._cell=function(t){var e=this._keys(t);return this._cells[e.key]||(this._cells[e.key]=this._new_cell(t,e))},l._new_cell=function(t,e){return{cnt:0,tpl:this._new_tuple(t,e),flg:o.ADD_CELL}},l._new_tuple=function(t,e){var n,r,i=this._gb,s=i.fields||[i.field],o=i.accessors||[i.accessor],l={};for(n=0,r=s.length;r>n;++n)l[s[n]]=o[n](t);return a.ingest(l,null)},l._add=function(t){var e=this._cell(t);return e.cnt+=1,e.flg|=o.MOD_CELL,e},l._rem=function(t){var e=this._cell(t);return e.cnt-=1,e.flg|=o.MOD_CELL,e},l._mod=function(t,e){return t._prev&&t._prev!==o.SENTINEL&&void 0!==this._keys(t._prev)?(this._rem(t._prev),this._add(t)):e?this._add(t):this._cell(t)},l.transform=function(t,e){var n,r,i,a,l=this,u=s.create(t);e&&this._reset(t,u),t.add.forEach(function(t){l._add(t)}),t.mod.forEach(function(t){l._mod(t,e)}),t.rem.forEach(function(t){l._rem(t._prev&&t._prev!==o.SENTINEL&&void 0!==l._keys(t._prev)?t._prev:t)});for(n in this._cells)r=this._cells[n],r&&(i=r.flg,a=r.tpl,0===r.cnt?(i===o.MOD_CELL&&u.rem.push(a),this._cells[n]=null):i&o.ADD_CELL?u.add.push(a):i&o.MOD_CELL&&u.mod.push(a),r.flg=0);return u},e.exports=r},{"../dataflow/changeset":32,"../dataflow/tuple":33,"../util/constants":96,"./Transform":88}],83:[function(t,e,n){function r(t){return l.prototype.init.call(this,t),l.addParameters(this,{source:{type:"field","default":"_source"},target:{type:"field","default":"_target"},x:{type:"field","default":"layout:x"},y:{type:"field","default":"layout:y"},tension:{type:"value","default":.2},shape:{type:"value","default":"line"}}),this._output={path:"link:path"},this}function i(t,e,n,r,i,a){var s=e(t),o=r(s),l=i(s),u=n(t),c=r(u),d=i(u);return"M"+o+","+l+"L"+c+","+d}function a(t,e,n,r,i,a){var s=e(t),o=r(s),l=i(s),u=n(t),c=r(u),d=i(u),h=c-o,f=d-l,p=a*(h+f),g=a*(f-h);return"M"+o+","+l+"C"+(o+p)+","+(l+g)+" "+(c+g)+","+(d-p)+" "+c+","+d}function s(t,e,n,r,i,a){var s=e(t),o=r(s),l=i(s),u=n(t),c=r(u),d=i(u),h=(o+c)/2;return"M"+o+","+l+"C"+h+","+l+" "+h+","+d+" "+c+","+d}function o(t,e,n,r,i,a){var s=e(t),o=r(s),l=i(s),u=n(t),c=r(u),d=i(u),h=(l+d)/2;return"M"+o+","+l+"C"+o+","+h+" "+c+","+h+" "+c+","+d}var l=t("./Transform"),u=t("../dataflow/tuple"),c=r.prototype=new l,d={line:i,curve:a,diagonal:s,diagonalX:s,diagonalY:o};c.transform=function(t){function e(t){var e=i(t,a,s,o,l,c);u.set(t,r.path,e)}var n=this._graph,r=this._output,i=d[this.shape.get(n)]||d.line,a=this.source.get(n).accessor,s=this.target.get(n).accessor,o=this.x.get(n).accessor,l=this.y.get(n).accessor,c=this.tension.get(n);return t.add.forEach(e),this.reevaluate(t)&&t.mod.forEach(e),t.fields[r.path]=1,t},e.exports=r},{"../dataflow/tuple":33,"./Transform":88}],84:[function(t,e,n){function r(t,e){this._name=t,this._type=e,this._value=[],this._accessors=[],this._resolution=!1,this._signals={}}var i=t("datalib"),a=t("../parse/expr"),s=t("../util/constants"),o=/array/i,l=/data/i,u=/field/i,c=/expr/i,d=r.prototype;d._get=function(){var t=o.test(this._type),e=l.test(this._type),n=u.test(this._type);return e?t?{names:this._value,sources:this._accessors}:{name:this._value[0],source:this._accessors[0]}:n?t?{fields:this._value,accessors:this._accessors}:{field:this._value[0],accessor:this._accessors[0]}:t?this._value:this._value[0]},d.get=function(t){var e,n,r,a=l.test(this._type),s=u.test(this._type);if(!this._resolution)return this._get();if(a)return this._accessors=this._value.map(function(e){return t.data(e)}),this._get();for(e in this._signals)n=this._signals[e],r=t.signalRef(e),s&&(this._accessors[n]=this._value[n]!=r?i.accessor(r):this._accessors[n]),this._value[n]=r;return this._get()},d.set=function(t,e){var n=this,r=c.test(this._type),o=l.test(this._type),d=u.test(this._type);return this._value=i.array(e).map(function(e,l){if(i.isString(e)){if(r){var u=a(e);return t.dependency(s.FIELDS,u.fields),t.dependency(s.SIGNALS,u.signals),u.fn}return d?(n._accessors[l]=i.accessor(e),t.dependency(s.FIELDS,e)):o&&(n._resolution=!0,t.dependency(s.DATA,e)),e}return void 0!==e.value?e.value:void 0!==e.field?(n._accessors[l]=i.accessor(e.field),t.dependency(s.FIELDS,e.field),e.field):void 0!==e.signal?(n._resolution=!0,n._signals[e.signal]=l,t.dependency(s.SIGNALS,e.signal),e.signal):e}),t},e.exports=r},{"../parse/expr":42,"../util/constants":96,datalib:17}],85:[function(t,e,n){(function(n){function r(t){return l.prototype.init.call(this,t),o.addParameters(this,{value:{type:"field","default":null},startAngle:{type:"value","default":0},endAngle:{type:"value","default":2*Math.PI},sort:{type:"value","default":!1}}),this._output={start:"layout:start",stop:"layout:stop",mid:"layout:mid"},this}function i(){return 1}var a=t("datalib"),s="undefined"!=typeof window?window.d3:"undefined"!=typeof n?n.d3:null,o=t("./Transform"),l=t("./BatchTransform"),u=t("../dataflow/tuple"),c=r.prototype=new l;c.batchTransform=function(t,e){var n,r,o,l=this._graph,c=this._output,d=this.value.get(l).accessor||i,h=this.startAngle.get(l),f=this.endAngle.get(l),p=this.sort.get(l),g=e.map(d),m=h,v=(f-h)/s.sum(g),y=a.range(e.length);for(p&&y.sort(function(t,e){return g[t]-g[e]}),n=0;n<y.length;++n)r=e[y[n]],o=g[y[n]],u.set(r,c.start,m),u.set(r,c.mid,m+.5*o*v),u.set(r,c.stop,m+=o*v);return t.fields[c.start]=1,t.fields[c.stop]=1,t.fields[c.mid]=1,t},e.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../dataflow/tuple":33,"./BatchTransform":72,"./Transform":88,datalib:17}],86:[function(t,e,n){function r(t){return a.prototype.init.call(this,t),a.addParameters(this,{by:{type:"array<field>"}}),this.router(!0)}var i=t("datalib"),a=t("./Transform"),s=(t("../parse/expr"),t("../util/debug")),o=r.prototype=new a;o.transform=function(t){return s(t,["sorting"]),(t.add.length||t.mod.length||t.rem.length)&&(t.sort=i.comparator(this.by.get(this._graph).fields)),t},e.exports=r},{"../parse/expr":42,"../util/debug":97,"./Transform":88,datalib:17}],87:[function(t,e,n){function r(t){return o.prototype.init.call(this,t),s.addParameters(this,{groupby:{type:"array<field>"},sortby:{type:"array<field>"},value:{type:"field"},offset:{type:"value","default":"zero"}}),this._output={start:"layout:start",stop:"layout:stop",mid:"layout:mid"},this}function i(t,e,n,r){var i,a,s,o,l,u,c,d=[];if(null==e)d.push(t.slice());else for(i={},a=0;a<t.length;++a)s=t[a],o=e.map(function(t){return t(s)}),l=i[o]||(d.push(i[o]=[]),i[o]),l.push(s);for(o=0,c=0;o<d.length;++o){for(l=d[o],a=0,u=0;a<l.length;++a)u+=r(l[a]);l.sum=u,u>c&&(c=u),null!=n&&l.sort(n)}return d.max=c,d}var a=t("datalib"),s=t("./Transform"),o=t("./BatchTransform"),l=t("../dataflow/tuple"),u=r.prototype=new o;u.batchTransform=function(t,e){for(var n=this._graph,r=this.groupby.get(n).accessors,s=a.comparator(this.sortby.get(n).fields),o=this.value.get(n).accessor,u=this.offset.get(n),c=this._output,d=i(e,r,s,o),h=0,f=d.max;h<d.length;++h){var h,p,g,m=d[h],v=m.sum,y="center"===u?(f-v)/2:0,_="normalize"===u?1/v:1,b=y,x=0;for(j=0;j<m.length;++j)p=m[j],g=b,x+=o(p),b=_*x+y,l.set(p,c.start,g),l.set(p,c.stop,b),l.set(p,c.mid,.5*(g+b))}return t.fields[c.start]=1,t.fields[c.stop]=1,t.fields[c.mid]=1,t},e.exports=r},{"../dataflow/tuple":33,"./BatchTransform":72,"./Transform":88,datalib:17}],88:[function(t,e,n){function r(t){return t&&i.prototype.init.call(this,t),this}var i=t("../dataflow/Node"),a=t("./Parameter"),s=t("../util/constants");r.addParameters=function(t,e){var n;for(var r in e)n=e[r],t[r]=new a(r,n.type),n.hasOwnProperty("default")&&t[r].set(t,n["default"]);t._parameters=e};var o=r.prototype=new i;o.clone=function(){var t=i.prototype.clone.call(this);t.transform=this.transform,t._parameters=this._parameters;for(var e in this)t[e]||(t[e]=this[e]);return t},o.transform=function(t,e){return t},o.evaluate=function(t){var e=this._stamp<t.stamp&&this.dependency(s.SIGNALS).some(function(e){return!!t.signals[e]});return this.transform(t,e)},o.output=function(t){for(var e in this._output)void 0!==t[e]&&(this._output[e]=t[e]);return this},e.exports=r},{"../dataflow/Node":30,"../util/constants":96,"./Parameter":84}],89:[function(t,e,n){(function(n){function r(t){return o.prototype.init.call(this,t),s.addParameters(this,{sort:{type:"array<field>","default":["-value"]},children:{type:"field","default":"children"},value:{type:"field","default":"value"},size:{type:"array<value>","default":[500,500]},round:{type:"value","default":!0},sticky:{type:"value","default":!1},ratio:{type:"value","default":.5*(1+Math.sqrt(5))},padding:{type:"value","default":null},mode:{type:"value","default":"squarify"}}),this._layout=a.layout.treemap(),this._output={x:"layout:x",y:"layout:y",width:"layout:width",height:"layout:height"},this}var i=t("datalib"),a="undefined"!=typeof window?window.d3:"undefined"!=typeof n?n.d3:null,s=t("./Transform"),o=t("./BatchTransform"),l=t("../dataflow/tuple"),u=r.prototype=new o;u.batchTransform=function(t,e){var n=this._graph,r=this._layout,a=this._output;return r.sort(i.comparator(this.sort.get(n).fields)).children(this.children.get(n).accessor).value(this.value.get(n).accessor).size(this.size.get(n)).round(this.round.get(n)).sticky(this.sticky.get(n)).ratio(this.ratio.get(n)).padding(this.padding.get(n)).mode(this.mode.get(n)).nodes(e[0]),e.forEach(function(t){l.set(t,a.x,t.x),l.set(t,a.y,t.y),l.set(t,a.width,t.dx),l.set(t,a.height,t.dy)}),t.fields[a.x]=1,t.fields[a.y]=1,t.fields[a.width]=1,t.fields[a.height]=1,t},e.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../dataflow/tuple":33,"./BatchTransform":72,"./Transform":88,datalib:17}],90:[function(t,e,n){function r(t){return a.prototype.init.call(this,t),i.addParameters(this,{field:{type:"field"},as:{type:"value"}}),this}var i=t("./Transform"),a=t("./GroupBy"),s=t("../dataflow/tuple"),o=t("../util/debug"),l=r.prototype=new a;l._new_tuple=function(t){var e={},n=this.field.get(this._graph),r=this.as.get(this._graph);return e[r]=n.accessor(t),s.ingest(e,null)},l.transform=function(t,e){return o(t,["uniques"]),this._gb=this.field.get(this._graph),a.prototype.transform.call(this,t,e)},e.exports=r},{"../dataflow/tuple":33,"../util/debug":97,"./GroupBy":82,"./Transform":88}],91:[function(t,e,n){function r(t){return s.prototype.init.call(this,t),s.addParameters(this,{"with":{type:"data"},as:{type:"value"},key:{type:"field","default":"data"},withKey:{type:"field","default":null},"default":{type:"value"}}),this._map={},this._collector=new o(t),this._lastJoin=0,this.revises(!0)}function i(t){return this._map[t]||(this._map[t]=[])}var a=t("datalib"),s=t("./Transform"),o=t("../dataflow/Collector"),l=t("../util/debug"),u=r.prototype=new s;u.transform=function(t){var e=this["with"].get(this._graph),n=e.source,r=n.last(),s=n.values(),o=this.key.get(this._graph),u=this.withKey.get(this._graph),c=this.as.get(this._graph),d=this["default"].get(this._graph),h=i.bind(this),f={};if(l(t,["zipping",e.name]),u.field)r&&r.stamp>this._lastJoin&&(r.rem.forEach(function(t){var e=h(u.accessor(t));e[0]&&e[0].forEach(function(t){t[c]=d}),e[1]=null}),r.add.forEach(function(t){var e=h(u.accessor(t));e[0]&&e[0].forEach(function(e){e[c]=t}),e[1]=t}),r.fields[u.field]&&r.mod.forEach(function(t){var e;if(t._prev&&void 0!==(e=u.accessor(t._prev))){var n=h(e);n[0]&&n[0].forEach(function(t){t[c]=d}),n[1]=null;var r=h(u.accessor(t));r[0]&&r[0].forEach(function(e){e[c]=t}),r[1]=t}}),this._lastJoin=r.stamp),t.add.forEach(function(t){var e=h(o.accessor(t));t[c]=e[1]||d,(e[0]=e[0]||[]).push(t)}),t.rem.forEach(function(t){var e=o.accessor(t);(f[e]=f[e]||{})[t._id]=1}),t.fields[o.field]&&t.mod.forEach(function(t){var e;if(t._prev&&void 0!==(e=o.accessor(t._prev))){var n=h(o.accessor(t));t[c]=n[1]||d,(n[0]=n[0]||[]).push(t),(f[e]=f[e]||{})[t._id]=1}}),a.keys(f).forEach(function(t){var e=h(t);e[0]&&(e[0]=e[0].filter(function(e){return 1!==f[t][e._id]}))});else{if(0==t.add.length&&0==t.rem.length&&0==r.add.length&&0==r.rem.length)return t;this._collector.evaluate(t);var p,g=this._collector.data(),m=s.length;for(p=0;p<g.length;p++)g[p][c]=s[p%m]}return t.fields[c]=1,t},e.exports=r},{"../dataflow/Collector":27,"../util/debug":97,"./Transform":88,datalib:17}],92:[function(t,e,n){e.exports={aggregate:t("./Aggregate"),bin:t("./Bin"),cross:t("./Cross"),linkpath:t("./LinkPath"),facet:t("./Facet"),filter:t("./Filter"),fold:t("./Fold"),force:t("./Force"),formula:t("./Formula"),geo:t("./Geo"),geopath:t("./GeoPath"),pie:t("./Pie"),sort:t("./Sort"),stack:t("./Stack"),treemap:t("./Treemap"),unique:t("./Unique"),zip:t("./Zip")}},{"./Aggregate":71,"./Bin":73,"./Cross":74,"./Facet":75,"./Filter":76,"./Fold":77,"./Force":78,"./Formula":79,"./Geo":80,"./GeoPath":81,"./LinkPath":83,"./Pie":85,"./Sort":86,"./Stack":87,"./Treemap":89,"./Unique":90,"./Zip":91}],93:[function(t,e,n){function r(t){return function(e){var n=Object.create(t);return n.out=e||t.name,n.idx||(n.idx=0),n}}function i(t){function e(t,n){return(n.req||[]).forEach(function(n){t[n]||e(t,t[n]=c[n]())}),t}var n=t.reduce(e,t.reduce(function(t,e){return t[e.name]=e,t},{})),r=[];for(var i in n)r.push(n[i]);return r.sort(function(t,e){return t.idx-e.idx}),r}function a(t){var e=i(t),n="this.tpl = t; this.cell = c;",r="",a="",c="var t = this.tpl;";return e.forEach(function(t){n+=t.init,r+=t.add,a+=t.rem}),t.forEach(function(t){c+="this.tuple.set(t,'"+t.out+"',"+t.set+");"}),c+="return t;",n=Function("c","t",n),n.prototype.add=Function("v",r),n.prototype.rem=Function("v",a),n.prototype.set=Function("stamp",c),n.prototype.mod=s,n.prototype.keys=o.keys,n.prototype.sel=u,n.prototype.tuple=l,n}function s(t,e){void 0!==e&&e!==t&&(this.rem(e),this.add(t))}var o=t("datalib"),l=t("../dataflow/tuple"),u=t("../util/quickselect"),c=(t("../util/constants"),{count:r({name:"count",init:"",add:"",rem:"",set:"this.cell.cnt"}),_counts:r({name:"_counts",init:"this.cnts = {};",add:"this.cnts[v] = ++this.cnts[v] || 1;",rem:"this.cnts[v] = --this.cnts[v] < 0 ? 0 : this.cnts[v];",set:"",req:["count"]}),sum:r({name:"sum",init:"this.sum = 0;",add:"this.sum += v;",rem:"this.sum -= v;",set:"this.sum"}),avg:r({name:"avg",init:"this.avg = 0;",add:"var d = v - this.avg; this.avg += d / this.cell.cnt;",rem:"var d = v - this.avg; this.avg -= d / this.cell.cnt;",set:"this.avg",req:["count"],idx:1}),"var":r({name:"var",init:"this.dev = 0;",add:"this.dev += d * (v - this.avg);",rem:"this.dev -= d * (v - this.avg);",set:"this.dev / (this.cell.cnt-1)",req:["avg"],idx:2}),varp:r({name:"varp",init:"",add:"",rem:"",set:"this.dev / this.cell.cnt",req:["var"],idx:3}),stdev:r({name:"stdev",init:"",add:"",rem:"",set:"Math.sqrt(this.dev / (this.cell.cnt-1))",req:["var"],idx:4}),stdevp:r({name:"stdevp",init:"",add:"",rem:"",set:"Math.sqrt(this.dev / this.cell.cnt)",req:["var"],idx:5}),min:r({name:"min",init:"this.min = +Infinity;",add:"this.min = v < this.min ? v : this.min;",rem:"var self = this; this.min = v == this.min ? this.keys(this.cnts).reduce(function(m, v) {    return self.cnts[(v = +v)] > 0 && v < m ? v : m }, +Infinity) : this.min;",set:"this.min",req:["_counts"],idx:6}),max:r({name:"max",init:"this.max = -Infinity;",add:"this.max = v > this.max ? v : this.max;",rem:"var self = this; this.max = v == this.max ? this.keys(this.cnts).reduce(function(m, v) {    return self.cnts[(v = +v)] > 0 && v > m ? v : m }, -Infinity) : this.max;",set:"this.max",req:["_counts"],idx:7}),median:r({name:"median",init:"this.vals = []; ",add:"if(this.vals) this.vals.push(v); ",rem:"this.vals = null;",set:"this.cell.cnt % 2 ? this.sel(~~(this.cell.cnt/2), this.vals, this.cnts) : 0.5 * (this.sel(~~(this.cell.cnt/2)-1, this.vals, this.cnts) + this.sel(~~(this.cell.cnt/2), this.vals, this.cnts))",req:["_counts"],idx:8})});c.create=a,e.exports=c},{"../dataflow/tuple":33,"../util/constants":96,"../util/quickselect":98,datalib:17}],94:[function(t,e,n){(function(n){function r(t){return(t.fontStyle?t.fontStyle+" ":"")+(t.fontVariant?t.fontVariant+" ":"")+(t.fontWeight?t.fontWeight+" ":"")+(null!=t.fontSize?t.fontSize:x.render.fontSize)+"px "+(t.font||x.render.font)}function i(){return N||(N=y.select("body").append("canvas").attr("class","vega_hidden").attr("width",1).attr("height",1).style("display","none").node().getContext("2d"))}function a(t,e,n){return null==e?n.set(0,0,0,0):(k(e,n),t.stroke&&0!==t.opacity&&t.strokeWidth>0&&n.expand(t.strokeWidth)),n}function s(t,e){var n=t.path?t.pathCache||(t.pathCache=w(t.path)):null;return a(t,n,e)}function o(t,e){var n=t.mark.items,t=n[0],r=t.pathCache||(t.pathCache=w(E(n)));return a(n[0],r,e)}function l(t,e){var n=t.mark.items,t=n[0],r=t.pathCache||(t.pathCache=w(L(n)));return a(n[0],r,e)}function u(t,e){var n=t.x||0,r=t.y||0,i=n+t.width||0,a=r+t.height||0;return e.set(n,r,i,a),t.stroke&&0!==t.opacity&&t.strokeWidth>0&&e.expand(t.strokeWidth),e}function c(t,e){var n=t.width||0,r=t.height||0,i=(t.x||0)-("center"===t.align?n/2:"right"===t.align?n:0),a=(t.y||0)-("middle"===t.baseline?r/2:"bottom"===t.baseline?r:0);return e.set(i,a,i+n,a+r)}function d(t,e){var n,r;return e.set(n=t.x||0,r=t.y||0,null!=t.x2?t.x2:n,null!=t.y2?t.y2:r),t.stroke&&0!==t.opacity&&t.strokeWidth>0&&e.expand(t.strokeWidth),e}function h(t,e){var n,r,i,a,s,o,l,u,c,d=t.x||0,h=t.y||0,f=t.innerRadius||0,p=t.outerRadius||0,g=(t.startAngle||0)-A,m=(t.endAngle||0)-A,v=1/0,y=-(1/0),_=1/0,b=-(1/0),x=[g,m],w=g-g%A;for(r=0;4>r&&m>w;++r,w+=A)x.push(w);for(r=0,i=x.length;i>r;++r)n=x[r],a=Math.cos(n),o=f*a,u=p*a,s=Math.sin(n),l=f*s,c=p*s,v=Math.min(v,o,u),y=Math.max(y,o,u),_=Math.min(_,l,c),b=Math.max(b,l,c);return e.set(d+v,h+_,d+y,h+b),t.stroke&&0!==t.opacity&&t.strokeWidth>0&&e.expand(t.strokeWidth),e}function f(t,e){var n,r,i,a,s=null!=t.size?t.size:100,o=t.x||0,l=t.y||0;switch(t.shape){case"cross":n=Math.sqrt(s/5)/2,r=3*n,e.set(o-r,l-n,o+r,l+n);break;case"diamond":a=Math.sqrt(s/(2*M)),i=a*M,e.set(o-i,l-a,o+i,l+a);break;case"square":r=Math.sqrt(s),n=r/2,e.set(o-n,l-n,o+n,l+n);break;case"triangle-down":i=Math.sqrt(s/S),a=i*S/2,e.set(o-i,l-a,o+i,l+a);break;case"triangle-up":i=Math.sqrt(s/S),a=i*S/2,e.set(o-i,l-a,o+i,l+a);break;default:n=Math.sqrt(s/Math.PI),e.set(o-n,l-n,o+n,l+n)}return t.stroke&&0!==t.opacity&&t.strokeWidth>0&&e.expand(t.strokeWidth),e}function p(t,e,n){var a,s,o=(t.x||0)+(t.dx||0),l=(t.y||0)+(t.dy||0),u=t.fontSize||x.render.fontSize,c=t.align,d=t.baseline,h=t.radius||0,f=i();return f.font=r(t),f.textAlign=c||"left",f.textBaseline=d||"alphabetic",a=f.measureText(t.text||"").width,h&&(s=(t.theta||0)-Math.PI/2,o+=h*Math.cos(s),l+=h*Math.sin(s)),"center"===c?o-=a/2:"right"===c&&(o-=a),"top"===d?l+=u/5:"bottom"===d?l-=u:"middle"===d?l=l-u/2+u/10:l-=4*u/5,e.set(o,l,o+a,l+u),t.angle&&!n&&e.rotate(t.angle*Math.PI/180,t.x||0,t.y||0),e.expand(n?0:1)}function g(t,e,n){var r,i,a=t.axisItems||[],s=t.legendItems||[];for(r=0,i=a.length;i>r;++r)e.union(a[r].bounds);for(r=0,i=t.items.length;i>r;++r)e.union(t.items[r].bounds);if(n){for(r=0,i=s.length;i>r;++r)e.union(s[r].bounds);null!=t.width&&null!=t.height&&e.add(t.width,t.height),null!=t.x&&null!=t.y&&e.add(0,0)}return e.translate(t.x||0,t.y||0),e}function m(t,e,n){e=e||T[t.mark.marktype],t.bounds_prev||(t["bounds:prev"]=new _);var r=t.bounds,i=t["bounds:prev"];return r&&i.clear().union(r),t.bounds=e(t,r?r.clear():new _,n),r||i.clear().union(t.bounds),t.bounds}function v(t,e,n){e=e||t.bounds&&t.bounds.clear()||new _;var r,i,a=t.marktype,s=T[a],o=t.items;if("area"===a||"line"===a)o.length&&(o[0].bounds=s(o[0],e));else for(r=0,i=o.length;i>r;++r)e.union(m(o[r],s,n));t.bounds=e}var y="undefined"!=typeof window?window.d3:"undefined"!=typeof n?n.d3:null,_=t("../core/Bounds"),b=t("../render/canvas/path"),x=t("./config"),w=b.parse,k=b.bounds,E=b.area,L=b.line,A=Math.PI/2,S=Math.sqrt(3),M=Math.tan(30*Math.PI/180),N=null,T={group:g,symbol:f,image:c,rect:u,rule:d,arc:h,text:p,path:s,area:o,line:l};e.exports={mark:v,item:m,text:p,group:g}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../core/Bounds":24,"../render/canvas/path":58,"./config":95}],95:[function(t,e,n){(function(t){var n="undefined"!=typeof window?window.d3:"undefined"!=typeof t?t.d3:null,r={};r.debug=!1,r.load={baseURL:"",domainWhiteList:!1},r.svgNamespace='version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"',r.autopadInset=5,r.scale={time:n.time.scale,utc:n.time.scale.utc},r.render={lineWidth:1,lineCap:"butt",font:"sans-serif",fontSize:11},r.axis={orient:"bottom",ticks:10,padding:3,axisColor:"#000",gridColor:"#d8d8d8",tickColor:"#000",tickLabelColor:"#000",axisWidth:1,tickWidth:1,tickSize:6,tickLabelFontSize:11,tickLabelFont:"sans-serif",titleColor:"#000",titleFont:"sans-serif",titleFontSize:11,titleFontWeight:"bold",titleOffset:35},r.legend={orient:"right",offset:10,padding:3,gradientStrokeColor:"#888",gradientStrokeWidth:1,gradientHeight:16,gradientWidth:100,labelColor:"#000",labelFontSize:10,labelFont:"sans-serif",labelAlign:"left",labelBaseline:"middle",labelOffset:8,symbolShape:"circle",symbolSize:50,symbolColor:"#888",symbolStrokeWidth:1,titleColor:"#000",titleFont:"sans-serif",titleFontSize:11,titleFontWeight:"bold"},r.color={rgb:[128,128,128],lab:[50,0,0],hcl:[0,0,50],hsl:[0,0,.5]},r.range={category10:["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],category20:["#1f77b4","#aec7e8","#ff7f0e","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5"],shapes:["circle","cross","diamond","square","triangle-down","triangle-up"]},e.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],96:[function(t,e,n){e.exports={ADD_CELL:1,MOD_CELL:2,DATA:"data",FIELDS:"fields",SCALES:"scales",SIGNAL:"signal",SIGNALS:"signals",GROUP:"group",ENTER:"enter",UPDATE:"update",EXIT:"exit",SENTINEL:{sentinel:1},SINGLETON:"_singleton",ADD:"add",REMOVE:"remove",TOGGLE:"toggle",CLEAR:"clear",LINEAR:"linear",ORDINAL:"ordinal",LOG:"log",POWER:"pow",TIME:"time",QUANTILE:"quantile",DOMAIN:"domain",RANGE:"range",MARK:"mark",AXIS:"axis",COUNT:"count",MIN:"min",MAX:"max",ASC:"asc",DESC:"desc"}},{}],97:[function(t,e,n){var r,i=t("./config");e.exports=function(t,e){if(i.debug){var n=Function.prototype.bind.call(console.log,console);e.unshift(t.stamp||-1),e.unshift(Date.now()-r),t.add&&e.push(t.add.length,t.mod.length,t.rem.length,!!t.reflow),n.apply(console,e),r=Date.now()}}},{"./config":95}],98:[function(t,e,n){var r=t("datalib");e.exports=function(t,e,n){function i(t,n){var r=e[t];e[t]=e[n],e[n]=r}null===e&&(e=[],r.keys(n).forEach(function(t){var r=0,i=n[t];for(t=+t||t;i>r;++r)e.push(t)}));for(var a,s,o,l=0,u=e.length-1;u>l;){for(o=e[t],i(t,u),s=a=l;u>s;++s)e[s]<o&&i(s,a++);if(i(u,a),a===t)break;t>a?l=a+1:u=a-1}return e[t]}},{datalib:17}]},{},[1])(1)});
//# sourceMappingURL=vega2.min.js.map